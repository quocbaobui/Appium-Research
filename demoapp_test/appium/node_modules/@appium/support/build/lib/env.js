"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MANIFEST_RELATIVE_PATH = exports.MANIFEST_BASENAME = exports.DEFAULT_APPIUM_HOME = void 0;
exports.hasAppiumDependency = hasAppiumDependency;
exports.resolveManifestPath = exports.resolveAppiumHome = exports.readPackageInDir = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _os = require("os");

var _path = _interopRequireDefault(require("path"));

var _pkgDir = _interopRequireDefault(require("pkg-dir"));

var _readPkg = _interopRequireDefault(require("read-pkg"));

var _npm = require("./npm");

const DEFAULT_APPIUM_HOME = _path.default.resolve((0, _os.homedir)(), '.appium');

exports.DEFAULT_APPIUM_HOME = DEFAULT_APPIUM_HOME;
const MANIFEST_BASENAME = 'extensions.yaml';
exports.MANIFEST_BASENAME = MANIFEST_BASENAME;

const MANIFEST_RELATIVE_PATH = _path.default.join('node_modules', '.cache', 'appium', MANIFEST_BASENAME);

exports.MANIFEST_RELATIVE_PATH = MANIFEST_RELATIVE_PATH;

async function hasAppiumDependency(cwd) {
  let listResult;
  let resolved;
  let version;

  try {
    var _listResult, _listResult$dependenc, _listResult$dependenc2, _listResult2, _listResult2$dependen, _listResult2$dependen2, _listResult3, _listResult3$dependen, _listResult3$dependen2;

    listResult = await _npm.npm.list(cwd, 'appium');

    if ((_listResult = listResult) !== null && _listResult !== void 0 && (_listResult$dependenc = _listResult.dependencies) !== null && _listResult$dependenc !== void 0 && (_listResult$dependenc2 = _listResult$dependenc.appium) !== null && _listResult$dependenc2 !== void 0 && _listResult$dependenc2.extraneous) {
      return false;
    }

    resolved = ((_listResult2 = listResult) === null || _listResult2 === void 0 ? void 0 : (_listResult2$dependen = _listResult2.dependencies) === null || _listResult2$dependen === void 0 ? void 0 : (_listResult2$dependen2 = _listResult2$dependen.appium) === null || _listResult2$dependen2 === void 0 ? void 0 : _listResult2$dependen2.resolved) ?? '';
    version = ((_listResult3 = listResult) === null || _listResult3 === void 0 ? void 0 : (_listResult3$dependen = _listResult3.dependencies) === null || _listResult3$dependen === void 0 ? void 0 : (_listResult3$dependen2 = _listResult3$dependen.appium) === null || _listResult3$dependen2 === void 0 ? void 0 : _listResult3$dependen2.version) ?? '';
  } catch {
    try {
      var _pkg$dependencies, _pkg$devDependencies, _pkg$optionalDependen;

      const pkg = await readPackageInDir(cwd);
      version = resolved = (pkg === null || pkg === void 0 ? void 0 : (_pkg$dependencies = pkg.dependencies) === null || _pkg$dependencies === void 0 ? void 0 : _pkg$dependencies.appium) ?? (pkg === null || pkg === void 0 ? void 0 : (_pkg$devDependencies = pkg.devDependencies) === null || _pkg$devDependencies === void 0 ? void 0 : _pkg$devDependencies.appium) ?? (pkg === null || pkg === void 0 ? void 0 : (_pkg$optionalDependen = pkg.optionalDependencies) === null || _pkg$optionalDependen === void 0 ? void 0 : _pkg$optionalDependen.appium);
    } catch {}
  }

  return Boolean(version && (!resolved || resolved && !resolved.startsWith('file:')) && !version.startsWith('1') && !version.startsWith('0'));
}

const readPackageInDir = _lodash.default.memoize(async function _readPackageInDir(cwd) {
  return await (0, _readPkg.default)({
    cwd,
    normalize: true
  });
});

exports.readPackageInDir = readPackageInDir;

const resolveAppiumHome = _lodash.default.memoize(async function _resolveAppiumHome(cwd = process.cwd()) {
  if (!_path.default.isAbsolute(cwd)) {
    throw new TypeError('`cwd` parameter must be an absolute path');
  }

  if (process.env.APPIUM_HOME) {
    return _path.default.resolve(cwd, process.env.APPIUM_HOME);
  }

  let currentPkgDir;

  try {
    currentPkgDir = await (0, _pkgDir.default)(cwd);

    if (!currentPkgDir) {
      return DEFAULT_APPIUM_HOME;
    } else {
      currentPkgDir = _path.default.resolve(cwd, currentPkgDir);
    }
  } catch {
    return DEFAULT_APPIUM_HOME;
  }

  return (await hasAppiumDependency(currentPkgDir)) ? currentPkgDir : DEFAULT_APPIUM_HOME;
});

exports.resolveAppiumHome = resolveAppiumHome;

const resolveManifestPath = _lodash.default.memoize(async function _resolveManifestPath(appiumHome) {
  appiumHome = appiumHome ?? (await resolveAppiumHome());
  return _path.default.join(appiumHome, MANIFEST_RELATIVE_PATH);
});

exports.resolveManifestPath = resolveManifestPath;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0FQUElVTV9IT01FIiwicGF0aCIsInJlc29sdmUiLCJob21lZGlyIiwiTUFOSUZFU1RfQkFTRU5BTUUiLCJNQU5JRkVTVF9SRUxBVElWRV9QQVRIIiwiam9pbiIsImhhc0FwcGl1bURlcGVuZGVuY3kiLCJjd2QiLCJsaXN0UmVzdWx0IiwicmVzb2x2ZWQiLCJ2ZXJzaW9uIiwibnBtIiwibGlzdCIsImRlcGVuZGVuY2llcyIsImFwcGl1bSIsImV4dHJhbmVvdXMiLCJwa2ciLCJyZWFkUGFja2FnZUluRGlyIiwiZGV2RGVwZW5kZW5jaWVzIiwib3B0aW9uYWxEZXBlbmRlbmNpZXMiLCJCb29sZWFuIiwic3RhcnRzV2l0aCIsIl8iLCJtZW1vaXplIiwiX3JlYWRQYWNrYWdlSW5EaXIiLCJyZWFkUGtnIiwibm9ybWFsaXplIiwicmVzb2x2ZUFwcGl1bUhvbWUiLCJfcmVzb2x2ZUFwcGl1bUhvbWUiLCJwcm9jZXNzIiwiaXNBYnNvbHV0ZSIsIlR5cGVFcnJvciIsImVudiIsIkFQUElVTV9IT01FIiwiY3VycmVudFBrZ0RpciIsInBrZ0RpciIsInJlc29sdmVNYW5pZmVzdFBhdGgiLCJfcmVzb2x2ZU1hbmlmZXN0UGF0aCIsImFwcGl1bUhvbWUiXSwic291cmNlcyI6WyIuLi8uLi9saWIvZW52LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1jaGVja1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7aG9tZWRpcn0gZnJvbSAnb3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgcGtnRGlyIGZyb20gJ3BrZy1kaXInO1xuaW1wb3J0IHJlYWRQa2cgZnJvbSAncmVhZC1wa2cnO1xuaW1wb3J0IHtucG19IGZyb20gJy4vbnBtJztcblxuLyoqXG4gKiBQYXRoIHRvIHRoZSBkZWZhdWx0IGBBUFBJVU1fSE9NRWAgZGlyIChgfi8uYXBwaXVtYCkuXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9BUFBJVU1fSE9NRSA9IHBhdGgucmVzb2x2ZShob21lZGlyKCksICcuYXBwaXVtJyk7XG5cbi8qKlxuICogQmFzZW5hbWUgb2YgZXh0ZW5zaW9uIG1hbmlmZXN0IGZpbGUuXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5leHBvcnQgY29uc3QgTUFOSUZFU1RfQkFTRU5BTUUgPSAnZXh0ZW5zaW9ucy55YW1sJztcblxuLyoqXG4gKiBSZWxhdGl2ZSBwYXRoIHRvIGV4dGVuc2lvbiBtYW5pZmVzdCBmaWxlIGZyb20gYEFQUElVTV9IT01FYC5cbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmV4cG9ydCBjb25zdCBNQU5JRkVTVF9SRUxBVElWRV9QQVRIID0gcGF0aC5qb2luKFxuICAnbm9kZV9tb2R1bGVzJyxcbiAgJy5jYWNoZScsXG4gICdhcHBpdW0nLFxuICBNQU5JRkVTVF9CQVNFTkFNRVxuKTtcblxuLyoqXG4gKiBSZXR1cm5zIGB0cnVlYCBpZiBhcHBpdW0gaXMgaW5zdGFsbGVkIGFzIGEgZGVwZW5kZW5jeSBvZiBhIGxvY2FsIHBhY2thZ2UgYXQgYGN3ZGAuXG4gKlxuICogVGhlIGZvbGxvd2luZyBzcGVjaWFsIGNhc2VzIGFyZSBjb25zaWRlcmVkOlxuICpcbiAqIC0gSWYgYHJlc29sdmVkYCBzdGFydHMgd2l0aCBgZmlsZTpgLCB0aGVuIGBjd2RgIGxpa2VseSBwb2ludHMgdG8gYGFwcGl1bS1tb25vcmVwb2AsIGFuZCAoZm9yIG5vdykgd2UgZXhwZWN0IGBBUFBJVU1fSE9NRWAgdG8gYmUgdGhlIGRlZmF1bHQuXG4gKiAtIElmIHRoZSBgdmVyc2lvbmAgYmVnaW5zIHdpdGggYDBgIG9yIGAxYCwgd2UncmUgbG9va2luZyBhdCBhbiBvbGQgdmVyc2lvbiBvZiBgYXBwaXVtYCAobm90IHRoaXMgb25lISlcbiAqXG4gKiBOb3RlIHRoYXQgd2UgYXJlIF9ub3RfIHBlcmZvcm1pbmcgdGhlIGNoZWNrIFwiaXMgdGhlIGN1cnJlbnRseSBydW5uaW5nIEFwcGl1bSB0aGUgc2FtZSBvbmUgYXMgZm91bmQgaW4gdGhlIGxpc3Qgb2YgZGVwZW5kZW5jaWVzXCIsIGJlY2F1c2UgSSdtIG5vdCBzdXJlIGl0IGFjdHVhbGx5IG1hdHRlcnMgKGFzc3VtaW5nIHRoZSB2ZXJzaW9ucyBhcmUgY29tcGF0aWJsZSkuXG4gKiBSZWdhcmRsZXNzIHdlIG1heSB3YW50IHRvIG1ha2UgdGhpcyBtb3JlIHJvYnVzdCBpbiB0aGUgZnV0dXJlLCBhcyB3ZSBoaXQgZWRnZSBjYXNlcy5cbiAqXG4gKiBfQWxzb18gbm90ZSB0aGF0OlxuICpcbiAqIC0gaWYgYGFwcGl1bWAgYXBwZWFycyBhcyBhIGRlcGVuZGVuY3kgaW4gYHBhY2thZ2UuanNvbmAgX2J1dCBpdCBpcyBub3QgeWV0IGluc3RhbGxlZF8gdGhpcyBmdW5jdGlvbiB3aWxsIHJlc29sdmUgYGZhbHNlYC5cbiAqIC0gaWYgYGFwcGl1bWAgX2RvZXMgbm90IGFwcGVhciBpbiBgcGFja2FnZS5qc29uYF8sIGJ1dCBpcyBpbnN0YWxsZWQgYW55d2F5IChleHRyYW5lb3VzKSB0aGlzIGZ1bmN0aW9uIHdpbGwgcmVzb2x2ZSBgZmFsc2VgLlxuICpcbiAqIFRoaXMgbWF5IG5vdCBiZSBleGFjdGx5IHdoYXQgd2Ugd2FudC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY3dkXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc0FwcGl1bURlcGVuZGVuY3koY3dkKSB7XG4gIC8qKlxuICAgKiBAdG9kbyB0eXBlIHRoaXNcbiAgICogQHR5cGUge29iamVjdH1cbiAgICovXG4gIGxldCBsaXN0UmVzdWx0O1xuICAvKiogQHR5cGUge3N0cmluZ3x1bmRlZmluZWR9ICovXG4gIGxldCByZXNvbHZlZDtcbiAgLyoqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfSAqL1xuICBsZXQgdmVyc2lvbjtcbiAgdHJ5IHtcbiAgICBsaXN0UmVzdWx0ID0gYXdhaXQgbnBtLmxpc3QoY3dkLCAnYXBwaXVtJyk7XG5cbiAgICAvLyBzaG9ydC1jaXJjdWl0IGlmIGBhcHBpdW1gIGlzIGhhbmdpbmcgYXJvdW5kIGJ1dCB0aGUgdXNlciBoYXNuJ3QgYWRkZWQgaXQgdG8gYHBhY2thZ2UuanNvbmAuXG4gICAgaWYgKGxpc3RSZXN1bHQ/LmRlcGVuZGVuY2llcz8uYXBwaXVtPy5leHRyYW5lb3VzKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIGlmIFwicmVzb2x2ZWRcIiBpcyBlbXB0eSwgdGhlbiBgYXBwaXVtYCBpcyBpbiBkZXBlbmRlbmNpZXMsIGJ1dCBgbnBtIGluc3RhbGxgIGhhcyBub3QgYmVlbiBydW4uXG4gICAgLy8gaW4gb3RoZXIgd29yZHMsIHRoaXMgZnVuY3Rpb24gY2FuIHJlc29sdmUgYHRydWVgIGV2ZW4gaWYgYHJlc29sdmVkYCBpcyBlbXB0eS4uLlxuICAgIHJlc29sdmVkID0gbGlzdFJlc3VsdD8uZGVwZW5kZW5jaWVzPy5hcHBpdW0/LnJlc29sdmVkID8/ICcnO1xuICAgIC8vIC4uLmhvd2V2ZXIsIGl0IGNhbm5vdCBkbyBzbyB1bmxlc3MgYHZlcnNpb25gIGlzIG5vbmVtcHR5LlxuICAgIHZlcnNpb24gPSBsaXN0UmVzdWx0Py5kZXBlbmRlbmNpZXM/LmFwcGl1bT8udmVyc2lvbiA/PyAnJztcbiAgfSBjYXRjaCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBrZyA9IGF3YWl0IHJlYWRQYWNrYWdlSW5EaXIoY3dkKTtcbiAgICAgIC8vIHdlJ3JlIG9ubHkgZ29pbmcgdG8gbG9vayBhdCB0aGVzZSB0aHJlZSBmaWVsZHMgZm9yIG5vdywgYnV0IHdlIGNhbiBjaGFuZ2UgaXQgbGF0ZXIgaWYgbmVlZCBiZS5cbiAgICAgIHZlcnNpb24gPSByZXNvbHZlZCA9XG4gICAgICAgIHBrZz8uZGVwZW5kZW5jaWVzPy5hcHBpdW0gPz9cbiAgICAgICAgcGtnPy5kZXZEZXBlbmRlbmNpZXM/LmFwcGl1bSA/P1xuICAgICAgICBwa2c/Lm9wdGlvbmFsRGVwZW5kZW5jaWVzPy5hcHBpdW07XG4gICAgfSBjYXRjaCB7fVxuICB9XG4gIHJldHVybiBCb29sZWFuKFxuICAgIHZlcnNpb24gJiZcbiAgICAgICghcmVzb2x2ZWQgfHwgKHJlc29sdmVkICYmICFyZXNvbHZlZC5zdGFydHNXaXRoKCdmaWxlOicpKSkgJiZcbiAgICAgIC8vIGRvaW5nIGFueSBmdXJ0aGVyIGNoZWNraW5nIGhlcmUgbWF5IGJlIGEgZm9vbCdzIGVycmFuZCwgYmVjYXVzZSB5b3UgY2FuIHBpbiB0aGUgdmVyc2lvblxuICAgICAgLy8gdG8gYSBfbG90XyBvZiBkaWZmZXJlbnQgdGhpbmdzICh0YWdzLCBVUkxzLCBldGMpLlxuICAgICAgIXZlcnNpb24uc3RhcnRzV2l0aCgnMScpICYmXG4gICAgICAhdmVyc2lvbi5zdGFydHNXaXRoKCcwJylcbiAgKTtcbn1cblxuLyoqXG4gKiBSZWFkIGEgYHBhY2thZ2UuanNvbmAgaW4gZGlyIGBjd2RgLiAgSWYgbm9uZSBmb3VuZCwgcmV0dXJuIGB1bmRlZmluZWRgLlxuICovXG5leHBvcnQgY29uc3QgcmVhZFBhY2thZ2VJbkRpciA9IF8ubWVtb2l6ZShcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjd2QgLSBEaXJlY3Rvcnkgb3N0ZW5zaWJseSBoYXZpbmcgYSBgcGFja2FnZS5qc29uYFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxpbXBvcnQoJ3JlYWQtcGtnJykuTm9ybWFsaXplZFBhY2thZ2VKc29ufHVuZGVmaW5lZD59XG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBfcmVhZFBhY2thZ2VJbkRpcihjd2QpIHtcbiAgICByZXR1cm4gYXdhaXQgcmVhZFBrZyh7Y3dkLCBub3JtYWxpemU6IHRydWV9KTtcbiAgfVxuKTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIGxvY2F0aW9uIG9mIEFwcGl1bSdzIFwiaG9tZVwiIGRpclxuICpcbiAqIC0gSWYgYEFQUElVTV9IT01FYCBpcyBzZXQgaW4gdGhlIGVudmlyb25tZW50LCB1c2UgdGhhdFxuICogLSBJZiB3ZSBoYXZlIGFuIGBleHRlbnNpb25zLnlhbWxgIGluIHtAbGlua2NvZGUgREVGQVVMVF9BUFBJVU1fSE9NRX0sIHRoZW4gdXNlIHRoYXQuXG4gKiAtIElmIHdlIGZpbmQgYSBgcGFja2FnZS5qc29uYCBpbiBvciBhYm92ZSBgY3dkYCBhbmQge0BsaW5rY29kZSBzaG91bGRVc2VDd2RGb3JBcHBpdW1Ib21lfSByZXR1cm5zIGB0cnVlYCwgdGhlbiB1c2UgdGhlIGRpcmVjdG9yeSBjb250YWluaW5nIHRoZSBgcGFja2FnZS5qc29uYC5cbiAqXG4gKiBBbGwgcmV0dXJuZWQgcGF0aHMgd2lsbCBiZSBhYnNvbHV0ZS5cbiAqL1xuZXhwb3J0IGNvbnN0IHJlc29sdmVBcHBpdW1Ib21lID0gXy5tZW1vaXplKFxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtjd2RdIC0gQ3VycmVudCB3b3JraW5nIGRpcmVjdG9yeS4gIF9NdXN0XyBiZSBhYnNvbHV0ZSwgaWYgc3BlY2lmaWVkLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fVxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gX3Jlc29sdmVBcHBpdW1Ib21lKGN3ZCA9IHByb2Nlc3MuY3dkKCkpIHtcbiAgICBpZiAoIXBhdGguaXNBYnNvbHV0ZShjd2QpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdgY3dkYCBwYXJhbWV0ZXIgbXVzdCBiZSBhbiBhYnNvbHV0ZSBwYXRoJyk7XG4gICAgfVxuXG4gICAgaWYgKHByb2Nlc3MuZW52LkFQUElVTV9IT01FKSB7XG4gICAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGN3ZCwgcHJvY2Vzcy5lbnYuQVBQSVVNX0hPTUUpO1xuICAgIH1cblxuICAgIC8qKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH0gKi9cbiAgICBsZXQgY3VycmVudFBrZ0RpcjtcblxuICAgIHRyeSB7XG4gICAgICBjdXJyZW50UGtnRGlyID0gYXdhaXQgcGtnRGlyKGN3ZCk7XG5cbiAgICAgIC8vIGlmIHdlIGNhbid0IGZpbmQgYSBgcGFja2FnZS5qc29uYCwgdXNlIHRoZSBkZWZhdWx0XG4gICAgICBpZiAoIWN1cnJlbnRQa2dEaXIpIHtcbiAgICAgICAgcmV0dXJuIERFRkFVTFRfQVBQSVVNX0hPTUU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpdCdzIHVuY2xlYXIgZnJvbSB0aGUgY29udHJhY3Qgb2YgYHBrZ0RpcmAgd2hldGhlciBvciBub3QgaXQgY2FuIHJldHVybiBhIHJlbGF0aXZlIHBhdGgsXG4gICAgICAgIC8vIHNvIGxldCdzIGp1c3QgYmUgZGVmZW5zaXZlLlxuICAgICAgICBjdXJyZW50UGtnRGlyID0gcGF0aC5yZXNvbHZlKGN3ZCwgY3VycmVudFBrZ0Rpcik7XG4gICAgICB9XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyB1bmNsZWFyIGlmIHRoaXMgY2FuIGFjdHVhbGx5IGhhcHBlblxuICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgIHJldHVybiBERUZBVUxUX0FQUElVTV9IT01FO1xuICAgIH1cblxuICAgIHJldHVybiAoYXdhaXQgaGFzQXBwaXVtRGVwZW5kZW5jeShjdXJyZW50UGtnRGlyKSkgPyBjdXJyZW50UGtnRGlyIDogREVGQVVMVF9BUFBJVU1fSE9NRTtcbiAgfVxuKTtcblxuLyoqXG4gKiBGaWd1cmUgb3V0IG1hbmlmZXN0IHBhdGggYmFzZWQgb24gYGFwcGl1bUhvbWVgLlxuICpcbiAqIFRoZSBhc3N1bXB0aW9uIGlzIHRoYXQsIGlmIGBhcHBpdW1Ib21lYCBoYXMgYmVlbiBwcm92aWRlZCwgaXQgd2FzIHJlc29sdmVkIHZpYSB7QGxpbmsgcmVzb2x2ZUFwcGl1bUhvbWUgYHJlc29sdmVBcHBpdW1Ib21lKClgfSEgIElmIHVuc3VyZSxcbiAqIGRvbid0IHBhc3MgYSBwYXJhbWV0ZXIgYW5kIGxldCBgcmVzb2x2ZUFwcGl1bUhvbWUoKWAgaGFuZGxlIGl0LlxuICovXG5leHBvcnQgY29uc3QgcmVzb2x2ZU1hbmlmZXN0UGF0aCA9IF8ubWVtb2l6ZShcbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbYXBwaXVtSG9tZV0gLSBBcHBpdW0gaG9tZSBkaXJlY3RvcnlcbiAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn1cbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIF9yZXNvbHZlTWFuaWZlc3RQYXRoKGFwcGl1bUhvbWUpIHtcbiAgICAvLyBjYW4geW91IFwiYXdhaXRcIiBpbiBhIGRlZmF1bHQgcGFyYW1ldGVyPyBpcyB0aGF0IGEgZ29vZCBpZGVhP1xuICAgIGFwcGl1bUhvbWUgPSBhcHBpdW1Ib21lID8/IChhd2FpdCByZXNvbHZlQXBwaXVtSG9tZSgpKTtcbiAgICByZXR1cm4gcGF0aC5qb2luKGFwcGl1bUhvbWUsIE1BTklGRVNUX1JFTEFUSVZFX1BBVEgpO1xuICB9XG4pO1xuXG4vKipcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ3JlYWQtcGtnJykuTm9ybWFsaXplZFBhY2thZ2VKc29ufSBOb3JtYWxpemVkUGFja2FnZUpzb25cbiAqL1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBTU8sTUFBTUEsbUJBQW1CLEdBQUdDLGFBQUEsQ0FBS0MsT0FBTCxDQUFhLElBQUFDLFdBQUEsR0FBYixFQUF3QixTQUF4QixDQUE1Qjs7O0FBTUEsTUFBTUMsaUJBQWlCLEdBQUcsaUJBQTFCOzs7QUFNQSxNQUFNQyxzQkFBc0IsR0FBR0osYUFBQSxDQUFLSyxJQUFMLENBQ3BDLGNBRG9DLEVBRXBDLFFBRm9DLEVBR3BDLFFBSG9DLEVBSXBDRixpQkFKb0MsQ0FBL0I7Ozs7QUE0QkEsZUFBZUcsbUJBQWYsQ0FBbUNDLEdBQW5DLEVBQXdDO0VBSzdDLElBQUlDLFVBQUo7RUFFQSxJQUFJQyxRQUFKO0VBRUEsSUFBSUMsT0FBSjs7RUFDQSxJQUFJO0lBQUE7O0lBQ0ZGLFVBQVUsR0FBRyxNQUFNRyxRQUFBLENBQUlDLElBQUosQ0FBU0wsR0FBVCxFQUFjLFFBQWQsQ0FBbkI7O0lBR0EsbUJBQUlDLFVBQUosaUVBQUksWUFB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
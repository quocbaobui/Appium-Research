"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.REMOTE_CACHE_ROOT = void 0;

require("source-map-support/register");

var _helpers = require("../helpers.js");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

var _support = require("@appium/support");

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

var _lruCache = _interopRequireDefault(require("lru-cache"));

var _adbkitApkreader = _interopRequireDefault(require("adbkit-apkreader"));

const apkUtilsMethods = {};
const ACTIVITIES_TROUBLESHOOTING_LINK = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/android/activity-startup.md';
apkUtilsMethods.APP_INSTALL_STATE = {
  UNKNOWN: 'unknown',
  NOT_INSTALLED: 'notInstalled',
  NEWER_VERSION_INSTALLED: 'newerVersionInstalled',
  SAME_VERSION_INSTALLED: 'sameVersionInstalled',
  OLDER_VERSION_INSTALLED: 'olderVersionInstalled'
};
const REMOTE_CACHE_ROOT = '/data/local/tmp/appium_cache';
exports.REMOTE_CACHE_ROOT = REMOTE_CACHE_ROOT;

apkUtilsMethods.isAppInstalled = async function isAppInstalled(pkg) {
  _logger.default.debug(`Getting install status for ${pkg}`);

  const installedPattern = new RegExp(`^\\s*Package\\s+\\[${_lodash.default.escapeRegExp(pkg)}\\][^:]+:$`, 'm');

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const isInstalled = installedPattern.test(stdout);

    _logger.default.debug(`'${pkg}' is${!isInstalled ? ' not' : ''} installed`);

    return isInstalled;
  } catch (e) {
    throw new Error(`Error finding if '${pkg}' is installed. Original error: ${e.message}`);
  }
};

apkUtilsMethods.startUri = async function startUri(uri, pkg, opts = {}) {
  const {
    waitForLaunch = true
  } = opts;

  if (!uri || !pkg) {
    throw new Error('URI and package arguments are required');
  }

  const args = ['am', 'start'];

  if (waitForLaunch) {
    args.push('-W');
  }

  args.push('-a', 'android.intent.action.VIEW', '-d', (0, _helpers.escapeShellArg)(uri), pkg);

  try {
    const res = await this.shell(args);

    if (res.toLowerCase().includes('unable to resolve intent')) {
      throw new Error(res);
    }
  } catch (e) {
    throw new Error(`Error attempting to start URI. Original error: ${e}`);
  }
};

apkUtilsMethods.startApp = async function startApp(startAppOptions = {}) {
  if (!startAppOptions.pkg || !(startAppOptions.activity || startAppOptions.action)) {
    throw new Error('pkg, and activity or intent action, are required to start an application');
  }

  startAppOptions = _lodash.default.clone(startAppOptions);

  if (startAppOptions.activity) {
    startAppOptions.activity = startAppOptions.activity.replace('$', '\\$');
  }

  _lodash.default.defaults(startAppOptions, {
    waitPkg: startAppOptions.pkg,
    waitForLaunch: true,
    waitActivity: false,
    retry: true,
    stopApp: true
  });

  startAppOptions.waitPkg = startAppOptions.waitPkg || startAppOptions.pkg;
  const apiLevel = await this.getApiLevel();
  const cmd = (0, _helpers.buildStartCmd)(startAppOptions, apiLevel);
  const intentName = `${startAppOptions.action}${startAppOptions.optionalIntentArguments ? ' ' + startAppOptions.optionalIntentArguments : ''}`;

  try {
    const shellOpts = {};

    if (_lodash.default.isInteger(startAppOptions.waitDuration) && startAppOptions.waitDuration >= 0) {
      shellOpts.timeout = startAppOptions.waitDuration;
    }

    const stdout = await this.shell(cmd, shellOpts);

    if (stdout.includes('Error: Activity class') && stdout.includes('does not exist')) {
      if (startAppOptions.retry && !startAppOptions.activity.startsWith('.')) {
        _logger.default.debug(`We tried to start an activity that doesn't exist, ` + `retrying with '.${startAppOptions.activity}' activity name`);

        startAppOptions.activity = `.${startAppOptions.activity}`;
        startAppOptions.retry = false;
        return await this.startApp(startAppOptions);
      }

      throw new Error(`Activity name '${startAppOptions.activity}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
    } else if (stdout.includes('Error: Intent does not match any activities') || stdout.includes('Error: Activity not started, unable to resolve Intent')) {
      throw new Error(`Activity for intent '${intentName}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
    } else if (stdout.includes('java.lang.SecurityException')) {
      throw new Error(`The permission to start '${startAppOptions.activity}' activity has been denied.` + `Make sure the activity/package names are correct.`);
    }

    if (startAppOptions.waitActivity) {
      await this.waitForActivity(startAppOptions.waitPkg, startAppOptions.waitActivity, startAppOptions.waitDuration);
    }

    return stdout;
  } catch (e) {
    const appDescriptor = startAppOptions.pkg || intentName;
    throw new Error(`Cannot start the '${appDescriptor}' application. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting. ` + `Original error: ${e.message}`);
  }
};

apkUtilsMethods.dumpWindows = async function dumpWindows() {
  const apiLevel = await this.getApiLevel();
  const dumpsysArg = apiLevel >= 29 ? 'displays' : 'windows';
  const cmd = ['dumpsys', 'window', dumpsysArg];
  return await this.shell(cmd);
};

apkUtilsMethods.getFocusedPackageAndActivity = async function getFocusedPackageAndActivity() {
  _logger.default.debug('Getting focused package and activity');

  let stdout;

  try {
    stdout = await this.dumpWindows();
  } catch (e) {
    throw new Error(`Could not retrieve the currently focused package and activity. Original error: ${e.message}`);
  }

  const nullFocusedAppRe = /^\s*mFocusedApp=null/m;
  const focusedAppRe = new RegExp('^\\s*mFocusedApp.+Record\\{.*\\s([^\\s\\/\\}]+)\\/([^\\s\\/\\}\\,]+)\\,?(\\s[^\\s\\/\\}]+)*\\}', 'mg');
  const nullCurrentFocusRe = /^\s*mCurrentFocus=null/m;
  const currentFocusAppRe = new RegExp('^\\s*mCurrentFocus.+\\{.+\\s([^\\s\\/]+)\\/([^\\s]+)\\b', 'mg');
  const focusedAppCandidates = [];
  const currentFocusAppCandidates = [];

  for (const [candidates, pattern] of [[focusedAppCandidates, focusedAppRe], [currentFocusAppCandidates, currentFocusAppRe]]) {
    let match;

    while (match = pattern.exec(stdout)) {
      candidates.push({
        appPackage: match[1].trim(),
        appActivity: match[2].trim()
      });
    }
  }

  if (focusedAppCandidates.length > 1 && currentFocusAppCandidates.length > 0) {
    return _lodash.default.intersectionWith(focusedAppCandidates, currentFocusAppCandidates, _lodash.default.isEqual)[0] ?? focusedAppCandidates[0];
  }

  if (focusedAppCandidates.length > 0 || currentFocusAppCandidates.length > 0) {
    return focusedAppCandidates[0] ?? currentFocusAppCandidates[0];
  }

  for (const pattern of [nullFocusedAppRe, nullCurrentFocusRe]) {
    if (pattern.exec(stdout)) {
      return {
        appPackage: null,
        appActivity: null
      };
    }
  }

  _logger.default.debug(stdout);

  throw new Error('Could not retrieve the currently focused package and activity');
};

apkUtilsMethods.waitForActivityOrNot = async function waitForActivityOrNot(pkg, activity, waitForStop, waitMs = 20000) {
  if (!pkg || !activity) {
    throw new Error('Package and activity required.');
  }

  _logger.default.debug(`Waiting up to ${waitMs}ms for activity matching pkg: '${pkg}' and ` + `activity: '${activity}' to${waitForStop ? ' not' : ''} be focused`);

  const splitNames = names => names.split(',').map(name => name.trim());

  const allPackages = splitNames(pkg);
  const allActivities = splitNames(activity);
  const possibleActivityNames = [];

  for (const oneActivity of allActivities) {
    if (oneActivity.startsWith('.')) {
      for (const currentPkg of allPackages) {
        possibleActivityNames.push(`${currentPkg}${oneActivity}`.replace(/\.+/g, '.'));
      }
    } else {
      possibleActivityNames.push(oneActivity);
      possibleActivityNames.push(`${pkg}.${oneActivity}`);
    }
  }

  _logger.default.debug(`Possible activities, to be checked: ${possibleActivityNames.map(name => `'${name}'`).join(', ')}`);

  const possibleActivityPatterns = possibleActivityNames.map(actName => new RegExp(`^${actName.replace(/\./g, '\\.').replace(/\*/g, '.*?').replace(/\$/g, '\\$')}$`));

  const conditionFunc = async () => {
    let appPackage;
    let appActivity;

    try {
      ({
        appPackage,
        appActivity
      } = await this.getFocusedPackageAndActivity());
    } catch (e) {
      _logger.default.debug(e.message);

      return false;
    }

    if (appActivity && appPackage) {
      const fullyQualifiedActivity = appActivity.startsWith('.') ? `${appPackage}${appActivity}` : appActivity;

      _logger.default.debug(`Found package: '${appPackage}' and fully qualified activity name : '${fullyQualifiedActivity}'`);

      const isActivityFound = _lodash.default.includes(allPackages, appPackage) && possibleActivityPatterns.some(p => p.test(fullyQualifiedActivity));

      if (!waitForStop && isActivityFound || waitForStop && !isActivityFound) {
        return true;
      }
    }

    _logger.default.debug('Incorrect package and activity. Retrying.');

    return false;
  };

  try {
    await (0, _asyncbox.waitForCondition)(conditionFunc, {
      waitMs: parseInt(waitMs, 10),
      intervalMs: 500
    });
  } catch (e) {
    throw new Error(`${possibleActivityNames.map(name => `'${name}'`).join(' or ')} never ${waitForStop ? 'stopped' : 'started'}. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting`);
  }
};

apkUtilsMethods.waitForActivity = async function waitForActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, false, waitMs);
};

apkUtilsMethods.waitForNotActivity = async function waitForNotActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, true, waitMs);
};

apkUtilsMethods.uninstallApk = async function uninstallApk(pkg, options = {}) {
  _logger.default.debug(`Uninstalling ${pkg}`);

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.info(`${pkg} was not uninstalled, because it was not present on the device`);

    return false;
  }

  const cmd = ['uninstall'];

  if (options.keepData) {
    cmd.push('-k');
  }

  cmd.push(pkg);
  let stdout;

  try {
    await this.forceStop(pkg);
    stdout = (await this.adbExec(cmd, {
      timeout: options.timeout
    })).trim();
  } catch (e) {
    throw new Error(`Unable to uninstall APK. Original error: ${e.message}`);
  }

  _logger.default.debug(`'adb ${cmd.join(' ')}' command output: ${stdout}`);

  if (stdout.includes('Success')) {
    _logger.default.info(`${pkg} was successfully uninstalled`);

    return true;
  }

  _logger.default.info(`${pkg} was not uninstalled`);

  return false;
};

apkUtilsMethods.installFromDevicePath = async function installFromDevicePath(apkPathOnDevice, opts = {}) {
  let stdout = await this.shell(['pm', 'install', '-r', apkPathOnDevice], opts);

  if (stdout.indexOf('Failure') !== -1) {
    throw new Error(`Remote install failed: ${stdout}`);
  }
};

apkUtilsMethods.cacheApk = async function cacheApk(apkPath, options = {}) {
  const appHash = await _support.fs.hash(apkPath);

  const remotePath = _path.default.posix.join(REMOTE_CACHE_ROOT, `${appHash}.apk`);

  const remoteCachedFiles = [];

  try {
    const errorMarker = '_ERROR_';
    let lsOutput = null;

    if (this._areExtendedLsOptionsSupported === true || !_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
      lsOutput = await this.shell([`ls -t -1 ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
    }

    if (!_lodash.default.isString(lsOutput) || lsOutput.includes(errorMarker) && !lsOutput.includes(REMOTE_CACHE_ROOT)) {
      if (!_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
        _logger.default.debug('The current Android API does not support extended ls options. ' + 'Defaulting to no-options call');
      }

      lsOutput = await this.shell([`ls ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
      this._areExtendedLsOptionsSupported = false;
    } else {
      this._areExtendedLsOptionsSupported = true;
    }

    if (lsOutput.includes(errorMarker)) {
      throw new Error(lsOutput.substring(0, lsOutput.indexOf(errorMarker)));
    }

    remoteCachedFiles.push(...lsOutput.split('\n').map(x => x.trim()).filter(Boolean));
  } catch (e) {
    _logger.default.debug(`Got an error '${e.message.trim()}' while getting the list of files in the cache. ` + `Assuming the cache does not exist yet`);

    await this.shell(['mkdir', '-p', REMOTE_CACHE_ROOT]);
  }

  _logger.default.debug(`The count of applications in the cache: ${remoteCachedFiles.length}`);

  const toHash = remotePath => _path.default.posix.parse(remotePath).name;

  if (remoteCachedFiles.some(x => toHash(x) === appHash)) {
    _logger.default.info(`The application at '${apkPath}' is already cached to '${remotePath}'`);

    this.shell(['touch', '-am', remotePath]).catch(() => {});
  } else {
    _logger.default.info(`Caching the application at '${apkPath}' to '${remotePath}'`);

    const timer = new _support.timing.Timer().start();
    await this.push(apkPath, remotePath, {
      timeout: options.timeout
    });
    const {
      size
    } = await _support.fs.stat(apkPath);

    _logger.default.info(`The upload of '${_path.default.basename(apkPath)}' (${_support.util.toReadableSizeString(size)}) ` + `took ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
  }

  if (!this.remoteAppsCache) {
    this.remoteAppsCache = new _lruCache.default({
      max: this.remoteAppsCacheLimit
    });
  }

  _lodash.default.difference([...this.remoteAppsCache.keys()], remoteCachedFiles.map(toHash)).forEach(hash => this.remoteAppsCache.del(hash));

  this.remoteAppsCache.set(appHash, remotePath);
  const entriesToCleanup = remoteCachedFiles.map(x => _path.default.posix.join(REMOTE_CACHE_ROOT, x)).filter(x => !this.remoteAppsCache.has(toHash(x))).slice(this.remoteAppsCacheLimit - [...this.remoteAppsCache.keys()].length);

  if (!_lodash.default.isEmpty(entriesToCleanup)) {
    try {
      await this.shell(['rm', '-f', ...entriesToCleanup]);

      _logger.default.debug(`Deleted ${entriesToCleanup.length} expired application cache entries`);
    } catch (e) {
      _logger.default.warn(`Cannot delete ${entriesToCleanup.length} expired application cache entries. ` + `Original error: ${e.message}`);
    }
  }

  return remotePath;
};

apkUtilsMethods.install = async function install(appPath, options = {}) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    return await this.installApks(appPath, options);
  }

  options = _lodash.default.cloneDeep(options);

  _lodash.default.defaults(options, {
    replace: true,
    timeout: this.adbExecTimeout === _helpers.DEFAULT_ADB_EXEC_TIMEOUT ? _helpers.APK_INSTALL_TIMEOUT : this.adbExecTimeout,
    timeoutCapName: 'androidInstallTimeout'
  });

  const installArgs = (0, _helpers.buildInstallArgs)(await this.getApiLevel(), options);

  if (options.noIncremental && (await this.isIncrementalInstallSupported())) {
    installArgs.push('--no-incremental');
  }

  const installOpts = {
    timeout: options.timeout,
    timeoutCapName: options.timeoutCapName
  };
  const installCmd = ['install', ...installArgs, appPath];

  let performAppInstall = async () => await this.adbExec(installCmd, installOpts);

  let shouldCacheApp = this.remoteAppsCacheLimit > 0;

  if (shouldCacheApp) {
    shouldCacheApp = !(await this.isStreamedInstallSupported());

    if (!shouldCacheApp) {
      _logger.default.info(`The application at '${appPath}' will not be cached, because the device under test has ` + `confirmed the support of streamed installs`);
    }
  }

  if (shouldCacheApp) {
    const clearCache = async () => {
      _logger.default.info(`Clearing the cache at '${REMOTE_CACHE_ROOT}'`);

      await this.shell(['rm', '-rf', `${REMOTE_CACHE_ROOT}/*`]);
    };

    const cacheApp = async () => await this.cacheApk(appPath, {
      timeout: options.timeout
    });

    try {
      const cachedAppPath = await cacheApp();

      performAppInstall = async () => {
        const pmInstallCmdByRemotePath = remotePath => ['pm', 'install', ...installArgs, remotePath];

        const output = await this.shell(pmInstallCmdByRemotePath(cachedAppPath), installOpts);

        if (/\bINSTALL_FAILED_INSUFFICIENT_STORAGE\b/.test(output)) {
          _logger.default.warn(`There was a failure while installing '${appPath}' ` + `because of the insufficient device storage space`);

          await clearCache();

          _logger.default.info(`Consider decreasing the maximum amount of cached apps ` + `(currently ${this.remoteAppsCacheLimit}) to avoid such issues in the future`);

          const newCachedAppPath = await cacheApp();
          return await this.shell(pmInstallCmdByRemotePath(newCachedAppPath), installOpts);
        }

        return output;
      };
    } catch (e) {
      _logger.default.debug(e);

      _logger.default.warn(`There was a failure while caching '${appPath}': ${e.message}`);

      _logger.default.warn('Falling back to the default installation procedure');

      await clearCache();
    }
  }

  try {
    const timer = new _support.timing.Timer().start();
    const output = await performAppInstall();

    _logger.default.info(`The installation of '${_path.default.basename(appPath)}' took ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);

    const truncatedOutput = !_lodash.default.isString(output) || output.length <= 300 ? output : `${output.substr(0, 150)}...${output.substr(output.length - 150)}`;

    _logger.default.debug(`Install command stdout: ${truncatedOutput}`);

    if (/\[INSTALL[A-Z_]+FAILED[A-Z_]+\]/.test(output)) {
      if (this.isTestPackageOnlyError(output)) {
        const msg = `Set 'allowTestPackages' capability to true in order to allow test packages installation.`;

        _logger.default.warn(msg);

        throw new Error(`${output}\n${msg}`);
      }

      throw new Error(output);
    }
  } catch (err) {
    if (!err.message.includes('INSTALL_FAILED_ALREADY_EXISTS')) {
      throw err;
    }

    _logger.default.debug(`Application '${appPath}' already installed. Continuing.`);
  }
};

apkUtilsMethods.getApplicationInstallState = async function getApplicationInstallState(appPath, pkg = null) {
  let apkInfo = null;

  if (!pkg) {
    apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  if (!pkg) {
    _logger.default.warn(`Cannot read the package name of '${appPath}'`);

    return this.APP_INSTALL_STATE.UNKNOWN;
  }

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.debug(`App '${appPath}' is not installed`);

    return this.APP_INSTALL_STATE.NOT_INSTALLED;
  }

  const {
    versionCode: pkgVersionCode,
    versionName: pkgVersionNameStr
  } = await this.getPackageInfo(pkg);

  const pkgVersionName = _semver.default.valid(_semver.default.coerce(pkgVersionNameStr));

  if (!apkInfo) {
    apkInfo = await this.getApkInfo(appPath);
  }

  const {
    versionCode: apkVersionCode,
    versionName: apkVersionNameStr
  } = apkInfo;

  const apkVersionName = _semver.default.valid(_semver.default.coerce(apkVersionNameStr));

  if (!_lodash.default.isInteger(apkVersionCode) || !_lodash.default.isInteger(pkgVersionCode)) {
    _logger.default.warn(`Cannot read version codes of '${appPath}' and/or '${pkg}'`);

    if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
      _logger.default.warn(`Cannot read version names of '${appPath}' and/or '${pkg}'`);

      return this.APP_INSTALL_STATE.UNKNOWN;
    }
  }

  if (_lodash.default.isInteger(apkVersionCode) && _lodash.default.isInteger(pkgVersionCode)) {
    if (pkgVersionCode > apkVersionCode) {
      _logger.default.debug(`The version code of the installed '${pkg}' is greater than the application version code (${pkgVersionCode} > ${apkVersionCode})`);

      return this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED;
    }

    if (pkgVersionCode === apkVersionCode) {
      if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

        return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }

      if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is equal to application version name (${pkgVersionCode} === ${apkVersionCode})`);

        return this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }
    }
  } else if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
    _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

    return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
  }

  _logger.default.debug(`The installed '${pkg}' package is older than '${appPath}' (${pkgVersionCode} < ${apkVersionCode} or '${pkgVersionName}' < '${apkVersionName}')'`);

  return this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED;
};

apkUtilsMethods.installOrUpgrade = async function installOrUpgrade(appPath, pkg = null, options = {}) {
  if (!pkg) {
    const apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  const {
    enforceCurrentBuild
  } = options;
  const appState = await this.getApplicationInstallState(appPath, pkg);
  let wasUninstalled = false;

  const uninstallPackage = async () => {
    if (!(await this.uninstallApk(pkg))) {
      throw new Error(`'${pkg}' package cannot be uninstalled`);
    }

    wasUninstalled = true;
  };

  switch (appState) {
    case this.APP_INSTALL_STATE.NOT_INSTALLED:
      _logger.default.debug(`Installing '${appPath}'`);

      await this.install(appPath, Object.assign({}, options, {
        replace: false
      }));
      return {
        appState,
        wasUninstalled
      };

    case this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED:
      if (enforceCurrentBuild) {
        _logger.default.info(`Downgrading '${pkg}' as requested`);

        await uninstallPackage();
        break;
      }

      _logger.default.debug(`There is no need to downgrade '${pkg}'`);

      return {
        appState,
        wasUninstalled
      };

    case this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED:
      if (enforceCurrentBuild) {
        break;
      }

      _logger.default.debug(`There is no need to install/upgrade '${appPath}'`);

      return {
        appState,
        wasUninstalled
      };

    case this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED:
      _logger.default.debug(`Executing upgrade of '${appPath}'`);

      break;

    default:
      _logger.default.debug(`The current install state of '${appPath}' is unknown. Installing anyway`);

      break;
  }

  try {
    await this.install(appPath, Object.assign({}, options, {
      replace: true
    }));
  } catch (err) {
    _logger.default.warn(`Cannot install/upgrade '${pkg}' because of '${err.message}'. Trying full reinstall`);

    await uninstallPackage();
    await this.install(appPath, Object.assign({}, options, {
      replace: false
    }));
  }

  return {
    appState,
    wasUninstalled
  };
};

apkUtilsMethods.extractStringsFromApk = async function extractStringsFromApk(appPath, language, out) {
  _logger.default.debug(`Extracting strings from for language: ${language || 'default'}`);

  const originalAppPath = appPath;

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractLanguageApk(appPath, language);
  }

  let apkStrings = {};
  let configMarker;

  try {
    await this.initAapt();
    configMarker = await (0, _helpers.formatConfigMarker)(async () => {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'configurations', appPath]);
      return _lodash.default.uniq(stdout.split(_os.default.EOL));
    }, language, '(default)');
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', '--values', 'resources', appPath]);
    apkStrings = (0, _helpers.parseAaptStrings)(stdout, configMarker);
  } catch (e) {
    _logger.default.debug('Cannot extract resources using aapt. Trying aapt2. ' + `Original error: ${e.stderr || e.message}`);

    await this.initAapt2();
    configMarker = await (0, _helpers.formatConfigMarker)(async () => {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt2, ['d', 'configurations', appPath]);
      return _lodash.default.uniq(stdout.split(_os.default.EOL));
    }, language, '');

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt2, ['d', 'resources', appPath]);
      apkStrings = (0, _helpers.parseAapt2Strings)(stdout, configMarker);
    } catch (e) {
      throw new Error(`Cannot extract resources from '${originalAppPath}'. ` + `Original error: ${e.message}`);
    }
  }

  if (_lodash.default.isEmpty(apkStrings)) {
    _logger.default.warn(`No strings have been found in '${originalAppPath}' resources ` + `for '${configMarker || 'default'}' configuration`);
  } else {
    _logger.default.info(`Successfully extracted ${_lodash.default.keys(apkStrings).length} strings from ` + `'${originalAppPath}' resources for '${configMarker || 'default'}' configuration`);
  }

  const localPath = _path.default.resolve(out, 'strings.json');

  await (0, _support.mkdirp)(out);
  await _support.fs.writeFile(localPath, JSON.stringify(apkStrings, null, 2), 'utf-8');
  return {
    apkStrings,
    localPath
  };
};

apkUtilsMethods.getDeviceLanguage = async function getDeviceLanguage() {
  let language;

  if ((await this.getApiLevel()) < 23) {
    language = await this.getDeviceSysLanguage();

    if (!language) {
      language = await this.getDeviceProductLanguage();
    }
  } else {
    language = (await this.getDeviceLocale()).split('-')[0];
  }

  return language;
};

apkUtilsMethods.getDeviceCountry = async function getDeviceCountry() {
  let country = await this.getDeviceSysCountry();

  if (!country) {
    country = await this.getDeviceProductCountry();
  }

  return country;
};

apkUtilsMethods.getDeviceLocale = async function getDeviceLocale() {
  let locale = await this.getDeviceSysLocale();

  if (!locale) {
    locale = await this.getDeviceProductLocale();
  }

  return locale;
};

apkUtilsMethods.setDeviceLocale = async function setDeviceLocale(locale) {
  const validateLocale = new RegExp(/[a-zA-Z]+-[a-zA-Z0-9]+/);

  if (!validateLocale.test(locale)) {
    _logger.default.warn(`setDeviceLocale requires the following format: en-US or ja-JP`);

    return;
  }

  let split_locale = locale.split('-');
  await this.setDeviceLanguageCountry(split_locale[0], split_locale[1]);
};

apkUtilsMethods.ensureCurrentLocale = async function ensureCurrentLocale(language, country, script = null) {
  const hasLanguage = _lodash.default.isString(language);

  const hasCountry = _lodash.default.isString(country);

  if (!hasLanguage && !hasCountry) {
    _logger.default.warn('ensureCurrentLocale requires language or country');

    return false;
  }

  language = (language || '').toLowerCase();
  country = (country || '').toLowerCase();
  const apiLevel = await this.getApiLevel();
  return await (0, _asyncbox.retryInterval)(5, 1000, async () => {
    try {
      if (apiLevel < 23) {
        let curLanguage, curCountry;

        if (hasLanguage) {
          curLanguage = (await this.getDeviceLanguage()).toLowerCase();

          if (!hasCountry && language === curLanguage) {
            return true;
          }
        }

        if (hasCountry) {
          curCountry = (await this.getDeviceCountry()).toLowerCase();

          if (!hasLanguage && country === curCountry) {
            return true;
          }
        }

        if (language === curLanguage && country === curCountry) {
          return true;
        }
      } else {
        const curLocale = (await this.getDeviceLocale()).toLowerCase();
        const localeCode = script ? `${language}-${script.toLowerCase()}-${country}` : `${language}-${country}`;

        if (localeCode === curLocale) {
          _logger.default.debug(`Requested locale is equal to current locale: '${curLocale}'`);

          return true;
        }
      }

      return false;
    } catch (err) {
      _logger.default.error(`Unable to check device localization: ${err.message}`);

      try {
        await this.reconnect();
      } catch (ign) {
        await this.restartAdb();
      }

      throw err;
    }
  });
};

apkUtilsMethods.setDeviceLanguageCountry = async function setDeviceLanguageCountry(language, country, script = null) {
  let hasLanguage = language && _lodash.default.isString(language);

  let hasCountry = country && _lodash.default.isString(country);

  if (!hasLanguage || !hasCountry) {
    _logger.default.warn(`setDeviceLanguageCountry requires language and country at least`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  let apiLevel = await this.getApiLevel();
  language = (language || '').toLowerCase();
  country = (country || '').toUpperCase();

  if (apiLevel < 23) {
    let curLanguage = (await this.getDeviceLanguage()).toLowerCase();
    let curCountry = (await this.getDeviceCountry()).toUpperCase();

    if (language !== curLanguage || country !== curCountry) {
      await this.setDeviceSysLocaleViaSettingApp(language, country);
    }
  } else {
    let curLocale = await this.getDeviceLocale();
    const localeCode = script ? `${language}-${script}-${country}` : `${language}-${country}`;

    _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${localeCode}'`);

    if (localeCode.toLowerCase() !== curLocale.toLowerCase()) {
      await this.setDeviceSysLocaleViaSettingApp(language, country, script);
    }
  }
};

apkUtilsMethods.getApkInfo = async function getApkInfo(appPath) {
  if (!(await _support.fs.exists(appPath))) {
    throw new Error(`The file at path ${appPath} does not exist or is not accessible`);
  }

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }

  try {
    const apkReader = await _adbkitApkreader.default.open(appPath);
    const manifest = await apkReader.readManifest();
    const {
      pkg,
      versionName,
      versionCode
    } = (0, _helpers.parseManifest)(manifest);
    return {
      name: pkg,
      versionCode,
      versionName
    };
  } catch (e) {
    _logger.default.warn(`Error '${e.message}' while getting badging info`);
  }

  return {};
};

apkUtilsMethods.getPackageInfo = async function getPackageInfo(pkg) {
  _logger.default.debug(`Getting package info for '${pkg}'`);

  let result = {
    name: pkg
  };

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const versionNameMatch = new RegExp(/versionName=([\d+.]+)/).exec(stdout);

    if (versionNameMatch) {
      result.versionName = versionNameMatch[1];
    }

    const versionCodeMatch = new RegExp(/versionCode=(\d+)/).exec(stdout);

    if (versionCodeMatch) {
      result.versionCode = parseInt(versionCodeMatch[1], 10);
    }

    return result;
  } catch (err) {
    _logger.default.warn(`Error '${err.message}' while dumping package info`);
  }

  return result;
};

apkUtilsMethods.pullApk = async function pullApk(pkg, tmpDir) {
  const stdout = _lodash.default.trim(await this.shell(['pm', 'path', pkg]));

  const packageMarker = 'package:';

  if (!_lodash.default.startsWith(stdout, packageMarker)) {
    throw new Error(`Cannot pull the .apk package for '${pkg}'. Original error: ${stdout}`);
  }

  const remotePath = stdout.replace(packageMarker, '');

  const tmpApp = _path.default.resolve(tmpDir, `${pkg}.apk`);

  await this.pull(remotePath, tmpApp);

  _logger.default.debug(`Pulled app for package '${pkg}' to '${tmpApp}'`);

  return tmpApp;
};

var _default = apkUtilsMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhcGtVdGlsc01ldGhvZHMiLCJBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LIiwiQVBQX0lOU1RBTExfU1RBVEUiLCJVTktOT1dOIiwiTk9UX0lOU1RBTExFRCIsIk5FV0VSX1ZFUlNJT05fSU5TVEFMTEVEIiwiU0FNRV9WRVJTSU9OX0lOU1RBTExFRCIsIk9MREVSX1ZFUlNJT05fSU5TVEFMTEVEIiwiUkVNT1RFX0NBQ0hFX1JPT1QiLCJpc0FwcEluc3RhbGxlZCIsInBrZyIsImxvZyIsImRlYnVnIiwiaW5zdGFsbGVkUGF0dGVybiIsIlJlZ0V4cCIsIl8iLCJlc2NhcGVSZWdFeHAiLCJzdGRvdXQiLCJzaGVsbCIsImlzSW5zdGFsbGVkIiwidGVzdCIsImUiLCJFcnJvciIsIm1lc3NhZ2UiLCJzdGFydFVyaSIsInVyaSIsIm9wdHMiLCJ3YWl0Rm9yTGF1bmNoIiwiYXJncyIsInB1c2giLCJlc2NhcGVTaGVsbEFyZyIsInJlcyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJzdGFydEFwcCIsInN0YXJ0QXBwT3B0aW9ucyIsImFjdGl2aXR5IiwiYWN0aW9uIiwiY2xvbmUiLCJyZXBsYWNlIiwiZGVmYXVsdHMiLCJ3YWl0UGtnIiwid2FpdEFjdGl2aXR5IiwicmV0cnkiLCJzdG9wQXBwIiwiYXBpTGV2ZWwiLCJnZXRBcGlMZXZlbCIsImNtZCIsImJ1aWxkU3RhcnRDbWQiLCJpbnRlbnROYW1lIiwib3B0aW9uYWxJbnRlbnRBcmd1bWVudHMiLCJzaGVsbE9wdHMiLCJpc0ludGVnZXIiLCJ3YWl0RHVyYXRpb24iLCJ0aW1lb3V0Iiwic3RhcnRzV2l0aCIsIndhaXRGb3JBY3Rpdml0eSIsImFwcERlc2NyaXB0b3IiLCJkdW1wV2luZG93cyIsImR1bXBzeXNBcmciLCJnZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5IiwibnVsbEZvY3VzZWRBcHBSZSIsImZvY3VzZWRBcHBSZSIsIm51bGxDdXJyZW50Rm9jdXNSZSIsImN1cnJlbnRGb2N1c0FwcFJlIiwiZm9jdXNlZEFwcENhbmRpZGF0ZXMiLCJjdXJyZW50Rm9jdXNBcHBDYW5kaWRhdGVzIiwiY2FuZGlkYXRlcyIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJhcHBQYWNrYWdlIiwidHJpbSIsImFwcEFjdGl2aXR5IiwibGVuZ3RoIiwiaW50ZXJzZWN0aW9uV2l0aCIsImlzRXF1YWwiLCJ3YWl0Rm9yQWN0aXZpdHlPck5vdCIsIndhaXRGb3JTdG9wIiwid2FpdE1zIiwic3BsaXROYW1lcyIsIm5hbWVzIiwic3BsaXQiLCJtYXAiLCJuYW1lIiwiYWxsUGFja2FnZXMiLCJhbGxBY3Rpdml0aWVzIiwicG9zc2libGVBY3Rpdml0eU5hbWVzIiwib25lQWN0aXZpdHkiLCJjdXJyZW50UGtnIiwiam9pbiIsInBvc3NpYmxlQWN0aXZpdHlQYXR0ZXJucyIsImFjdE5hbWUiLCJjb25kaXRpb25GdW5jIiwiZnVsbHlRdWFsaWZpZWRBY3Rpdml0eSIsImlzQWN0aXZpdHlGb3VuZCIsInNvbWUiLCJwIiwid2FpdEZvckNvbmRpdGlvbiIsInBhcnNlSW50IiwiaW50ZXJ2YWxNcyIsImFjdCIsIndhaXRGb3JOb3RBY3Rpdml0eSIsInVuaW5zdGFsbEFwayIsIm9wdGlvbnMiLCJpbmZvIiwia2VlcERhdGEiLCJmb3JjZVN0b3AiLCJhZGJFeGVjIiwiaW5zdGFsbEZyb21EZXZpY2VQYXRoIiwiYXBrUGF0aE9uRGV2aWNlIiwiaW5kZXhPZiIsImNhY2hlQXBrIiwiYXBrUGF0aCIsImFwcEhhc2giLCJmcyIsImhhc2giLCJyZW1vdGVQYXRoIiwicGF0aCIsInBvc2l4IiwicmVtb3RlQ2FjaGVkRmlsZXMiLCJlcnJvck1hcmtlciIsImxzT3V0cHV0IiwiX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkIiwiaXNCb29sZWFuIiwiaXNTdHJpbmciLCJzdWJzdHJpbmciLCJ4IiwiZmlsdGVyIiwiQm9vbGVhbiIsInRvSGFzaCIsInBhcnNlIiwiY2F0Y2giLCJ0aW1lciIsInRpbWluZyIsIlRpbWVyIiwic3RhcnQiLCJzaXplIiwic3RhdCIsImJhc2VuYW1lIiwidXRpbCIsInRvUmVhZGFibGVTaXplU3RyaW5nIiwiZ2V0RHVyYXRpb24iLCJhc01pbGxpU2Vjb25kcyIsInRvRml4ZWQiLCJyZW1vdGVBcHBzQ2FjaGUiLCJMUlUiLCJtYXgiLCJyZW1vdGVBcHBzQ2FjaGVMaW1pdCIsImRpZmZlcmVuY2UiLCJrZXlzIiwiZm9yRWFjaCIsImRlbCIsInNldCIsImVudHJpZXNUb0NsZWFudXAiLCJoYXMiLCJzbGljZSIsImlzRW1wdHkiLCJ3YXJuIiwiaW5zdGFsbCIsImFwcFBhdGgiLCJlbmRzV2l0aCIsIkFQS1NfRVhURU5TSU9OIiwiaW5zdGFsbEFwa3MiLCJjbG9uZURlZXAiLCJhZGJFeGVjVGltZW91dCIsIkRFRkFVTFRfQURCX0VYRUNfVElNRU9VVCIsIkFQS19JTlNUQUxMX1RJTUVPVVQiLCJ0aW1lb3V0Q2FwTmFtZSIsImluc3RhbGxBcmdzIiwiYnVpbGRJbnN0YWxsQXJncyIsIm5vSW5jcmVtZW50YWwiLCJpc0luY3JlbWVudGFsSW5zdGFsbFN1cHBvcnRlZCIsImluc3RhbGxPcHRzIiwiaW5zdGFsbENtZCIsInBlcmZvcm1BcHBJbnN0YWxsIiwic2hvdWxkQ2FjaGVBcHAiLCJpc1N0cmVhbWVkSW5zdGFsbFN1cHBvcnRlZCIsImNsZWFyQ2FjaGUiLCJjYWNoZUFwcCIsImNhY2hlZEFwcFBhdGgiLCJwbUluc3RhbGxDbWRCeVJlbW90ZVBhdGgiLCJvdXRwdXQiLCJuZXdDYWNoZWRBcHBQYXRoIiwidHJ1bmNhdGVkT3V0cHV0Iiwic3Vic3RyIiwiaXNUZXN0UGFja2FnZU9ubHlFcnJvciIsIm1zZyIsImVyciIsImdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlIiwiYXBrSW5mbyIsImdldEFwa0luZm8iLCJ2ZXJzaW9uQ29kZSIsInBrZ1ZlcnNpb25Db2RlIiwidmVyc2lvbk5hbWUiLCJwa2dWZXJzaW9uTmFtZVN0ciIsImdldFBhY2thZ2VJbmZvIiwicGtnVmVyc2lvbk5hbWUiLCJzZW12ZXIiLCJ2YWxpZCIsImNvZXJjZSIsImFwa1ZlcnNpb25Db2RlIiwiYXBrVmVyc2lvbk5hbWVTdHIiLCJhcGtWZXJzaW9uTmFtZSIsInNhdGlzZmllcyIsImluc3RhbGxPclVwZ3JhZGUiLCJlbmZvcmNlQ3VycmVudEJ1aWxkIiwiYXBwU3RhdGUiLCJ3YXNVbmluc3RhbGxlZCIsInVuaW5zdGFsbFBhY2thZ2UiLCJPYmplY3QiLCJhc3NpZ24iLCJleHRyYWN0U3RyaW5nc0Zyb21BcGsiLCJsYW5ndWFnZSIsIm91dCIsIm9yaWdpbmFsQXBwUGF0aCIsImV4dHJhY3RMYW5ndWFnZUFwayIsImFwa1N0cmluZ3MiLCJjb25maWdNYXJrZXIiLCJpbml0QWFwdCIsImZvcm1hdENvbmZpZ01hcmtlciIsImJpbmFyaWVzIiwiYWFwdCIsInVuaXEiLCJvcyIsIkVPTCIsInBhcnNlQWFwdFN0cmluZ3MiLCJzdGRlcnIiLCJpbml0QWFwdDIiLCJhYXB0MiIsInBhcnNlQWFwdDJTdHJpbmdzIiwibG9jYWxQYXRoIiwicmVzb2x2ZSIsIm1rZGlycCIsIndyaXRlRmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXREZXZpY2VMYW5ndWFnZSIsImdldERldmljZVN5c0xhbmd1YWdlIiwiZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlIiwiZ2V0RGV2aWNlTG9jYWxlIiwiZ2V0RGV2aWNlQ291bnRyeSIsImNvdW50cnkiLCJnZXREZXZpY2VTeXNDb3VudHJ5IiwiZ2V0RGV2aWNlUHJvZHVjdENvdW50cnkiLCJsb2NhbGUiLCJnZXREZXZpY2VTeXNMb2NhbGUiLCJnZXREZXZpY2VQcm9kdWN0TG9jYWxlIiwic2V0RGV2aWNlTG9jYWxlIiwidmFsaWRhdGVMb2NhbGUiLCJzcGxpdF9sb2NhbGUiLCJzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkiLCJlbnN1cmVDdXJyZW50TG9jYWxlIiwic2NyaXB0IiwiaGFzTGFuZ3VhZ2UiLCJoYXNDb3VudHJ5IiwicmV0cnlJbnRlcnZhbCIsImN1ckxhbmd1YWdlIiwiY3VyQ291bnRyeSIsImN1ckxvY2FsZSIsImxvY2FsZUNvZGUiLCJlcnJvciIsInJlY29ubmVjdCIsImlnbiIsInJlc3RhcnRBZGIiLCJ0b1VwcGVyQ2FzZSIsInNldERldmljZVN5c0xvY2FsZVZpYVNldHRpbmdBcHAiLCJleGlzdHMiLCJleHRyYWN0QmFzZUFwayIsImFwa1JlYWRlciIsIkFwa1JlYWRlciIsIm9wZW4iLCJtYW5pZmVzdCIsInJlYWRNYW5pZmVzdCIsInBhcnNlTWFuaWZlc3QiLCJyZXN1bHQiLCJ2ZXJzaW9uTmFtZU1hdGNoIiwidmVyc2lvbkNvZGVNYXRjaCIsInB1bGxBcGsiLCJ0bXBEaXIiLCJwYWNrYWdlTWFya2VyIiwidG1wQXBwIiwicHVsbCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi90b29scy9hcGstdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgYnVpbGRTdGFydENtZCwgQVBLU19FWFRFTlNJT04sIGJ1aWxkSW5zdGFsbEFyZ3MsXG4gIEFQS19JTlNUQUxMX1RJTUVPVVQsIERFRkFVTFRfQURCX0VYRUNfVElNRU9VVCxcbiAgcGFyc2VNYW5pZmVzdCwgcGFyc2VBYXB0U3RyaW5ncywgcGFyc2VBYXB0MlN0cmluZ3MsIGZvcm1hdENvbmZpZ01hcmtlcixcbiAgZXNjYXBlU2hlbGxBcmcsXG59IGZyb20gJy4uL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsLCB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgZnMsIHV0aWwsIG1rZGlycCwgdGltaW5nIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgTFJVIGZyb20gJ2xydS1jYWNoZSc7XG5pbXBvcnQgQXBrUmVhZGVyIGZyb20gJ2FkYmtpdC1hcGtyZWFkZXInO1xuXG5jb25zdCBhcGtVdGlsc01ldGhvZHMgPSB7fTtcblxuY29uc3QgQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyA9XG4gICdodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9ibG9iL21hc3Rlci9kb2NzL2VuL3dyaXRpbmctcnVubmluZy1hcHBpdW0vYW5kcm9pZC9hY3Rpdml0eS1zdGFydHVwLm1kJztcbmFwa1V0aWxzTWV0aG9kcy5BUFBfSU5TVEFMTF9TVEFURSA9IHtcbiAgVU5LTk9XTjogJ3Vua25vd24nLFxuICBOT1RfSU5TVEFMTEVEOiAnbm90SW5zdGFsbGVkJyxcbiAgTkVXRVJfVkVSU0lPTl9JTlNUQUxMRUQ6ICduZXdlclZlcnNpb25JbnN0YWxsZWQnLFxuICBTQU1FX1ZFUlNJT05fSU5TVEFMTEVEOiAnc2FtZVZlcnNpb25JbnN0YWxsZWQnLFxuICBPTERFUl9WRVJTSU9OX0lOU1RBTExFRDogJ29sZGVyVmVyc2lvbkluc3RhbGxlZCcsXG59O1xuY29uc3QgUkVNT1RFX0NBQ0hFX1JPT1QgPSAnL2RhdGEvbG9jYWwvdG1wL2FwcGl1bV9jYWNoZSc7XG5cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSBwYXJ0aWN1bGFyIHBhY2thZ2UgaXMgcHJlc2VudCBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcGFja2FnZSBpcyBpbnN0YWxsZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGRldGVjdGluZyBhcHBsaWNhdGlvbiBzdGF0ZVxuICovXG5hcGtVdGlsc01ldGhvZHMuaXNBcHBJbnN0YWxsZWQgPSBhc3luYyBmdW5jdGlvbiBpc0FwcEluc3RhbGxlZCAocGtnKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBpbnN0YWxsIHN0YXR1cyBmb3IgJHtwa2d9YCk7XG4gIGNvbnN0IGluc3RhbGxlZFBhdHRlcm4gPSBuZXcgUmVnRXhwKGBeXFxcXHMqUGFja2FnZVxcXFxzK1xcXFxbJHtfLmVzY2FwZVJlZ0V4cChwa2cpfVxcXFxdW146XSs6JGAsICdtJyk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ2R1bXBzeXMnLCAncGFja2FnZScsIHBrZ10pO1xuICAgIGNvbnN0IGlzSW5zdGFsbGVkID0gaW5zdGFsbGVkUGF0dGVybi50ZXN0KHN0ZG91dCk7XG4gICAgbG9nLmRlYnVnKGAnJHtwa2d9JyBpcyR7IWlzSW5zdGFsbGVkID8gJyBub3QnIDogJyd9IGluc3RhbGxlZGApO1xuICAgIHJldHVybiBpc0luc3RhbGxlZDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZmluZGluZyBpZiAnJHtwa2d9JyBpcyBpbnN0YWxsZWQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTdGFydFVyaU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHdhaXRGb3JMYXVuY2ggW3RydWVdIC0gaWYgYGZhbHNlYCB0aGVuIGFkYiB3b24ndCB3YWl0XG4gKiBmb3IgdGhlIHN0YXJ0ZWQgYWN0aXZpdHkgdG8gcmV0dXJuIHRoZSBjb250cm9sXG4gKi9cblxuLyoqXG4gKiBTdGFydCB0aGUgcGFydGljdWxhciBVUkkgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgLSBUaGUgbmFtZSBvZiBVUkkgdG8gc3RhcnQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gc3RhcnQgdGhlIFVSSSB3aXRoLlxuICogQHBhcmFtIHtTdGFydFVyaU9wdGlvbnN9IG9wdHNcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnN0YXJ0VXJpID0gYXN5bmMgZnVuY3Rpb24gc3RhcnRVcmkgKHVyaSwgcGtnLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHdhaXRGb3JMYXVuY2ggPSB0cnVlLFxuICB9ID0gb3B0cztcblxuICBpZiAoIXVyaSB8fCAhcGtnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVUkkgYW5kIHBhY2thZ2UgYXJndW1lbnRzIGFyZSByZXF1aXJlZCcpO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFsnYW0nLCAnc3RhcnQnXTtcbiAgaWYgKHdhaXRGb3JMYXVuY2gpIHtcbiAgICBhcmdzLnB1c2goJy1XJyk7XG4gIH1cbiAgYXJncy5wdXNoKCctYScsICdhbmRyb2lkLmludGVudC5hY3Rpb24uVklFVycsXG4gICAgJy1kJywgZXNjYXBlU2hlbGxBcmcodXJpKSxcbiAgICBwa2cpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zaGVsbChhcmdzKTtcbiAgICBpZiAocmVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3VuYWJsZSB0byByZXNvbHZlIGludGVudCcpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGF0dGVtcHRpbmcgdG8gc3RhcnQgVVJJLiBPcmlnaW5hbCBlcnJvcjogJHtlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0QXBwT3B0aW9uc1xuICogQHByb3BlcnR5IHshc3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgYXBwbGljYXRpb24gcGFja2FnZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5LlxuICogVGhpcyBvciBhY3Rpb24gaXMgcmVxdWlyZWQgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBsYXVuY2ggYW4gYXBwLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhY3Rpb24gLSBUaGUgbmFtZSBvZiB0aGUgaW50ZW50IGFjdGlvbiB0aGF0IHdpbGwgbGF1bmNoIHRoZSByZXF1aXJlZCBhcHAuXG4gKiBUaGlzIG9yIGFjdGl2aXR5IGlzIHJlcXVpcmVkIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gbGF1bmNoIGFuIGFwcC5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHJldHJ5IFt0cnVlXSAtIElmIHRoaXMgcHJvcGVydHkgaXMgc2V0IHRvIGB0cnVlYFxuICogYW5kIHRoZSBhY3Rpdml0eSBuYW1lIGRvZXMgbm90IHN0YXJ0IHdpdGggJy4nIHRoZW4gdGhlIG1ldGhvZFxuICogd2lsbCB0cnkgdG8gYWRkIHRoZSBtaXNzaW5nIGRvdCBhbmQgc3RhcnQgdGhlIGFjdGl2aXR5IG9uY2UgbW9yZVxuICogaWYgdGhlIGZpcnN0IHN0YXJ0dXAgdHJ5IGZhaWxzLlxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gc3RvcEFwcCBbdHJ1ZV0gLSBTZXQgaXQgdG8gYHRydWVgIGluIG9yZGVyIHRvIGZvcmNlZnVsbHlcbiAqIHN0b3AgdGhlIGFjdGl2aXR5IGlmIGl0IGlzIGFscmVhZHkgcnVubmluZy5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gd2FpdFBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgdG8gb25cbiAqIHN0YXJ0dXAgKHRoaXMgb25seSBtYWtlcyBzZW5zZSBpZiB0aGlzIG5hbWUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSwgd2hpY2ggaXMgc2V0IGFzIGBwa2dgKVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB3YWl0QWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHkgdG8gd2FpdCB0byBvblxuICogc3RhcnR1cCAodGhpcyBvbmx5IG1ha2VzIHNlbnNlIGlmIHRoaXMgbmFtZSBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgb25lLCB3aGljaCBpcyBzZXQgYXMgYGFjdGl2aXR5YClcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gd2FpdER1cmF0aW9uIC0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqIGB3YWl0QWN0aXZpdHlgIGlzIGZvY3VzZWRcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xudW1iZXJ9IHVzZXIgLSBUaGUgbnVtYmVyIG9mIHRoZSB1c2VyIHByb2ZpbGUgdG8gc3RhcnRcbiAqIHRoZSBnaXZlbiBhY3Rpdml0eSB3aXRoLiBUaGUgZGVmYXVsdCBPUyB1c2VyIHByb2ZpbGUgKHVzdWFsbHkgemVybykgaXMgdXNlZFxuICogd2hlbiB0aGlzIHByb3BlcnR5IGlzIHVuc2V0XG4gKiBAcHJvcGVydHkgez9ib29sZWFufSB3YWl0Rm9yTGF1bmNoIFt0cnVlXSAtIGlmIGBmYWxzZWAgdGhlbiBhZGIgd29uJ3Qgd2FpdFxuICogZm9yIHRoZSBzdGFydGVkIGFjdGl2aXR5IHRvIHJldHVybiB0aGUgY29udHJvbFxuICovXG5cbi8qKlxuICogU3RhcnQgdGhlIHBhcnRpY3VsYXIgcGFja2FnZS9hY3Rpdml0eSBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtTdGFydEFwcE9wdGlvbnN9IHN0YXJ0QXBwT3B0aW9ucyBbe31dIC0gU3RhcnR1cCBvcHRpb25zIG1hcHBpbmcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBvdXRwdXQgb2YgdGhlIGNvcnJlc3BvbmRpbmcgYWRiIGNvbW1hbmQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgYW4gZXJyb3Igd2hpbGUgZXhlY3V0aW5nIHRoZSBhY3Rpdml0eVxuICovXG5hcGtVdGlsc01ldGhvZHMuc3RhcnRBcHAgPSBhc3luYyBmdW5jdGlvbiBzdGFydEFwcCAoc3RhcnRBcHBPcHRpb25zID0ge30pIHtcbiAgaWYgKCFzdGFydEFwcE9wdGlvbnMucGtnIHx8ICEoc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5IHx8IHN0YXJ0QXBwT3B0aW9ucy5hY3Rpb24pKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwa2csIGFuZCBhY3Rpdml0eSBvciBpbnRlbnQgYWN0aW9uLCBhcmUgcmVxdWlyZWQgdG8gc3RhcnQgYW4gYXBwbGljYXRpb24nKTtcbiAgfVxuXG4gIHN0YXJ0QXBwT3B0aW9ucyA9IF8uY2xvbmUoc3RhcnRBcHBPcHRpb25zKTtcbiAgaWYgKHN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eSkge1xuICAgIHN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eSA9IHN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eS5yZXBsYWNlKCckJywgJ1xcXFwkJyk7XG4gIH1cbiAgLy8gaW5pdGlhbGl6aW5nIGRlZmF1bHRzXG4gIF8uZGVmYXVsdHMoc3RhcnRBcHBPcHRpb25zLCB7XG4gICAgd2FpdFBrZzogc3RhcnRBcHBPcHRpb25zLnBrZyxcbiAgICB3YWl0Rm9yTGF1bmNoOiB0cnVlLFxuICAgIHdhaXRBY3Rpdml0eTogZmFsc2UsXG4gICAgcmV0cnk6IHRydWUsXG4gICAgc3RvcEFwcDogdHJ1ZVxuICB9KTtcbiAgLy8gcHJldmVudGluZyBudWxsIHdhaXRwa2dcbiAgc3RhcnRBcHBPcHRpb25zLndhaXRQa2cgPSBzdGFydEFwcE9wdGlvbnMud2FpdFBrZyB8fCBzdGFydEFwcE9wdGlvbnMucGtnO1xuXG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuICBjb25zdCBjbWQgPSBidWlsZFN0YXJ0Q21kKHN0YXJ0QXBwT3B0aW9ucywgYXBpTGV2ZWwpO1xuICBjb25zdCBpbnRlbnROYW1lID0gYCR7c3RhcnRBcHBPcHRpb25zLmFjdGlvbn0ke3N0YXJ0QXBwT3B0aW9ucy5vcHRpb25hbEludGVudEFyZ3VtZW50cyA/ICcgJyArIHN0YXJ0QXBwT3B0aW9ucy5vcHRpb25hbEludGVudEFyZ3VtZW50cyA6ICcnfWA7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2hlbGxPcHRzID0ge307XG4gICAgaWYgKF8uaXNJbnRlZ2VyKHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pICYmIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24gPj0gMCkge1xuICAgICAgc2hlbGxPcHRzLnRpbWVvdXQgPSBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uO1xuICAgIH1cbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKGNtZCwgc2hlbGxPcHRzKTtcbiAgICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdFcnJvcjogQWN0aXZpdHkgY2xhc3MnKSAmJiBzdGRvdXQuaW5jbHVkZXMoJ2RvZXMgbm90IGV4aXN0JykpIHtcbiAgICAgIGlmIChzdGFydEFwcE9wdGlvbnMucmV0cnkgJiYgIXN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eS5zdGFydHNXaXRoKCcuJykpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBXZSB0cmllZCB0byBzdGFydCBhbiBhY3Rpdml0eSB0aGF0IGRvZXNuJ3QgZXhpc3QsIGAgK1xuICAgICAgICAgICAgICAgICAgYHJldHJ5aW5nIHdpdGggJy4ke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IG5hbWVgKTtcbiAgICAgICAgc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5ID0gYC4ke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX1gO1xuICAgICAgICBzdGFydEFwcE9wdGlvbnMucmV0cnkgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc3RhcnRBcHAoc3RhcnRBcHBPcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgQWN0aXZpdHkgbmFtZSAnJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyB1c2VkIHRvIHN0YXJ0IHRoZSBhcHAgZG9lc24ndCBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgZXhpc3Qgb3IgY2Fubm90IGJlIGxhdW5jaGVkISBNYWtlIHN1cmUgaXQgZXhpc3RzIGFuZCBpcyBhIGxhdW5jaGFibGUgYWN0aXZpdHlgKTtcbiAgICB9IGVsc2UgaWYgKHN0ZG91dC5pbmNsdWRlcygnRXJyb3I6IEludGVudCBkb2VzIG5vdCBtYXRjaCBhbnkgYWN0aXZpdGllcycpIHx8IHN0ZG91dC5pbmNsdWRlcygnRXJyb3I6IEFjdGl2aXR5IG5vdCBzdGFydGVkLCB1bmFibGUgdG8gcmVzb2x2ZSBJbnRlbnQnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBY3Rpdml0eSBmb3IgaW50ZW50ICcke2ludGVudE5hbWV9JyB1c2VkIHRvIHN0YXJ0IHRoZSBhcHAgZG9lc24ndCBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgZXhpc3Qgb3IgY2Fubm90IGJlIGxhdW5jaGVkISBNYWtlIHN1cmUgaXQgZXhpc3RzIGFuZCBpcyBhIGxhdW5jaGFibGUgYWN0aXZpdHlgKTtcbiAgICB9IGVsc2UgaWYgKHN0ZG91dC5pbmNsdWRlcygnamF2YS5sYW5nLlNlY3VyaXR5RXhjZXB0aW9uJykpIHtcbiAgICAgIC8vIGlmIHRoZSBhcHAgaXMgZGlzYWJsZWQgb24gYSByZWFsIGRldmljZSBpdCB3aWxsIHRocm93IGEgc2VjdXJpdHkgZXhjZXB0aW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBwZXJtaXNzaW9uIHRvIHN0YXJ0ICcke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IGhhcyBiZWVuIGRlbmllZC5gICtcbiAgICAgICAgICAgICAgICAgICAgICBgTWFrZSBzdXJlIHRoZSBhY3Rpdml0eS9wYWNrYWdlIG5hbWVzIGFyZSBjb3JyZWN0LmApO1xuICAgIH1cbiAgICBpZiAoc3RhcnRBcHBPcHRpb25zLndhaXRBY3Rpdml0eSkge1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHkoc3RhcnRBcHBPcHRpb25zLndhaXRQa2csIHN0YXJ0QXBwT3B0aW9ucy53YWl0QWN0aXZpdHksIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pO1xuICAgIH1cbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc3QgYXBwRGVzY3JpcHRvciA9IHN0YXJ0QXBwT3B0aW9ucy5wa2cgfHwgaW50ZW50TmFtZTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzdGFydCB0aGUgJyR7YXBwRGVzY3JpcHRvcn0nIGFwcGxpY2F0aW9uLiBgICtcbiAgICAgIGBWaXNpdCAke0FDVElWSVRJRVNfVFJPVUJMRVNIT09USU5HX0xJTkt9IGZvciB0cm91Ymxlc2hvb3RpbmcuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBIZWxwZXIgbWV0aG9kIHRvIGNhbGwgYGFkYiBkdW1wc3lzIHdpbmRvdyB3aW5kb3dzL2Rpc3BsYXlzYFxuICovXG5hcGtVdGlsc01ldGhvZHMuZHVtcFdpbmRvd3MgPSBhc3luYyBmdW5jdGlvbiBkdW1wV2luZG93cyAoKSB7XG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuXG4gIC8vIFdpdGggdmVyc2lvbiAyOSwgQW5kcm9pZCBjaGFuZ2VkIHRoZSBkdW1wc3lzIHN5bnRheFxuICBjb25zdCBkdW1wc3lzQXJnID0gYXBpTGV2ZWwgPj0gMjkgPyAnZGlzcGxheXMnIDogJ3dpbmRvd3MnO1xuICBjb25zdCBjbWQgPSBbJ2R1bXBzeXMnLCAnd2luZG93JywgZHVtcHN5c0FyZ107XG5cbiAgcmV0dXJuIGF3YWl0IHRoaXMuc2hlbGwoY21kKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUGFja2FnZUFjdGl2aXR5SW5mb1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhcHBQYWNrYWdlIC0gVGhlIG5hbWUgb2YgYXBwbGljYXRpb24gcGFja2FnZSxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICdjb20uYWNtZS5hcHAnLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhcHBBY3Rpdml0eSAtIFRoZSBuYW1lIG9mIG1haW4gYXBwbGljYXRpb24gYWN0aXZpdHkuXG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIG5hbWUgb2YgY3VycmVudGx5IGZvY3VzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHkuXG4gKlxuICogQHJldHVybiB7UGFja2FnZUFjdGl2aXR5SW5mb30gVGhlIG1hcHBpbmcsIHdoZXJlIHByb3BlcnR5IG5hbWVzIGFyZSAnYXBwUGFja2FnZScgYW5kICdhcHBBY3Rpdml0eScuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgYW4gZXJyb3Igd2hpbGUgcGFyc2luZyB0aGUgZGF0YS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiBnZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5ICgpIHtcbiAgbG9nLmRlYnVnKCdHZXR0aW5nIGZvY3VzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHknKTtcbiAgbGV0IHN0ZG91dDtcbiAgdHJ5IHtcbiAgICBzdGRvdXQgPSBhd2FpdCB0aGlzLmR1bXBXaW5kb3dzKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgQ291bGQgbm90IHJldHJpZXZlIHRoZSBjdXJyZW50bHkgZm9jdXNlZCBwYWNrYWdlIGFuZCBhY3Rpdml0eS4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWBcbiAgICApO1xuICB9XG5cbiAgY29uc3QgbnVsbEZvY3VzZWRBcHBSZSA9IC9eXFxzKm1Gb2N1c2VkQXBwPW51bGwvbTtcbiAgLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci94Wjh2RjcvMVxuICBjb25zdCBmb2N1c2VkQXBwUmUgPSBuZXcgUmVnRXhwKFxuICAgICdeXFxcXHMqbUZvY3VzZWRBcHAuK1JlY29yZFxcXFx7LipcXFxccyhbXlxcXFxzXFxcXC9cXFxcfV0rKVxcXFwvKFteXFxcXHNcXFxcL1xcXFx9XFxcXCxdKylcXFxcLD8oXFxcXHNbXlxcXFxzXFxcXC9cXFxcfV0rKSpcXFxcfScsXG4gICAgJ21nJ1xuICApO1xuICBjb25zdCBudWxsQ3VycmVudEZvY3VzUmUgPSAvXlxccyptQ3VycmVudEZvY3VzPW51bGwvbTtcbiAgY29uc3QgY3VycmVudEZvY3VzQXBwUmUgPSBuZXcgUmVnRXhwKCdeXFxcXHMqbUN1cnJlbnRGb2N1cy4rXFxcXHsuK1xcXFxzKFteXFxcXHNcXFxcL10rKVxcXFwvKFteXFxcXHNdKylcXFxcYicsICdtZycpO1xuXG4gIGNvbnN0IGZvY3VzZWRBcHBDYW5kaWRhdGVzID0gW107XG4gIGNvbnN0IGN1cnJlbnRGb2N1c0FwcENhbmRpZGF0ZXMgPSBbXTtcbiAgZm9yIChjb25zdCBbY2FuZGlkYXRlcywgcGF0dGVybl0gb2YgW1xuICAgIFtmb2N1c2VkQXBwQ2FuZGlkYXRlcywgZm9jdXNlZEFwcFJlXSxcbiAgICBbY3VycmVudEZvY3VzQXBwQ2FuZGlkYXRlcywgY3VycmVudEZvY3VzQXBwUmVdXG4gIF0pIHtcbiAgICBsZXQgbWF0Y2g7XG4gICAgd2hpbGUgKChtYXRjaCA9IHBhdHRlcm4uZXhlYyhzdGRvdXQpKSkge1xuICAgICAgY2FuZGlkYXRlcy5wdXNoKHtcbiAgICAgICAgYXBwUGFja2FnZTogbWF0Y2hbMV0udHJpbSgpLFxuICAgICAgICBhcHBBY3Rpdml0eTogbWF0Y2hbMl0udHJpbSgpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgaWYgKGZvY3VzZWRBcHBDYW5kaWRhdGVzLmxlbmd0aCA+IDEgJiYgY3VycmVudEZvY3VzQXBwQ2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzE3MTA2XG4gICAgcmV0dXJuIF8uaW50ZXJzZWN0aW9uV2l0aChmb2N1c2VkQXBwQ2FuZGlkYXRlcywgY3VycmVudEZvY3VzQXBwQ2FuZGlkYXRlcywgXy5pc0VxdWFsKVswXVxuICAgICAgPz8gZm9jdXNlZEFwcENhbmRpZGF0ZXNbMF07XG4gIH1cbiAgaWYgKGZvY3VzZWRBcHBDYW5kaWRhdGVzLmxlbmd0aCA+IDAgfHwgY3VycmVudEZvY3VzQXBwQ2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIGZvY3VzZWRBcHBDYW5kaWRhdGVzWzBdID8/IGN1cnJlbnRGb2N1c0FwcENhbmRpZGF0ZXNbMF07XG4gIH1cblxuICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgW251bGxGb2N1c2VkQXBwUmUsIG51bGxDdXJyZW50Rm9jdXNSZV0pIHtcbiAgICBpZiAocGF0dGVybi5leGVjKHN0ZG91dCkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcFBhY2thZ2U6IG51bGwsXG4gICAgICAgIGFwcEFjdGl2aXR5OiBudWxsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGxvZy5kZWJ1ZyhzdGRvdXQpO1xuICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCByZXRyaWV2ZSB0aGUgY3VycmVudGx5IGZvY3VzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHknKTtcbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWQvbm9uLWZvY3VzZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHdhaXRGb3JTdG9wIC0gV2hldGhlciB0byB3YWl0IHVudGlsIHRoZSBhY3Rpdml0eSBpcyBmb2N1c2VkICh0cnVlKVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGlzIG5vdCBmb2N1c2VkIChmYWxzZSkuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JBY3Rpdml0eU9yTm90ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckFjdGl2aXR5T3JOb3QgKHBrZywgYWN0aXZpdHksIHdhaXRGb3JTdG9wLCB3YWl0TXMgPSAyMDAwMCkge1xuICBpZiAoIXBrZyB8fCAhYWN0aXZpdHkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhY2thZ2UgYW5kIGFjdGl2aXR5IHJlcXVpcmVkLicpO1xuICB9XG4gIGxvZy5kZWJ1ZyhgV2FpdGluZyB1cCB0byAke3dhaXRNc31tcyBmb3IgYWN0aXZpdHkgbWF0Y2hpbmcgcGtnOiAnJHtwa2d9JyBhbmQgYCArXG4gICAgICAgICAgICBgYWN0aXZpdHk6ICcke2FjdGl2aXR5fScgdG8ke3dhaXRGb3JTdG9wID8gJyBub3QnIDogJyd9IGJlIGZvY3VzZWRgKTtcblxuICBjb25zdCBzcGxpdE5hbWVzID0gKG5hbWVzKSA9PiBuYW1lcy5zcGxpdCgnLCcpLm1hcCgobmFtZSkgPT4gbmFtZS50cmltKCkpO1xuICBjb25zdCBhbGxQYWNrYWdlcyA9IHNwbGl0TmFtZXMocGtnKTtcbiAgY29uc3QgYWxsQWN0aXZpdGllcyA9IHNwbGl0TmFtZXMoYWN0aXZpdHkpO1xuXG4gIGNvbnN0IHBvc3NpYmxlQWN0aXZpdHlOYW1lcyA9IFtdO1xuICBmb3IgKGNvbnN0IG9uZUFjdGl2aXR5IG9mIGFsbEFjdGl2aXRpZXMpIHtcbiAgICBpZiAob25lQWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpKSB7XG4gICAgICAvLyBhZGQgdGhlIHBhY2thZ2UgbmFtZSBpZiBhY3Rpdml0eSBpcyBub3QgZnVsbCBxdWFsaWZpZWRcbiAgICAgIGZvciAoY29uc3QgY3VycmVudFBrZyBvZiBhbGxQYWNrYWdlcykge1xuICAgICAgICBwb3NzaWJsZUFjdGl2aXR5TmFtZXMucHVzaChgJHtjdXJyZW50UGtnfSR7b25lQWN0aXZpdHl9YC5yZXBsYWNlKC9cXC4rL2csICcuJykpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBhY2NlcHQgZnVsbHkgcXVhbGlmaWVkIGFjdGl2aXR5IG5hbWUuXG4gICAgICBwb3NzaWJsZUFjdGl2aXR5TmFtZXMucHVzaChvbmVBY3Rpdml0eSk7XG4gICAgICBwb3NzaWJsZUFjdGl2aXR5TmFtZXMucHVzaChgJHtwa2d9LiR7b25lQWN0aXZpdHl9YCk7XG4gICAgfVxuICB9XG4gIGxvZy5kZWJ1ZyhgUG9zc2libGUgYWN0aXZpdGllcywgdG8gYmUgY2hlY2tlZDogJHtwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChuYW1lKSA9PiBgJyR7bmFtZX0nYCkuam9pbignLCAnKX1gKTtcblxuICBjb25zdCBwb3NzaWJsZUFjdGl2aXR5UGF0dGVybnMgPSBwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKFxuICAgIChhY3ROYW1lKSA9PiBuZXcgUmVnRXhwKGBeJHthY3ROYW1lLnJlcGxhY2UoL1xcLi9nLCAnXFxcXC4nKS5yZXBsYWNlKC9cXCovZywgJy4qPycpLnJlcGxhY2UoL1xcJC9nLCAnXFxcXCQnKX0kYClcbiAgKTtcblxuICBjb25zdCBjb25kaXRpb25GdW5jID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCBhcHBQYWNrYWdlO1xuICAgIGxldCBhcHBBY3Rpdml0eTtcbiAgICB0cnkge1xuICAgICAgKHthcHBQYWNrYWdlLCBhcHBBY3Rpdml0eX0gPSBhd2FpdCB0aGlzLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkoKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmRlYnVnKGUubWVzc2FnZSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChhcHBBY3Rpdml0eSAmJiBhcHBQYWNrYWdlKSB7XG4gICAgICBjb25zdCBmdWxseVF1YWxpZmllZEFjdGl2aXR5ID0gYXBwQWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpID8gYCR7YXBwUGFja2FnZX0ke2FwcEFjdGl2aXR5fWAgOiBhcHBBY3Rpdml0eTtcbiAgICAgIGxvZy5kZWJ1ZyhgRm91bmQgcGFja2FnZTogJyR7YXBwUGFja2FnZX0nIGFuZCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZSA6ICcke2Z1bGx5UXVhbGlmaWVkQWN0aXZpdHl9J2ApO1xuICAgICAgY29uc3QgaXNBY3Rpdml0eUZvdW5kID0gXy5pbmNsdWRlcyhhbGxQYWNrYWdlcywgYXBwUGFja2FnZSlcbiAgICAgICAgJiYgcG9zc2libGVBY3Rpdml0eVBhdHRlcm5zLnNvbWUoKHApID0+IHAudGVzdChmdWxseVF1YWxpZmllZEFjdGl2aXR5KSk7XG4gICAgICBpZiAoKCF3YWl0Rm9yU3RvcCAmJiBpc0FjdGl2aXR5Rm91bmQpIHx8ICh3YWl0Rm9yU3RvcCAmJiAhaXNBY3Rpdml0eUZvdW5kKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nLmRlYnVnKCdJbmNvcnJlY3QgcGFja2FnZSBhbmQgYWN0aXZpdHkuIFJldHJ5aW5nLicpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICB0cnkge1xuICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oY29uZGl0aW9uRnVuYywge1xuICAgICAgd2FpdE1zOiBwYXJzZUludCh3YWl0TXMsIDEwKSxcbiAgICAgIGludGVydmFsTXM6IDUwMCxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChuYW1lKSA9PiBgJyR7bmFtZX0nYCkuam9pbignIG9yICcpfSBuZXZlciAke3dhaXRGb3JTdG9wID8gJ3N0b3BwZWQnIDogJ3N0YXJ0ZWQnfS4gYCArXG4gICAgICBgVmlzaXQgJHtBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LfSBmb3IgdHJvdWJsZXNob290aW5nYCk7XG4gIH1cbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvckFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckFjdGl2aXR5IChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgZmFsc2UsIHdhaXRNcyk7XG59O1xuXG4vKipcbiAqIFdhaXQgZm9yIHRoZSBnaXZlbiBhY3Rpdml0eSB0byBiZSBub24tZm9jdXNlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvck5vdEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvck5vdEFjdGl2aXR5IChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgdHJ1ZSwgd2FpdE1zKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gVW5pbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgW2FkYkV4ZWNUaW1lb3V0XSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdW5pbnN0YWxsZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGtlZXBEYXRhIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBrZWVwIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gZGF0YSBhbmQgY2FjaGUgZm9sZGVycyBhZnRlciB1bmluc3RhbGwuXG4gKi9cblxuLyoqXG4gKiBVbmluc3RhbGwgdGhlIGdpdmVuIHBhY2thZ2UgZnJvbSB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGJlIHVuaW5zdGFsbGVkLlxuICogQHBhcmFtIHs/VW5pbnN0YWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBzZXQgb2YgdW5pbnN0YWxsIG9wdGlvbnMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIHdhcyBmb3VuZCBvbiB0aGUgZGV2aWNlIGFuZFxuICogICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkLlxuICovXG5hcGtVdGlsc01ldGhvZHMudW5pbnN0YWxsQXBrID0gYXN5bmMgZnVuY3Rpb24gdW5pbnN0YWxsQXBrIChwa2csIG9wdGlvbnMgPSB7fSkge1xuICBsb2cuZGVidWcoYFVuaW5zdGFsbGluZyAke3BrZ31gKTtcbiAgaWYgKCFhd2FpdCB0aGlzLmlzQXBwSW5zdGFsbGVkKHBrZykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWQsIGJlY2F1c2UgaXQgd2FzIG5vdCBwcmVzZW50IG9uIHRoZSBkZXZpY2VgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBjbWQgPSBbJ3VuaW5zdGFsbCddO1xuICBpZiAob3B0aW9ucy5rZWVwRGF0YSkge1xuICAgIGNtZC5wdXNoKCctaycpO1xuICB9XG4gIGNtZC5wdXNoKHBrZyk7XG5cbiAgbGV0IHN0ZG91dDtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmZvcmNlU3RvcChwa2cpO1xuICAgIHN0ZG91dCA9IChhd2FpdCB0aGlzLmFkYkV4ZWMoY21kLCB7dGltZW91dDogb3B0aW9ucy50aW1lb3V0fSkpLnRyaW0oKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHVuaW5zdGFsbCBBUEsuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxuICBsb2cuZGVidWcoYCdhZGIgJHtjbWQuam9pbignICcpfScgY29tbWFuZCBvdXRwdXQ6ICR7c3Rkb3V0fWApO1xuICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdTdWNjZXNzJykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBzdWNjZXNzZnVsbHkgdW5pbnN0YWxsZWRgKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWRgKTtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGFmdGVyIGl0IHdhcyBwdXNoZWQgdG8gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoT25EZXZpY2UgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBwYWNrYWdlIG9uIHRoZSBkZXZpY2UgZmlsZSBzeXN0ZW0uXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyBbe31dIC0gQWRkaXRpb25hbCBleGVjIG9wdGlvbnMuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9ub2RlLXRlZW5fcHJvY2Vzc31cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbW9yZSBkZXRhaWxzIG9uIHRoaXMgcGFyYW1ldGVyLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhIGZhaWx1cmUgZHVyaW5nIGFwcGxpY2F0aW9uIGluc3RhbGwuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pbnN0YWxsRnJvbURldmljZVBhdGggPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsRnJvbURldmljZVBhdGggKGFwa1BhdGhPbkRldmljZSwgb3B0cyA9IHt9KSB7XG4gIGxldCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsncG0nLCAnaW5zdGFsbCcsICctcicsIGFwa1BhdGhPbkRldmljZV0sIG9wdHMpO1xuICBpZiAoc3Rkb3V0LmluZGV4T2YoJ0ZhaWx1cmUnKSAhPT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFJlbW90ZSBpbnN0YWxsIGZhaWxlZDogJHtzdGRvdXR9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ2FjaGluZ09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gdGltZW91dCBbYWRiRXhlY1RpbWVvdXRdIC0gVGhlIGNvdW50IG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdXBsb2FkZWQgdG8gdGhlIHJlbW90ZSBsb2NhdGlvbi5cbiAqL1xuXG4vKipcbiAqIENhY2hlcyB0aGUgZ2l2ZW4gQVBLIGF0IGEgcmVtb3RlIGxvY2F0aW9uIHRvIHNwZWVkIHVwIGZ1cnRoZXIgQVBLIGRlcGxveW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoIC0gRnVsbCBwYXRoIHRvIHRoZSBhcGsgb24gdGhlIGxvY2FsIEZTXG4gKiBAcGFyYW0gez9DYWNoaW5nT3B0aW9uc30gb3B0aW9ucyAtIENhY2hpbmcgb3B0aW9uc1xuICogQHJldHVybnMge3N0cmluZ30gLSBGdWxsIHBhdGggdG8gdGhlIGNhY2hlZCBhcGsgb24gdGhlIHJlbW90ZSBmaWxlIHN5c3RlbVxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZXJlIHdhcyBhIGZhaWx1cmUgd2hpbGUgY2FjaGluZyB0aGUgYXBwXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5jYWNoZUFwayA9IGFzeW5jIGZ1bmN0aW9uIGNhY2hlQXBrIChhcGtQYXRoLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3QgYXBwSGFzaCA9IGF3YWl0IGZzLmhhc2goYXBrUGF0aCk7XG4gIGNvbnN0IHJlbW90ZVBhdGggPSBwYXRoLnBvc2l4LmpvaW4oUkVNT1RFX0NBQ0hFX1JPT1QsIGAke2FwcEhhc2h9LmFwa2ApO1xuICBjb25zdCByZW1vdGVDYWNoZWRGaWxlcyA9IFtdO1xuICAvLyBHZXQgY3VycmVudCBjb250ZW50cyBvZiB0aGUgcmVtb3RlIGNhY2hlIG9yIGNyZWF0ZSBpdCBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgdHJ5IHtcbiAgICBjb25zdCBlcnJvck1hcmtlciA9ICdfRVJST1JfJztcbiAgICBsZXQgbHNPdXRwdXQgPSBudWxsO1xuICAgIGlmICh0aGlzLl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCA9PT0gdHJ1ZSB8fCAhXy5pc0Jvb2xlYW4odGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQpKSB7XG4gICAgICBsc091dHB1dCA9IGF3YWl0IHRoaXMuc2hlbGwoW2BscyAtdCAtMSAke1JFTU9URV9DQUNIRV9ST09UfSAyPiYxIHx8IGVjaG8gJHtlcnJvck1hcmtlcn1gXSk7XG4gICAgfVxuICAgIGlmICghXy5pc1N0cmluZyhsc091dHB1dCkgfHwgKGxzT3V0cHV0LmluY2x1ZGVzKGVycm9yTWFya2VyKSAmJiAhbHNPdXRwdXQuaW5jbHVkZXMoUkVNT1RFX0NBQ0hFX1JPT1QpKSkge1xuICAgICAgaWYgKCFfLmlzQm9vbGVhbih0aGlzLl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdUaGUgY3VycmVudCBBbmRyb2lkIEFQSSBkb2VzIG5vdCBzdXBwb3J0IGV4dGVuZGVkIGxzIG9wdGlvbnMuICcgK1xuICAgICAgICAgICdEZWZhdWx0aW5nIHRvIG5vLW9wdGlvbnMgY2FsbCcpO1xuICAgICAgfVxuICAgICAgbHNPdXRwdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFtgbHMgJHtSRU1PVEVfQ0FDSEVfUk9PVH0gMj4mMSB8fCBlY2hvICR7ZXJyb3JNYXJrZXJ9YF0pO1xuICAgICAgdGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAobHNPdXRwdXQuaW5jbHVkZXMoZXJyb3JNYXJrZXIpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IobHNPdXRwdXQuc3Vic3RyaW5nKDAsIGxzT3V0cHV0LmluZGV4T2YoZXJyb3JNYXJrZXIpKSk7XG4gICAgfVxuICAgIHJlbW90ZUNhY2hlZEZpbGVzLnB1c2goLi4uKFxuICAgICAgbHNPdXRwdXQuc3BsaXQoJ1xcbicpXG4gICAgICAgIC5tYXAoKHgpID0+IHgudHJpbSgpKVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgKSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYEdvdCBhbiBlcnJvciAnJHtlLm1lc3NhZ2UudHJpbSgpfScgd2hpbGUgZ2V0dGluZyB0aGUgbGlzdCBvZiBmaWxlcyBpbiB0aGUgY2FjaGUuIGAgK1xuICAgICAgYEFzc3VtaW5nIHRoZSBjYWNoZSBkb2VzIG5vdCBleGlzdCB5ZXRgKTtcbiAgICBhd2FpdCB0aGlzLnNoZWxsKFsnbWtkaXInLCAnLXAnLCBSRU1PVEVfQ0FDSEVfUk9PVF0pO1xuICB9XG4gIGxvZy5kZWJ1ZyhgVGhlIGNvdW50IG9mIGFwcGxpY2F0aW9ucyBpbiB0aGUgY2FjaGU6ICR7cmVtb3RlQ2FjaGVkRmlsZXMubGVuZ3RofWApO1xuICBjb25zdCB0b0hhc2ggPSAocmVtb3RlUGF0aCkgPT4gcGF0aC5wb3NpeC5wYXJzZShyZW1vdGVQYXRoKS5uYW1lO1xuICAvLyBQdXNoIHRoZSBhcGsgdG8gdGhlIHJlbW90ZSBjYWNoZSBpZiBuZWVkZWRcbiAgaWYgKHJlbW90ZUNhY2hlZEZpbGVzLnNvbWUoKHgpID0+IHRvSGFzaCh4KSA9PT0gYXBwSGFzaCkpIHtcbiAgICBsb2cuaW5mbyhgVGhlIGFwcGxpY2F0aW9uIGF0ICcke2Fwa1BhdGh9JyBpcyBhbHJlYWR5IGNhY2hlZCB0byAnJHtyZW1vdGVQYXRofSdgKTtcbiAgICAvLyBVcGRhdGUgdGhlIGFwcGxpY2F0aW9uIHRpbWVzdGFtcCBhc3luY2hyb25vdXNseSBpbiBvcmRlciB0byBidW1wIGl0cyBwb3NpdGlvblxuICAgIC8vIGluIHRoZSBzb3J0ZWQgbHMgb3V0cHV0XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICB0aGlzLnNoZWxsKFsndG91Y2gnLCAnLWFtJywgcmVtb3RlUGF0aF0pLmNhdGNoKCgpID0+IHt9KTtcbiAgfSBlbHNlIHtcbiAgICBsb2cuaW5mbyhgQ2FjaGluZyB0aGUgYXBwbGljYXRpb24gYXQgJyR7YXBrUGF0aH0nIHRvICcke3JlbW90ZVBhdGh9J2ApO1xuICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgYXdhaXQgdGhpcy5wdXNoKGFwa1BhdGgsIHJlbW90ZVBhdGgsIHt0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXR9KTtcbiAgICBjb25zdCB7c2l6ZX0gPSBhd2FpdCBmcy5zdGF0KGFwa1BhdGgpO1xuICAgIGxvZy5pbmZvKGBUaGUgdXBsb2FkIG9mICcke3BhdGguYmFzZW5hbWUoYXBrUGF0aCl9JyAoJHt1dGlsLnRvUmVhZGFibGVTaXplU3RyaW5nKHNpemUpfSkgYCArXG4gICAgICBgdG9vayAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNNaWxsaVNlY29uZHMudG9GaXhlZCgwKX1tc2ApO1xuICB9XG4gIGlmICghdGhpcy5yZW1vdGVBcHBzQ2FjaGUpIHtcbiAgICB0aGlzLnJlbW90ZUFwcHNDYWNoZSA9IG5ldyBMUlUoe1xuICAgICAgbWF4OiB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0LFxuICAgIH0pO1xuICB9XG4gIC8vIENsZWFudXAgdGhlIGludmFsaWQgZW50cmllcyBmcm9tIHRoZSBjYWNoZVxuICBfLmRpZmZlcmVuY2UoWy4uLnRoaXMucmVtb3RlQXBwc0NhY2hlLmtleXMoKV0sIHJlbW90ZUNhY2hlZEZpbGVzLm1hcCh0b0hhc2gpKVxuICAgIC5mb3JFYWNoKChoYXNoKSA9PiB0aGlzLnJlbW90ZUFwcHNDYWNoZS5kZWwoaGFzaCkpO1xuICAvLyBCdW1wIHRoZSBjYWNoZSByZWNvcmQgZm9yIHRoZSByZWNlbnRseSBjYWNoZWQgaXRlbVxuICB0aGlzLnJlbW90ZUFwcHNDYWNoZS5zZXQoYXBwSGFzaCwgcmVtb3RlUGF0aCk7XG4gIC8vIElmIHRoZSByZW1vdGUgY2FjaGUgZXhjZWVkcyB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0LCByZW1vdmUgdGhlIGxlYXN0IHJlY2VudGx5IHVzZWQgZW50cmllc1xuICBjb25zdCBlbnRyaWVzVG9DbGVhbnVwID0gcmVtb3RlQ2FjaGVkRmlsZXNcbiAgICAubWFwKCh4KSA9PiBwYXRoLnBvc2l4LmpvaW4oUkVNT1RFX0NBQ0hFX1JPT1QsIHgpKVxuICAgIC5maWx0ZXIoKHgpID0+ICF0aGlzLnJlbW90ZUFwcHNDYWNoZS5oYXModG9IYXNoKHgpKSlcbiAgICAuc2xpY2UodGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCAtIFsuLi50aGlzLnJlbW90ZUFwcHNDYWNoZS5rZXlzKCldLmxlbmd0aCk7XG4gIGlmICghXy5pc0VtcHR5KGVudHJpZXNUb0NsZWFudXApKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2hlbGwoWydybScsICctZicsIC4uLmVudHJpZXNUb0NsZWFudXBdKTtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRlZCAke2VudHJpZXNUb0NsZWFudXAubGVuZ3RofSBleHBpcmVkIGFwcGxpY2F0aW9uIGNhY2hlIGVudHJpZXNgKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cud2FybihgQ2Fubm90IGRlbGV0ZSAke2VudHJpZXNUb0NsZWFudXAubGVuZ3RofSBleHBpcmVkIGFwcGxpY2F0aW9uIGNhY2hlIGVudHJpZXMuIGAgK1xuICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVtb3RlUGF0aDtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFs2MDAwMF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIGluc3RhbGxlZC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lb3V0Q2FwTmFtZSBbYW5kcm9pZEluc3RhbGxUaW1lb3V0XSAtIFRoZSB0aW1lb3V0IG9wdGlvbiBuYW1lXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VycyBjYW4gaW5jcmVhc2UgdGhlIHRpbWVvdXQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFsbG93VGVzdFBhY2thZ2VzIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlcyBpbnN0YWxsYXRpb24uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHVzZVNkY2FyZCBbZmFsc2VdIC0gU2V0IHRvIHRydWUgdG8gaW5zdGFsbCB0aGUgYXBwIG9uIHNkY2FyZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQgb2YgdGhlIGRldmljZSBtZW1vcnkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMgcmVxdWVzdGVkIGluIHRoZSBhcHBsaWNhdGlvbidzIG1hbmlmZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHkgYWZ0ZXIgdGhlIGluc3RhbGxhdGlvbiBpcyBjb21wbGV0ZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZXIgQW5kcm9pZCA2Ky5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gcmVwbGFjZSBbdHJ1ZV0gLSBTZXQgaXQgdG8gZmFsc2UgaWYgeW91IGRvbid0IHdhbnRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgYXBwbGljYXRpb24gdG8gYmUgdXBncmFkZWQvcmVpbnN0YWxsZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpdCBpcyBhbHJlYWR5IHByZXNlbnQgb24gdGhlIGRldmljZS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gbm9JbmNyZW1lbnRhbCBbZmFsc2VdIC0gRm9yY2VmdWxseSBkaXNhYmxlcyBpbmNyZW1lbnRhbCBpbnN0YWxscyBpZiBzZXQgdG8gYHRydWVgLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFkIGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3ByZXZpZXcvZmVhdHVyZXMjaW5jcmVtZW50YWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG1vcmUgZGV0YWlscy5cbiAqL1xuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhY2thZ2UgZnJvbSB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBwYWNrYWdlLlxuICogQHBhcmFtIHs/SW5zdGFsbE9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgc2V0IG9mIGluc3RhbGxhdGlvbiBvcHRpb25zLlxuICogQHRocm93cyB7RXJyb3J9IElmIGFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFwcGVucyBkdXJpbmcgaW5zdGFsbC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGwgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsIChhcHBQYXRoLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaW5zdGFsbEFwa3MoYXBwUGF0aCwgb3B0aW9ucyk7XG4gIH1cblxuICBvcHRpb25zID0gXy5jbG9uZURlZXAob3B0aW9ucyk7XG4gIF8uZGVmYXVsdHMob3B0aW9ucywge1xuICAgIHJlcGxhY2U6IHRydWUsXG4gICAgdGltZW91dDogdGhpcy5hZGJFeGVjVGltZW91dCA9PT0gREVGQVVMVF9BREJfRVhFQ19USU1FT1VUID8gQVBLX0lOU1RBTExfVElNRU9VVCA6IHRoaXMuYWRiRXhlY1RpbWVvdXQsXG4gICAgdGltZW91dENhcE5hbWU6ICdhbmRyb2lkSW5zdGFsbFRpbWVvdXQnLFxuICB9KTtcblxuICBjb25zdCBpbnN0YWxsQXJncyA9IGJ1aWxkSW5zdGFsbEFyZ3MoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpLCBvcHRpb25zKTtcbiAgaWYgKG9wdGlvbnMubm9JbmNyZW1lbnRhbCAmJiBhd2FpdCB0aGlzLmlzSW5jcmVtZW50YWxJbnN0YWxsU3VwcG9ydGVkKCkpIHtcbiAgICAvLyBBZGIgdGhyb3dzIGFuIGVycm9yIGlmIGl0IGRvZXMgbm90IGtub3cgYWJvdXQgYW4gYXJnLFxuICAgIC8vIHdoaWNoIGlzIHRoZSBjYXNlIGhlcmUgZm9yIG9sZGVyIGFkYiB2ZXJzaW9ucy5cbiAgICBpbnN0YWxsQXJncy5wdXNoKCctLW5vLWluY3JlbWVudGFsJyk7XG4gIH1cbiAgY29uc3QgaW5zdGFsbE9wdHMgPSB7XG4gICAgdGltZW91dDogb3B0aW9ucy50aW1lb3V0LFxuICAgIHRpbWVvdXRDYXBOYW1lOiBvcHRpb25zLnRpbWVvdXRDYXBOYW1lLFxuICB9O1xuICBjb25zdCBpbnN0YWxsQ21kID0gW1xuICAgICdpbnN0YWxsJyxcbiAgICAuLi5pbnN0YWxsQXJncyxcbiAgICBhcHBQYXRoLFxuICBdO1xuICBsZXQgcGVyZm9ybUFwcEluc3RhbGwgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmFkYkV4ZWMoaW5zdGFsbENtZCwgaW5zdGFsbE9wdHMpO1xuICAvLyB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0IDw9IDAgbWVhbnMgbm8gY2FjaGluZyBzaG91bGQgYmUgYXBwbGllZFxuICBsZXQgc2hvdWxkQ2FjaGVBcHAgPSB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0ID4gMDtcbiAgaWYgKHNob3VsZENhY2hlQXBwKSB7XG4gICAgc2hvdWxkQ2FjaGVBcHAgPSAhKGF3YWl0IHRoaXMuaXNTdHJlYW1lZEluc3RhbGxTdXBwb3J0ZWQoKSk7XG4gICAgaWYgKCFzaG91bGRDYWNoZUFwcCkge1xuICAgICAgbG9nLmluZm8oYFRoZSBhcHBsaWNhdGlvbiBhdCAnJHthcHBQYXRofScgd2lsbCBub3QgYmUgY2FjaGVkLCBiZWNhdXNlIHRoZSBkZXZpY2UgdW5kZXIgdGVzdCBoYXMgYCArXG4gICAgICAgIGBjb25maXJtZWQgdGhlIHN1cHBvcnQgb2Ygc3RyZWFtZWQgaW5zdGFsbHNgKTtcbiAgICB9XG4gIH1cbiAgaWYgKHNob3VsZENhY2hlQXBwKSB7XG4gICAgY29uc3QgY2xlYXJDYWNoZSA9IGFzeW5jICgpID0+IHtcbiAgICAgIGxvZy5pbmZvKGBDbGVhcmluZyB0aGUgY2FjaGUgYXQgJyR7UkVNT1RFX0NBQ0hFX1JPT1R9J2ApO1xuICAgICAgYXdhaXQgdGhpcy5zaGVsbChbJ3JtJywgJy1yZicsIGAke1JFTU9URV9DQUNIRV9ST09UfS8qYF0pO1xuICAgIH07XG4gICAgY29uc3QgY2FjaGVBcHAgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmNhY2hlQXBrKGFwcFBhdGgsIHtcbiAgICAgIHRpbWVvdXQ6IG9wdGlvbnMudGltZW91dCxcbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2FjaGVkQXBwUGF0aCA9IGF3YWl0IGNhY2hlQXBwKCk7XG4gICAgICBwZXJmb3JtQXBwSW5zdGFsbCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcG1JbnN0YWxsQ21kQnlSZW1vdGVQYXRoID0gKHJlbW90ZVBhdGgpID0+IFtcbiAgICAgICAgICAncG0nLCAnaW5zdGFsbCcsXG4gICAgICAgICAgLi4uaW5zdGFsbEFyZ3MsXG4gICAgICAgICAgcmVtb3RlUGF0aCxcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgdGhpcy5zaGVsbChwbUluc3RhbGxDbWRCeVJlbW90ZVBhdGgoY2FjaGVkQXBwUGF0aCksIGluc3RhbGxPcHRzKTtcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzEzOTcwXG4gICAgICAgIGlmICgvXFxiSU5TVEFMTF9GQUlMRURfSU5TVUZGSUNJRU5UX1NUT1JBR0VcXGIvLnRlc3Qob3V0cHV0KSkge1xuICAgICAgICAgIGxvZy53YXJuKGBUaGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIGluc3RhbGxpbmcgJyR7YXBwUGF0aH0nIGAgK1xuICAgICAgICAgICAgYGJlY2F1c2Ugb2YgdGhlIGluc3VmZmljaWVudCBkZXZpY2Ugc3RvcmFnZSBzcGFjZWApO1xuICAgICAgICAgIGF3YWl0IGNsZWFyQ2FjaGUoKTtcbiAgICAgICAgICBsb2cuaW5mbyhgQ29uc2lkZXIgZGVjcmVhc2luZyB0aGUgbWF4aW11bSBhbW91bnQgb2YgY2FjaGVkIGFwcHMgYCArXG4gICAgICAgICAgICBgKGN1cnJlbnRseSAke3RoaXMucmVtb3RlQXBwc0NhY2hlTGltaXR9KSB0byBhdm9pZCBzdWNoIGlzc3VlcyBpbiB0aGUgZnV0dXJlYCk7XG4gICAgICAgICAgY29uc3QgbmV3Q2FjaGVkQXBwUGF0aCA9IGF3YWl0IGNhY2hlQXBwKCk7XG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2hlbGwocG1JbnN0YWxsQ21kQnlSZW1vdGVQYXRoKG5ld0NhY2hlZEFwcFBhdGgpLCBpbnN0YWxsT3B0cyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmRlYnVnKGUpO1xuICAgICAgbG9nLndhcm4oYFRoZXJlIHdhcyBhIGZhaWx1cmUgd2hpbGUgY2FjaGluZyAnJHthcHBQYXRofSc6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgbG9nLndhcm4oJ0ZhbGxpbmcgYmFjayB0byB0aGUgZGVmYXVsdCBpbnN0YWxsYXRpb24gcHJvY2VkdXJlJyk7XG4gICAgICBhd2FpdCBjbGVhckNhY2hlKCk7XG4gICAgfVxuICB9XG4gIHRyeSB7XG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCBwZXJmb3JtQXBwSW5zdGFsbCgpO1xuICAgIGxvZy5pbmZvKGBUaGUgaW5zdGFsbGF0aW9uIG9mICcke3BhdGguYmFzZW5hbWUoYXBwUGF0aCl9JyB0b29rICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcy50b0ZpeGVkKDApfW1zYCk7XG4gICAgY29uc3QgdHJ1bmNhdGVkT3V0cHV0ID0gKCFfLmlzU3RyaW5nKG91dHB1dCkgfHwgb3V0cHV0Lmxlbmd0aCA8PSAzMDApID9cbiAgICAgIG91dHB1dCA6IGAke291dHB1dC5zdWJzdHIoMCwgMTUwKX0uLi4ke291dHB1dC5zdWJzdHIob3V0cHV0Lmxlbmd0aCAtIDE1MCl9YDtcbiAgICBsb2cuZGVidWcoYEluc3RhbGwgY29tbWFuZCBzdGRvdXQ6ICR7dHJ1bmNhdGVkT3V0cHV0fWApO1xuICAgIGlmICgvXFxbSU5TVEFMTFtBLVpfXStGQUlMRURbQS1aX10rXFxdLy50ZXN0KG91dHB1dCkpIHtcbiAgICAgIGlmICh0aGlzLmlzVGVzdFBhY2thZ2VPbmx5RXJyb3Iob3V0cHV0KSkge1xuICAgICAgICBjb25zdCBtc2cgPSBgU2V0ICdhbGxvd1Rlc3RQYWNrYWdlcycgY2FwYWJpbGl0eSB0byB0cnVlIGluIG9yZGVyIHRvIGFsbG93IHRlc3QgcGFja2FnZXMgaW5zdGFsbGF0aW9uLmA7XG4gICAgICAgIGxvZy53YXJuKG1zZyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtvdXRwdXR9XFxuJHttc2d9YCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3Iob3V0cHV0KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIG9uIHNvbWUgc3lzdGVtcyB0aGlzIHdpbGwgdGhyb3cgYW4gZXJyb3IgaWYgdGhlIGFwcCBhbHJlYWR5XG4gICAgLy8gZXhpc3RzXG4gICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcygnSU5TVEFMTF9GQUlMRURfQUxSRUFEWV9FWElTVFMnKSkge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYEFwcGxpY2F0aW9uICcke2FwcFBhdGh9JyBhbHJlYWR5IGluc3RhbGxlZC4gQ29udGludWluZy5gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgaW5zdGFsbGF0aW9uIHN0YXRlIG9mIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBGdWxsIHBhdGggdG8gdGhlIGFwcGxpY2F0aW9uXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBrZyAtIFBhY2thZ2UgaWRlbnRpZmllci4gSWYgb21pdHRlZCB0aGVuIHRoZSBzY3JpcHQgd2lsbFxuICogICAgICAgICAgICAgICAgICAgICAgICB0cnkgdG8gZXh0cmFjdCBpdCBvbiBpdHMgb3duXG4gKiBAcmV0dXJucyB7c3RyaW5nfV1PbmUgb2YgYEFQUF9JTlNUQUxMX1NUQVRFYCBjb25zdGFudHNcbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlID0gYXN5bmMgZnVuY3Rpb24gZ2V0QXBwbGljYXRpb25JbnN0YWxsU3RhdGUgKGFwcFBhdGgsIHBrZyA9IG51bGwpIHtcbiAgbGV0IGFwa0luZm8gPSBudWxsO1xuICBpZiAoIXBrZykge1xuICAgIGFwa0luZm8gPSBhd2FpdCB0aGlzLmdldEFwa0luZm8oYXBwUGF0aCk7XG4gICAgcGtnID0gYXBrSW5mby5uYW1lO1xuICB9XG4gIGlmICghcGtnKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCByZWFkIHRoZSBwYWNrYWdlIG5hbWUgb2YgJyR7YXBwUGF0aH0nYCk7XG4gICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuVU5LTk9XTjtcbiAgfVxuXG4gIGlmICghYXdhaXQgdGhpcy5pc0FwcEluc3RhbGxlZChwa2cpKSB7XG4gICAgbG9nLmRlYnVnKGBBcHAgJyR7YXBwUGF0aH0nIGlzIG5vdCBpbnN0YWxsZWRgKTtcbiAgICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5OT1RfSU5TVEFMTEVEO1xuICB9XG5cbiAgY29uc3Qge3ZlcnNpb25Db2RlOiBwa2dWZXJzaW9uQ29kZSwgdmVyc2lvbk5hbWU6IHBrZ1ZlcnNpb25OYW1lU3RyfSA9IGF3YWl0IHRoaXMuZ2V0UGFja2FnZUluZm8ocGtnKTtcbiAgY29uc3QgcGtnVmVyc2lvbk5hbWUgPSBzZW12ZXIudmFsaWQoc2VtdmVyLmNvZXJjZShwa2dWZXJzaW9uTmFtZVN0cikpO1xuICBpZiAoIWFwa0luZm8pIHtcbiAgICBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwcFBhdGgpO1xuICB9XG4gIGNvbnN0IHt2ZXJzaW9uQ29kZTogYXBrVmVyc2lvbkNvZGUsIHZlcnNpb25OYW1lOiBhcGtWZXJzaW9uTmFtZVN0cn0gPSBhcGtJbmZvO1xuICBjb25zdCBhcGtWZXJzaW9uTmFtZSA9IHNlbXZlci52YWxpZChzZW12ZXIuY29lcmNlKGFwa1ZlcnNpb25OYW1lU3RyKSk7XG5cbiAgaWYgKCFfLmlzSW50ZWdlcihhcGtWZXJzaW9uQ29kZSkgfHwgIV8uaXNJbnRlZ2VyKHBrZ1ZlcnNpb25Db2RlKSkge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB2ZXJzaW9uIGNvZGVzIG9mICcke2FwcFBhdGh9JyBhbmQvb3IgJyR7cGtnfSdgKTtcbiAgICBpZiAoIV8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpIHx8ICFfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSkge1xuICAgICAgbG9nLndhcm4oYENhbm5vdCByZWFkIHZlcnNpb24gbmFtZXMgb2YgJyR7YXBwUGF0aH0nIGFuZC9vciAnJHtwa2d9J2ApO1xuICAgICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuVU5LTk9XTjtcbiAgICB9XG4gIH1cbiAgaWYgKF8uaXNJbnRlZ2VyKGFwa1ZlcnNpb25Db2RlKSAmJiBfLmlzSW50ZWdlcihwa2dWZXJzaW9uQ29kZSkpIHtcbiAgICBpZiAocGtnVmVyc2lvbkNvZGUgPiBhcGtWZXJzaW9uQ29kZSkge1xuICAgICAgbG9nLmRlYnVnKGBUaGUgdmVyc2lvbiBjb2RlIG9mIHRoZSBpbnN0YWxsZWQgJyR7cGtnfScgaXMgZ3JlYXRlciB0aGFuIHRoZSBhcHBsaWNhdGlvbiB2ZXJzaW9uIGNvZGUgKCR7cGtnVmVyc2lvbkNvZGV9ID4gJHthcGtWZXJzaW9uQ29kZX0pYCk7XG4gICAgICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5ORVdFUl9WRVJTSU9OX0lOU1RBTExFRDtcbiAgICB9XG4gICAgLy8gVmVyc2lvbiBjb2RlcyBtaWdodCBub3QgYmUgbWFpbnRhaW5lZC4gQ2hlY2sgdmVyc2lvbiBuYW1lcy5cbiAgICBpZiAocGtnVmVyc2lvbkNvZGUgPT09IGFwa1ZlcnNpb25Db2RlKSB7XG4gICAgICBpZiAoXy5pc1N0cmluZyhhcGtWZXJzaW9uTmFtZSkgJiYgXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkgJiYgc2VtdmVyLnNhdGlzZmllcyhwa2dWZXJzaW9uTmFtZSwgYD49JHthcGtWZXJzaW9uTmFtZX1gKSkge1xuICAgICAgICBsb2cuZGVidWcoYFRoZSB2ZXJzaW9uIG5hbWUgb2YgdGhlIGluc3RhbGxlZCAnJHtwa2d9JyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSBhcHBsaWNhdGlvbiB2ZXJzaW9uIG5hbWUgKCcke3BrZ1ZlcnNpb25OYW1lfScgPj0gJyR7YXBrVmVyc2lvbk5hbWV9JylgKTtcbiAgICAgICAgcmV0dXJuIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+JHthcGtWZXJzaW9uTmFtZX1gKVxuICAgICAgICAgID8gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5ORVdFUl9WRVJTSU9OX0lOU1RBTExFRFxuICAgICAgICAgIDogdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5TQU1FX1ZFUlNJT05fSU5TVEFMTEVEO1xuICAgICAgfVxuICAgICAgaWYgKCFfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSB8fCAhXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBUaGUgdmVyc2lvbiBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgJyR7cGtnfScgaXMgZXF1YWwgdG8gYXBwbGljYXRpb24gdmVyc2lvbiBuYW1lICgke3BrZ1ZlcnNpb25Db2RlfSA9PT0gJHthcGtWZXJzaW9uQ29kZX0pYCk7XG4gICAgICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQ7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpICYmIF8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpICYmIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+PSR7YXBrVmVyc2lvbk5hbWV9YCkpIHtcbiAgICBsb2cuZGVidWcoYFRoZSB2ZXJzaW9uIG5hbWUgb2YgdGhlIGluc3RhbGxlZCAnJHtwa2d9JyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSBhcHBsaWNhdGlvbiB2ZXJzaW9uIG5hbWUgKCcke3BrZ1ZlcnNpb25OYW1lfScgPj0gJyR7YXBrVmVyc2lvbk5hbWV9JylgKTtcbiAgICByZXR1cm4gc2VtdmVyLnNhdGlzZmllcyhwa2dWZXJzaW9uTmFtZSwgYD4ke2Fwa1ZlcnNpb25OYW1lfWApXG4gICAgICA/IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTkVXRVJfVkVSU0lPTl9JTlNUQUxMRURcbiAgICAgIDogdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5TQU1FX1ZFUlNJT05fSU5TVEFMTEVEO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBUaGUgaW5zdGFsbGVkICcke3BrZ30nIHBhY2thZ2UgaXMgb2xkZXIgdGhhbiAnJHthcHBQYXRofScgKCR7cGtnVmVyc2lvbkNvZGV9IDwgJHthcGtWZXJzaW9uQ29kZX0gb3IgJyR7cGtnVmVyc2lvbk5hbWV9JyA8ICcke2Fwa1ZlcnNpb25OYW1lfScpJ2ApO1xuICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5PTERFUl9WRVJTSU9OX0lOU1RBTExFRDtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9yVXBncmFkZU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFs2MDAwMF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIGluc3RhbGxlZC5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYWxsb3dUZXN0UGFja2FnZXMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGFsbG93IHRlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VzIGluc3RhbGxhdGlvbi5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdXNlU2RjYXJkIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSB0byBpbnN0YWxsIHRoZSBhcHAgb24gU0RDYXJkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGVhZCBvZiB0aGUgZGV2aWNlIG1lbW9yeS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZ3JhbnRQZXJtaXNzaW9ucyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gZ3JhbnQgYWxsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQgaW4gdGhlIGFwcGxpY2F0aW9uJ3MgbWFuaWZlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b21hdGljYWxseSBhZnRlciB0aGUgaW5zdGFsbGF0aW9uIGlzIGNvbXBsZXRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlciBBbmRyb2lkIDYrLlxuICogQHByb3BlcnR5IHtib29sZWFufSBlbmZvcmNlQ3VycmVudEJ1aWxkIFtmYWxzZV0gLSBTZXQgdG8gYHRydWVgIGluIG9yZGVyIHRvIGFsd2F5cyBwcmVmZXJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGN1cnJlbnQgYnVpbGQgb3ZlciBhbnkgaW5zdGFsbGVkIHBhY2thZ2VzIGhhdmluZ1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc2FtZSBpZGVudGlmaWVyXG4gKi9cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsT3JVcGdyYWRlUmVzdWx0XG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHdhc1VuaW5zdGFsbGVkIC0gRXF1YWxzIHRvIGB0cnVlYCBpZiB0aGUgdGFyZ2V0IGFwcCBoYXMgYmVlbiB1bmluc3RhbGxlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZSBiZWluZyBpbnN0YWxsZWRcbiAqIEBwcm9wZXJ0eSB7QVBQX0lOU1RBTExfU1RBVEV9IGFwcFN0YXRlIC0gT25lIG9mIGBhZGIuQVBQX0lOU1RBTExfU1RBVEVgIHN0YXRlcywgd2hpY2ggcmVmbGVjdHNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHN0YXRlIG9mIHRoZSBhcHBsaWNhdGlvbiBiZWZvcmUgYmVpbmcgaW5zdGFsbGVkLlxuICovXG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBmcm9tIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSBvciB1cGdyYWRlIGl0IGlmIGFuIG9sZGVyXG4gKiB2ZXJzaW9uIG9mIHRoZSBzYW1lIHBhY2thZ2UgaXMgYWxyZWFkeSBpbnN0YWxsZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBwYWNrYWdlLlxuICogQHBhcmFtIHs/c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgaW5zdGFsbGVkIHBhY2thZ2UuIFRoZSBtZXRob2Qgd2lsbFxuICogICAgICAgICAgICAgICAgICAgICAgICBwZXJmb3JtIGZhc3RlciBpZiBpdCBpcyBzZXQuXG4gKiBAcGFyYW0gez9JbnN0YWxsT3JVcGdyYWRlT3B0aW9uc30gb3B0aW9ucyAtIFNldCBvZiBpbnN0YWxsIG9wdGlvbnMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgYW4gdW5leHBlY3RlZCBlcnJvciBoYXBwZW5zIGR1cmluZyBpbnN0YWxsLlxuICogQHJldHVybnMge0luc3RhbGxPclVwZ3JhZGVSZXN1bHR9XG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pbnN0YWxsT3JVcGdyYWRlID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbE9yVXBncmFkZSAoYXBwUGF0aCwgcGtnID0gbnVsbCwgb3B0aW9ucyA9IHt9KSB7XG4gIGlmICghcGtnKSB7XG4gICAgY29uc3QgYXBrSW5mbyA9IGF3YWl0IHRoaXMuZ2V0QXBrSW5mbyhhcHBQYXRoKTtcbiAgICBwa2cgPSBhcGtJbmZvLm5hbWU7XG4gIH1cblxuICBjb25zdCB7XG4gICAgZW5mb3JjZUN1cnJlbnRCdWlsZCxcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGFwcFN0YXRlID0gYXdhaXQgdGhpcy5nZXRBcHBsaWNhdGlvbkluc3RhbGxTdGF0ZShhcHBQYXRoLCBwa2cpO1xuICBsZXQgd2FzVW5pbnN0YWxsZWQgPSBmYWxzZTtcbiAgY29uc3QgdW5pbnN0YWxsUGFja2FnZSA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWF3YWl0IHRoaXMudW5pbnN0YWxsQXBrKHBrZykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7cGtnfScgcGFja2FnZSBjYW5ub3QgYmUgdW5pbnN0YWxsZWRgKTtcbiAgICB9XG4gICAgd2FzVW5pbnN0YWxsZWQgPSB0cnVlO1xuICB9O1xuICBzd2l0Y2ggKGFwcFN0YXRlKSB7XG4gICAgY2FzZSB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5PVF9JTlNUQUxMRUQ6XG4gICAgICBsb2cuZGVidWcoYEluc3RhbGxpbmcgJyR7YXBwUGF0aH0nYCk7XG4gICAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IGZhbHNlfSkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwU3RhdGUsXG4gICAgICAgIHdhc1VuaW5zdGFsbGVkLFxuICAgICAgfTtcbiAgICBjYXNlIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTkVXRVJfVkVSU0lPTl9JTlNUQUxMRUQ6XG4gICAgICBpZiAoZW5mb3JjZUN1cnJlbnRCdWlsZCkge1xuICAgICAgICBsb2cuaW5mbyhgRG93bmdyYWRpbmcgJyR7cGtnfScgYXMgcmVxdWVzdGVkYCk7XG4gICAgICAgIGF3YWl0IHVuaW5zdGFsbFBhY2thZ2UoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBsb2cuZGVidWcoYFRoZXJlIGlzIG5vIG5lZWQgdG8gZG93bmdyYWRlICcke3BrZ30nYCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHBTdGF0ZSxcbiAgICAgICAgd2FzVW5pbnN0YWxsZWQsXG4gICAgICB9O1xuICAgIGNhc2UgdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5TQU1FX1ZFUlNJT05fSU5TVEFMTEVEOlxuICAgICAgaWYgKGVuZm9yY2VDdXJyZW50QnVpbGQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBsb2cuZGVidWcoYFRoZXJlIGlzIG5vIG5lZWQgdG8gaW5zdGFsbC91cGdyYWRlICcke2FwcFBhdGh9J2ApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwU3RhdGUsXG4gICAgICAgIHdhc1VuaW5zdGFsbGVkLFxuICAgICAgfTtcbiAgICBjYXNlIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuT0xERVJfVkVSU0lPTl9JTlNUQUxMRUQ6XG4gICAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyB1cGdyYWRlIG9mICcke2FwcFBhdGh9J2ApO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlIGN1cnJlbnQgaW5zdGFsbCBzdGF0ZSBvZiAnJHthcHBQYXRofScgaXMgdW5rbm93bi4gSW5zdGFsbGluZyBhbnl3YXlgKTtcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IHRydWV9KSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgaW5zdGFsbC91cGdyYWRlICcke3BrZ30nIGJlY2F1c2Ugb2YgJyR7ZXJyLm1lc3NhZ2V9Jy4gVHJ5aW5nIGZ1bGwgcmVpbnN0YWxsYCk7XG4gICAgYXdhaXQgdW5pbnN0YWxsUGFja2FnZSgpO1xuICAgIGF3YWl0IHRoaXMuaW5zdGFsbChhcHBQYXRoLCBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7cmVwbGFjZTogZmFsc2V9KSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBhcHBTdGF0ZSxcbiAgICB3YXNVbmluc3RhbGxlZCxcbiAgfTtcbn07XG5cbi8qKlxuICogRXh0cmFjdCBzdHJpbmcgcmVzb3VyY2VzIGZyb20gdGhlIGdpdmVuIHBhY2thZ2Ugb24gbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSAuYXBrKHMpIHBhY2thZ2UuXG4gKiBAcGFyYW0gez9zdHJpbmd9IGxhbmd1YWdlIC0gVGhlIG5hbWUgb2YgdGhlIGxhbmd1YWdlIHRvIGV4dHJhY3QgdGhlIHJlc291cmNlcyBmb3IuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXMgdXNlZCBpZiB0aGlzIGVxdWFscyB0byBgbnVsbGAvYHVuZGVmaW5lZGBcbiAqIEBwYXJhbSB7c3RyaW5nfSBvdXQgLSBUaGUgbmFtZSBvZiB0aGUgZGVzdGluYXRpb24gZm9sZGVyIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSB0b1xuICogICAgICAgICAgICAgICAgICAgICAgIHN0b3JlIHRoZSBleHRyYWN0ZWQgZmlsZSB0by5cbiAqIEByZXR1cm4ge09iamVjdH0gQSBtYXBwaW5nIG9iamVjdCwgd2hlcmUgcHJvcGVydGllcyBhcmU6ICdhcGtTdHJpbmdzJywgY29udGFpbmluZ1xuICogICAgICAgICAgICAgICAgICBwYXJzZWQgcmVzb3VyY2UgZmlsZSByZXByZXNlbnRlZCBhcyBKU09OIG9iamVjdCwgYW5kICdsb2NhbFBhdGgnLFxuICogICAgICAgICAgICAgICAgICBjb250YWluaW5nIHRoZSBwYXRoIHRvIHRoZSBleHRyYWN0ZWQgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5leHRyYWN0U3RyaW5nc0Zyb21BcGsgPSBhc3luYyBmdW5jdGlvbiBleHRyYWN0U3RyaW5nc0Zyb21BcGsgKGFwcFBhdGgsIGxhbmd1YWdlLCBvdXQpIHtcbiAgbG9nLmRlYnVnKGBFeHRyYWN0aW5nIHN0cmluZ3MgZnJvbSBmb3IgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2UgfHwgJ2RlZmF1bHQnfWApO1xuICBjb25zdCBvcmlnaW5hbEFwcFBhdGggPSBhcHBQYXRoO1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0TGFuZ3VhZ2VBcGsoYXBwUGF0aCwgbGFuZ3VhZ2UpO1xuICB9XG5cbiAgbGV0IGFwa1N0cmluZ3MgPSB7fTtcbiAgbGV0IGNvbmZpZ01hcmtlcjtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG5cbiAgICBjb25maWdNYXJrZXIgPSBhd2FpdCBmb3JtYXRDb25maWdNYXJrZXIoYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgW1xuICAgICAgICAnZCcsICdjb25maWd1cmF0aW9ucycsIGFwcFBhdGgsXG4gICAgICBdKTtcbiAgICAgIHJldHVybiBfLnVuaXEoc3Rkb3V0LnNwbGl0KG9zLkVPTCkpO1xuICAgIH0sIGxhbmd1YWdlLCAnKGRlZmF1bHQpJyk7XG5cbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAnZCcsICctLXZhbHVlcycsICdyZXNvdXJjZXMnLCBhcHBQYXRoLFxuICAgIF0pO1xuICAgIGFwa1N0cmluZ3MgPSBwYXJzZUFhcHRTdHJpbmdzKHN0ZG91dCwgY29uZmlnTWFya2VyKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZygnQ2Fubm90IGV4dHJhY3QgcmVzb3VyY2VzIHVzaW5nIGFhcHQuIFRyeWluZyBhYXB0Mi4gJyArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuXG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdDIoKTtcblxuICAgIGNvbmZpZ01hcmtlciA9IGF3YWl0IGZvcm1hdENvbmZpZ01hcmtlcihhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0MiwgW1xuICAgICAgICAnZCcsICdjb25maWd1cmF0aW9ucycsIGFwcFBhdGgsXG4gICAgICBdKTtcbiAgICAgIHJldHVybiBfLnVuaXEoc3Rkb3V0LnNwbGl0KG9zLkVPTCkpO1xuICAgIH0sIGxhbmd1YWdlLCAnJyk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdDIsIFtcbiAgICAgICAgJ2QnLCAncmVzb3VyY2VzJywgYXBwUGF0aCxcbiAgICAgIF0pO1xuICAgICAgYXBrU3RyaW5ncyA9IHBhcnNlQWFwdDJTdHJpbmdzKHN0ZG91dCwgY29uZmlnTWFya2VyKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleHRyYWN0IHJlc291cmNlcyBmcm9tICcke29yaWdpbmFsQXBwUGF0aH0nLiBgICtcbiAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICBpZiAoXy5pc0VtcHR5KGFwa1N0cmluZ3MpKSB7XG4gICAgbG9nLndhcm4oYE5vIHN0cmluZ3MgaGF2ZSBiZWVuIGZvdW5kIGluICcke29yaWdpbmFsQXBwUGF0aH0nIHJlc291cmNlcyBgICtcbiAgICAgIGBmb3IgJyR7Y29uZmlnTWFya2VyIHx8ICdkZWZhdWx0J30nIGNvbmZpZ3VyYXRpb25gKTtcbiAgfSBlbHNlIHtcbiAgICBsb2cuaW5mbyhgU3VjY2Vzc2Z1bGx5IGV4dHJhY3RlZCAke18ua2V5cyhhcGtTdHJpbmdzKS5sZW5ndGh9IHN0cmluZ3MgZnJvbSBgICtcbiAgICAgIGAnJHtvcmlnaW5hbEFwcFBhdGh9JyByZXNvdXJjZXMgZm9yICcke2NvbmZpZ01hcmtlciB8fCAnZGVmYXVsdCd9JyBjb25maWd1cmF0aW9uYCk7XG4gIH1cblxuICBjb25zdCBsb2NhbFBhdGggPSBwYXRoLnJlc29sdmUob3V0LCAnc3RyaW5ncy5qc29uJyk7XG4gIGF3YWl0IG1rZGlycChvdXQpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUobG9jYWxQYXRoLCBKU09OLnN0cmluZ2lmeShhcGtTdHJpbmdzLCBudWxsLCAyKSwgJ3V0Zi04Jyk7XG4gIHJldHVybiB7YXBrU3RyaW5ncywgbG9jYWxQYXRofTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBsYW5ndWFnZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBuYW1lIG9mIGRldmljZSBsYW5ndWFnZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUxhbmd1YWdlID0gYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlTGFuZ3VhZ2UgKCkge1xuICBsZXQgbGFuZ3VhZ2U7XG4gIGlmIChhd2FpdCB0aGlzLmdldEFwaUxldmVsKCkgPCAyMykge1xuICAgIGxhbmd1YWdlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNMYW5ndWFnZSgpO1xuICAgIGlmICghbGFuZ3VhZ2UpIHtcbiAgICAgIGxhbmd1YWdlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VQcm9kdWN0TGFuZ3VhZ2UoKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGFuZ3VhZ2UgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VMb2NhbGUoKSkuc3BsaXQoJy0nKVswXTtcbiAgfVxuICByZXR1cm4gbGFuZ3VhZ2U7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgY291bnRyeSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBuYW1lIG9mIGRldmljZSBjb3VudHJ5LlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUNvdW50cnkgKCkge1xuICAvLyB0aGlzIG1ldGhvZCBpcyBvbmx5IHVzZWQgaW4gQVBJIDwgMjNcbiAgbGV0IGNvdW50cnkgPSBhd2FpdCB0aGlzLmdldERldmljZVN5c0NvdW50cnkoKTtcbiAgaWYgKCFjb3VudHJ5KSB7XG4gICAgY291bnRyeSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlUHJvZHVjdENvdW50cnkoKTtcbiAgfVxuICByZXR1cm4gY291bnRyeTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgbG9jYWxlLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlTG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlTG9jYWxlICgpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA+PSAyM1xuICBsZXQgbG9jYWxlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNMb2NhbGUoKTtcbiAgaWYgKCFsb2NhbGUpIHtcbiAgICBsb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RMb2NhbGUoKTtcbiAgfVxuICByZXR1cm4gbG9jYWxlO1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGxvY2FsZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdCBhbmQgdGhlIGZvcm1hdCBvZiB0aGUgbG9jYWxlIGlzIGVuLVVTLCBmb3IgZXhhbXBsZS5cbiAqIFRoaXMgbWV0aG9kIGNhbGwgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5LCBzbywgcGxlYXNlIHVzZSBzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkgYXMgcG9zc2libGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIE5hbWVzIG9mIHRoZSBkZXZpY2UgbGFuZ3VhZ2UgYW5kIHRoZSBjb3VudHJ5IGNvbm5lY3RlZCB3aXRoIGAtYC4gZS5nLiBlbi1VUy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIHNldERldmljZUxvY2FsZSAobG9jYWxlKSB7XG4gIGNvbnN0IHZhbGlkYXRlTG9jYWxlID0gbmV3IFJlZ0V4cCgvW2EtekEtWl0rLVthLXpBLVowLTldKy8pO1xuICBpZiAoIXZhbGlkYXRlTG9jYWxlLnRlc3QobG9jYWxlKSkge1xuICAgIGxvZy53YXJuKGBzZXREZXZpY2VMb2NhbGUgcmVxdWlyZXMgdGhlIGZvbGxvd2luZyBmb3JtYXQ6IGVuLVVTIG9yIGphLUpQYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IHNwbGl0X2xvY2FsZSA9IGxvY2FsZS5zcGxpdCgnLScpO1xuICBhd2FpdCB0aGlzLnNldERldmljZUxhbmd1YWdlQ291bnRyeShzcGxpdF9sb2NhbGVbMF0sIHNwbGl0X2xvY2FsZVsxXSk7XG59O1xuXG4vKipcbiAqIE1ha2Ugc3VyZSBjdXJyZW50IGRldmljZSBsb2NhbGUgaXMgZXhwZWN0ZWQgb3Igbm90LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIExhbmd1YWdlLiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gSWYgY3VycmVudCBsb2NhbGUgaXMgbGFuZ3VhZ2UgYW5kIGNvdW50cnkgYXMgYXJndW1lbnRzLCByZXR1cm4gdHJ1ZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmVuc3VyZUN1cnJlbnRMb2NhbGUgPSBhc3luYyBmdW5jdGlvbiBlbnN1cmVDdXJyZW50TG9jYWxlIChsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0ID0gbnVsbCkge1xuICBjb25zdCBoYXNMYW5ndWFnZSA9IF8uaXNTdHJpbmcobGFuZ3VhZ2UpO1xuICBjb25zdCBoYXNDb3VudHJ5ID0gXy5pc1N0cmluZyhjb3VudHJ5KTtcblxuICBpZiAoIWhhc0xhbmd1YWdlICYmICFoYXNDb3VudHJ5KSB7XG4gICAgbG9nLndhcm4oJ2Vuc3VyZUN1cnJlbnRMb2NhbGUgcmVxdWlyZXMgbGFuZ3VhZ2Ugb3IgY291bnRyeScpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIGdldCBsb3dlciBjYXNlIHZlcnNpb25zIG9mIHRoZSBzdHJpbmdzXG4gIGxhbmd1YWdlID0gKGxhbmd1YWdlIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICBjb3VudHJ5ID0gKGNvdW50cnkgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG5cbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgcmV0dXJuIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNSwgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgICAgICBsZXQgY3VyTGFuZ3VhZ2UsIGN1ckNvdW50cnk7XG4gICAgICAgIGlmIChoYXNMYW5ndWFnZSkge1xuICAgICAgICAgIGN1ckxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTGFuZ3VhZ2UoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIWhhc0NvdW50cnkgJiYgbGFuZ3VhZ2UgPT09IGN1ckxhbmd1YWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc0NvdW50cnkpIHtcbiAgICAgICAgICBjdXJDb3VudHJ5ID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlQ291bnRyeSgpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmICghaGFzTGFuZ3VhZ2UgJiYgY291bnRyeSA9PT0gY3VyQ291bnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gY3VyTGFuZ3VhZ2UgJiYgY291bnRyeSA9PT0gY3VyQ291bnRyeSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjdXJMb2NhbGUgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VMb2NhbGUoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy8gemgtaGFucy1jbiA6IHpoLWNuXG4gICAgICAgIGNvbnN0IGxvY2FsZUNvZGUgPSBzY3JpcHQgPyBgJHtsYW5ndWFnZX0tJHtzY3JpcHQudG9Mb3dlckNhc2UoKX0tJHtjb3VudHJ5fWAgOiBgJHtsYW5ndWFnZX0tJHtjb3VudHJ5fWA7XG5cbiAgICAgICAgaWYgKGxvY2FsZUNvZGUgPT09IGN1ckxvY2FsZSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgUmVxdWVzdGVkIGxvY2FsZSBpcyBlcXVhbCB0byBjdXJyZW50IGxvY2FsZTogJyR7Y3VyTG9jYWxlfSdgKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaWYgdGhlcmUgaGFzIGJlZW4gYW4gZXJyb3IsIHJlc3RhcnQgYWRiIGFuZCByZXRyeVxuICAgICAgbG9nLmVycm9yKGBVbmFibGUgdG8gY2hlY2sgZGV2aWNlIGxvY2FsaXphdGlvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVjb25uZWN0KCk7XG4gICAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZXN0YXJ0QWRiKCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezR9LiBlLmcuIEhhbnMgaW4gemgtSGFucy1DTiA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxhbmd1YWdlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIHNldERldmljZUxhbmd1YWdlQ291bnRyeSAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgbGV0IGhhc0xhbmd1YWdlID0gbGFuZ3VhZ2UgJiYgXy5pc1N0cmluZyhsYW5ndWFnZSk7XG4gIGxldCBoYXNDb3VudHJ5ID0gY291bnRyeSAmJiBfLmlzU3RyaW5nKGNvdW50cnkpO1xuICBpZiAoIWhhc0xhbmd1YWdlIHx8ICFoYXNDb3VudHJ5KSB7XG4gICAgbG9nLndhcm4oYHNldERldmljZUxhbmd1YWdlQ291bnRyeSByZXF1aXJlcyBsYW5ndWFnZSBhbmQgY291bnRyeSBhdCBsZWFzdGApO1xuICAgIGxvZy53YXJuKGBHb3QgbGFuZ3VhZ2U6ICcke2xhbmd1YWdlfScgYW5kIGNvdW50cnk6ICcke2NvdW50cnl9J2ApO1xuICAgIHJldHVybjtcbiAgfVxuICBsZXQgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgbGFuZ3VhZ2UgPSAobGFuZ3VhZ2UgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gIGNvdW50cnkgPSAoY291bnRyeSB8fCAnJykudG9VcHBlckNhc2UoKTtcblxuICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgIGxldCBjdXJMYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxhbmd1YWdlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IGN1ckNvdW50cnkgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VDb3VudHJ5KCkpLnRvVXBwZXJDYXNlKCk7XG5cbiAgICBpZiAobGFuZ3VhZ2UgIT09IGN1ckxhbmd1YWdlIHx8IGNvdW50cnkgIT09IGN1ckNvdW50cnkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcChsYW5ndWFnZSwgY291bnRyeSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBjdXJMb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZUxvY2FsZSgpO1xuXG4gICAgLy8gemgtSGFucy1DTiA6IHpoLUNOXG4gICAgY29uc3QgbG9jYWxlQ29kZSA9IHNjcmlwdCA/IGAke2xhbmd1YWdlfS0ke3NjcmlwdH0tJHtjb3VudHJ5fWAgOiBgJHtsYW5ndWFnZX0tJHtjb3VudHJ5fWA7XG4gICAgbG9nLmRlYnVnKGBDdXJyZW50IGxvY2FsZTogJyR7Y3VyTG9jYWxlfSc7IHJlcXVlc3RlZCBsb2NhbGU6ICcke2xvY2FsZUNvZGV9J2ApO1xuICAgIGlmIChsb2NhbGVDb2RlLnRvTG93ZXJDYXNlKCkgIT09IGN1ckxvY2FsZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldERldmljZVN5c0xvY2FsZVZpYVNldHRpbmdBcHAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEFwcEluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIC0gUGFja2FnZSBuYW1lLCBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB2ZXJzaW9uQ29kZSAtIFZlcnNpb24gY29kZS5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB2ZXJzaW9uTmFtZSAtIFZlcnNpb24gbmFtZSwgZm9yIGV4YW1wbGUgJzEuMCcuXG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgaW5mbyBmcm9tIGxvY2FsIGFwayBmaWxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byBleGlzdGluZyAuYXBrKHMpIHBhY2thZ2Ugb24gdGhlIGxvY2FsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgc3lzdGVtLlxuICogQHJldHVybiB7P0FwcEluZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mb3JtYXRpb24uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRBcGtJbmZvID0gYXN5bmMgZnVuY3Rpb24gZ2V0QXBrSW5mbyAoYXBwUGF0aCkge1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgcGF0aCAke2FwcFBhdGh9IGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlYCk7XG4gIH1cblxuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgYXBrUmVhZGVyID0gYXdhaXQgQXBrUmVhZGVyLm9wZW4oYXBwUGF0aCk7XG4gICAgY29uc3QgbWFuaWZlc3QgPSBhd2FpdCBhcGtSZWFkZXIucmVhZE1hbmlmZXN0KCk7XG4gICAgY29uc3Qge3BrZywgdmVyc2lvbk5hbWUsIHZlcnNpb25Db2RlfSA9IHBhcnNlTWFuaWZlc3QobWFuaWZlc3QpO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBwa2csXG4gICAgICB2ZXJzaW9uQ29kZSxcbiAgICAgIHZlcnNpb25OYW1lLFxuICAgIH07XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cud2FybihgRXJyb3IgJyR7ZS5tZXNzYWdlfScgd2hpbGUgZ2V0dGluZyBiYWRnaW5nIGluZm9gKTtcbiAgfVxuICByZXR1cm4ge307XG59O1xuXG4vKipcbiAqIEdldCB0aGUgcGFja2FnZSBpbmZvIGZyb20gdGhlIGluc3RhbGxlZCBhcHBsaWNhdGlvbi5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIGluc3RhbGxlZCBwYWNrYWdlLlxuICogQHJldHVybiB7P0FwcEluZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mb3JtYXRpb24uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRQYWNrYWdlSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIGdldFBhY2thZ2VJbmZvIChwa2cpIHtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIHBhY2thZ2UgaW5mbyBmb3IgJyR7cGtnfSdgKTtcbiAgbGV0IHJlc3VsdCA9IHtuYW1lOiBwa2d9O1xuICB0cnkge1xuICAgIGNvbnN0IHN0ZG91dCA9IGF3YWl0IHRoaXMuc2hlbGwoWydkdW1wc3lzJywgJ3BhY2thZ2UnLCBwa2ddKTtcbiAgICBjb25zdCB2ZXJzaW9uTmFtZU1hdGNoID0gbmV3IFJlZ0V4cCgvdmVyc2lvbk5hbWU9KFtcXGQrLl0rKS8pLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAodmVyc2lvbk5hbWVNYXRjaCkge1xuICAgICAgcmVzdWx0LnZlcnNpb25OYW1lID0gdmVyc2lvbk5hbWVNYXRjaFsxXTtcbiAgICB9XG4gICAgY29uc3QgdmVyc2lvbkNvZGVNYXRjaCA9IG5ldyBSZWdFeHAoL3ZlcnNpb25Db2RlPShcXGQrKS8pLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAodmVyc2lvbkNvZGVNYXRjaCkge1xuICAgICAgcmVzdWx0LnZlcnNpb25Db2RlID0gcGFyc2VJbnQodmVyc2lvbkNvZGVNYXRjaFsxXSwgMTApO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgRXJyb3IgJyR7ZXJyLm1lc3NhZ2V9JyB3aGlsZSBkdW1waW5nIHBhY2thZ2UgaW5mb2ApO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG4vKipcbiAqIEZldGNoZXMgYmFzZS5hcGsgb2YgdGhlIGdpdmVuIHBhY2thZ2UgdG8gdGhlIGxvY2FsIGZpbGUgc3lzdGVtXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyBUaGUgcGFja2FnZSBpZGVudGlmaWVyIChtdXN0IGJlIGFscmVhZHkgaW5zdGFsbGVkIG9uIHRoZSBkZXZpY2UpXG4gKiBAcGFyYW0ge3N0cmluZ30gdG1wRGlyIFRoZSBkZXN0aW5hdGlvbiBmb2xkZXIgcGF0aFxuICogQHJldHVybnMge3N0cmluZ30gRnVsbCBwYXRoIHRvIHRoZSBkb3dubG9hZGVkIGZpbGVcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZmV0Y2hpbmcgdGhlIC5hcGtcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnB1bGxBcGsgPSBhc3luYyBmdW5jdGlvbiBwdWxsQXBrIChwa2csIHRtcERpcikge1xuICBjb25zdCBzdGRvdXQgPSBfLnRyaW0oYXdhaXQgdGhpcy5zaGVsbChbJ3BtJywgJ3BhdGgnLCBwa2ddKSk7XG4gIGNvbnN0IHBhY2thZ2VNYXJrZXIgPSAncGFja2FnZTonO1xuICBpZiAoIV8uc3RhcnRzV2l0aChzdGRvdXQsIHBhY2thZ2VNYXJrZXIpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcHVsbCB0aGUgLmFwayBwYWNrYWdlIGZvciAnJHtwa2d9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7c3Rkb3V0fWApO1xuICB9XG5cbiAgY29uc3QgcmVtb3RlUGF0aCA9IHN0ZG91dC5yZXBsYWNlKHBhY2thZ2VNYXJrZXIsICcnKTtcbiAgY29uc3QgdG1wQXBwID0gcGF0aC5yZXNvbHZlKHRtcERpciwgYCR7cGtnfS5hcGtgKTtcbiAgYXdhaXQgdGhpcy5wdWxsKHJlbW90ZVBhdGgsIHRtcEFwcCk7XG4gIGxvZy5kZWJ1ZyhgUHVsbGVkIGFwcCBmb3IgcGFja2FnZSAnJHtwa2d9JyB0byAnJHt0bXBBcHB9J2ApO1xuICByZXR1cm4gdG1wQXBwO1xufTtcblxuZXhwb3J0IHsgUkVNT1RFX0NBQ0hFX1JPT1QgfTtcbmV4cG9ydCBkZWZhdWx0IGFwa1V0aWxzTWV0aG9kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFNQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxlQUFlLEdBQUcsRUFBeEI7QUFFQSxNQUFNQywrQkFBK0IsR0FDbkMseUdBREY7QUFFQUQsZUFBZSxDQUFDRSxpQkFBaEIsR0FBb0M7RUFDbENDLE9BQU8sRUFBRSxTQUR5QjtFQUVsQ0MsYUFBYSxFQUFFLGNBRm1CO0VBR2xDQyx1QkFBdUIsRUFBRSx1QkFIUztFQUlsQ0Msc0JBQXNCLEVBQUUsc0JBSlU7RUFLbENDLHVCQUF1QixFQUFFO0FBTFMsQ0FBcEM7QUFPQSxNQUFNQyxpQkFBaUIsR0FBRyw4QkFBMUI7OztBQVVBUixlQUFlLENBQUNTLGNBQWhCLEdBQWlDLGVBQWVBLGNBQWYsQ0FBK0JDLEdBQS9CLEVBQW9DO0VBQ25FQyxlQUFBLENBQUlDLEtBQUosQ0FBVyw4QkFBNkJGLEdBQUksRUFBNUM7O0VBQ0EsTUFBTUcsZ0JBQWdCLEdBQUcsSUFBSUMsTUFBSixDQUFZLHNCQUFxQkMsZUFBQSxDQUFFQyxZQUFGLENBQWVOLEdBQWYsQ0FBb0IsWUFBckQsRUFBa0UsR0FBbEUsQ0FBekI7O0VBQ0EsSUFBSTtJQUNGLE1BQU1PLE1BQU0sR0FBRyxNQUFNLEtBQUtDLEtBQUwsQ0FBVyxDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCUixHQUF2QixDQUFYLENBQXJCO0lBQ0EsTUFBTVMsV0FBVyxHQUFHTixnQkFBZ0IsQ0FBQ08sSUFBakIsQ0FBc0JILE1BQXRCLENBQXBCOztJQUNBTixlQUFBLENBQUlDLEtBQUosQ0FBVyxJQUFHRixHQUFJLE9BQU0sQ0FBQ1MsV0FBRCxHQUFlLE1BQWYsR0FBd0IsRUFBRyxZQUFuRDs7SUFDQSxPQUFPQSxXQUFQO0VBQ0QsQ0FMRCxDQUtFLE9BQU9FLENBQVAsRUFBVTtJQUNWLE1BQU0sSUFBSUMsS0FBSixDQUFXLHFCQUFvQlosR0FBSSxtQ0FBa0NXLENBQUMsQ0FBQ0UsT0FBUSxFQUEvRSxDQUFOO0VBQ0Q7QUFDRixDQVhEOztBQTBCQXZCLGVBQWUsQ0FBQ3dCLFFBQWhCLEdBQTJCLGVBQWVBLFFBQWYsQ0FBeUJDLEdBQXpCLEVBQThCZixHQUE5QixFQUFtQ2dCLElBQUksR0FBRyxFQUExQyxFQUE4QztFQUN2RSxNQUFNO0lBQ0pDLGFBQWEsR0FBRztFQURaLElBRUZELElBRko7O0VBSUEsSUFBSSxDQUFDRCxHQUFELElBQVEsQ0FBQ2YsR0FBYixFQUFrQjtJQUNoQixNQUFNLElBQUlZLEtBQUosQ0FBVSx3Q0FBVixDQUFOO0VBQ0Q7O0VBRUQsTUFBTU0sSUFBSSxHQUFHLENBQUMsSUFBRCxFQUFPLE9BQVAsQ0FBYjs7RUFDQSxJQUFJRCxhQUFKLEVBQW1CO0lBQ2pCQyxJQUFJLENBQUNDLElBQUwsQ0FBVSxJQUFWO0VBQ0Q7O0VBQ0RELElBQUksQ0FBQ0MsSUFBTCxDQUFVLElBQVYsRUFBZ0IsNEJBQWhCLEVBQ0UsSUFERixFQUNRLElBQUFDLHVCQUFBLEVBQWVMLEdBQWYsQ0FEUixFQUVFZixHQUZGOztFQUlBLElBQUk7SUFDRixNQUFNcUIsR0FBRyxHQUFHLE1BQU0sS0FBS2IsS0FBTCxDQUFXVSxJQUFYLENBQWxCOztJQUNBLElBQUlHLEdBQUcsQ0FBQ0MsV0FBSixHQUFrQkMsUUFBbEIsQ0FBMkIsMEJBQTNCLENBQUosRUFBNEQ7TUFDMUQsTUFBTSxJQUFJWCxLQUFKLENBQVVTLEdBQVYsQ0FBTjtJQUNEO0VBQ0YsQ0FMRCxDQUtFLE9BQU9WLENBQVAsRUFBVTtJQUNWLE1BQU0sSUFBSUMsS0FBSixDQUFXLGtEQUFpREQsQ0FBRSxFQUE5RCxDQUFOO0VBQ0Q7QUFDRixDQXpCRDs7QUE0REFyQixlQUFlLENBQUNrQyxRQUFoQixHQUEyQixlQUFlQSxRQUFmLENBQXlCQyxlQUFlLEdBQUcsRUFBM0MsRUFBK0M7RUFDeEUsSUFBSSxDQUFDQSxlQUFlLENBQUN6QixHQUFqQixJQUF3QixFQUFFeUIsZUFBZSxDQUFDQyxRQUFoQixJQUE0QkQsZUFBZSxDQUFDRSxNQUE5QyxDQUE1QixFQUFtRjtJQUNqRixNQUFNLElBQUlmLEtBQUosQ0FBVSwwRUFBVixDQUFOO0VBQ0Q7O0VBRURhLGVBQWUsR0FBR3BCLGVBQUEsQ0FBRXVCLEtBQUYsQ0FBUUgsZUFBUixDQUFsQjs7RUFDQSxJQUFJQSxlQUFlLENBQUNDLFFBQXBCLEVBQThCO0lBQzVCRCxlQUFlLENBQUNDLFFBQWhCLEdBQTJCRCxlQUFlLENBQUNDLFFBQWhCLENBQXlCRyxPQUF6QixDQUFpQyxHQUFqQyxFQUFzQyxLQUF0QyxDQUEzQjtFQUNEOztFQUVEeEIsZUFBQSxDQUFFeUIsUUFBRixDQUFXTCxlQUFYLEVBQTRCO0lBQzFCTSxPQUFPLEVBQUVOLGVBQWUsQ0FBQ3pCLEdBREM7SUFFMUJpQixhQUFhLEVBQUUsSUFGVztJQUcxQmUsWUFBWSxFQUFFLEtBSFk7SUFJMUJDLEtBQUssRUFBRSxJQUptQjtJQUsxQkMsT0FBTyxFQUFFO0VBTGlCLENBQTVCOztFQVFBVCxlQUFlLENBQUNNLE9BQWhCLEdBQTBCTixlQUFlLENBQUNNLE9BQWhCLElBQTJCTixlQUFlLENBQUN6QixHQUFyRTtFQUVBLE1BQU1tQyxRQUFRLEdBQUcsTUFBTSxLQUFLQyxXQUFMLEVBQXZCO0VBQ0EsTUFBTUMsR0FBRyxHQUFHLElBQUFDLHNCQUFBLEVBQWNiLGVBQWQsRUFBK0JVLFFBQS9CLENBQVo7RUFDQSxNQUFNSSxVQUFVLEdBQUksR0FBRWQsZUFBZSxDQUFDRSxNQUFPLEdBQUVGLGVBQWUsQ0FBQ2UsdUJBQWhCLEdBQTBDLE1BQU1mLGVBQWUsQ0FBQ2UsdUJBQWhFLEdBQTBGLEVBQUcsRUFBNUk7O0VBQ0EsSUFBSTtJQUNGLE1BQU1DLFNBQVMsR0FBRyxFQUFsQjs7SUFDQSxJQUFJcEMsZUFBQSxDQUFFcUMsU0FBRixDQUFZakIsZUFBZSxDQUFDa0IsWUFBNUIsS0FBNkNsQixlQUFlLENBQUNrQixZQUFoQixJQUFnQyxDQUFqRixFQUFvRjtNQUNsRkYsU0FBUyxDQUFDRyxPQUFWLEdBQW9CbkIsZUFBZSxDQUFDa0IsWUFBcEM7SUFDRDs7SUFDRCxNQUFNcEMsTUFBTSxHQUFHLE1BQU0sS0FBS0MsS0FBTCxDQUFXNkIsR0FBWCxFQUFnQkksU0FBaEIsQ0FBckI7O0lBQ0EsSUFBSWxDLE1BQU0sQ0FBQ2dCLFFBQVAsQ0FBZ0IsdUJBQWhCLEtBQTRDaEIsTUFBTSxDQUFDZ0IsUUFBUCxDQUFnQixnQkFBaEIsQ0FBaEQsRUFBbUY7TUFDakYsSUFBSUUsZUFBZSxDQUFDUSxLQUFoQixJQUF5QixDQUFDUixlQUFlLENBQUNDLFFBQWhCLENBQXlCbUIsVUFBekIsQ0FBb0MsR0FBcEMsQ0FBOUIsRUFBd0U7UUFDdEU1QyxlQUFBLENBQUlDLEtBQUosQ0FBVyxvREFBRCxHQUNDLG1CQUFrQnVCLGVBQWUsQ0FBQ0MsUUFBUyxpQkFEdEQ7O1FBRUFELGVBQWUsQ0FBQ0MsUUFBaEIsR0FBNEIsSUFBR0QsZUFBZSxDQUFDQyxRQUFTLEVBQXhEO1FBQ0FELGVBQWUsQ0FBQ1EsS0FBaEIsR0FBd0IsS0FBeEI7UUFDQSxPQUFPLE1BQU0sS0FBS1QsUUFBTCxDQUFjQyxlQUFkLENBQWI7TUFDRDs7TUFDRCxNQUFNLElBQUliLEtBQUosQ0FBVyxrQkFBaUJhLGVBQWUsQ0FBQ0MsUUFBUyxrQ0FBM0MsR0FDQywrRUFEWCxDQUFOO0lBRUQsQ0FWRCxNQVVPLElBQUluQixNQUFNLENBQUNnQixRQUFQLENBQWdCLDZDQUFoQixLQUFrRWhCLE1BQU0sQ0FBQ2dCLFFBQVAsQ0FBZ0IsdURBQWhCLENBQXRFLEVBQWdKO01BQ3JKLE1BQU0sSUFBSVgsS0FBSixDQUFXLHdCQUF1QjJCLFVBQVcsa0NBQW5DLEdBQ0MsK0VBRFgsQ0FBTjtJQUVELENBSE0sTUFHQSxJQUFJaEMsTUFBTSxDQUFDZ0IsUUFBUCxDQUFnQiw2QkFBaEIsQ0FBSixFQUFvRDtNQUV6RCxNQUFNLElBQUlYLEtBQUosQ0FBVyw0QkFBMkJhLGVBQWUsQ0FBQ0MsUUFBUyw2QkFBckQsR0FDQyxtREFEWCxDQUFOO0lBRUQ7O0lBQ0QsSUFBSUQsZUFBZSxDQUFDTyxZQUFwQixFQUFrQztNQUNoQyxNQUFNLEtBQUtjLGVBQUwsQ0FBcUJyQixlQUFlLENBQUNNLE9BQXJDLEVBQThDTixlQUFlLENBQUNPLFlBQTlELEVBQTRFUCxlQUFlLENBQUNrQixZQUE1RixDQUFOO0lBQ0Q7O0lBQ0QsT0FBT3BDLE1BQVA7RUFDRCxDQTVCRCxDQTRCRSxPQUFPSSxDQUFQLEVBQVU7SUFDVixNQUFNb0MsYUFBYSxHQUFHdEIsZUFBZSxDQUFDekIsR0FBaEIsSUFBdUJ1QyxVQUE3QztJQUNBLE1BQU0sSUFBSTNCLEtBQUosQ0FBVyxxQkFBb0JtQyxhQUFjLGlCQUFuQyxHQUNiLFNBQVF4RCwrQkFBZ0Msd0JBRDNCLEdBRWIsbUJBQWtCb0IsQ0FBQyxDQUFDRSxPQUFRLEVBRnpCLENBQU47RUFHRDtBQUNGLENBekREOztBQThEQXZCLGVBQWUsQ0FBQzBELFdBQWhCLEdBQThCLGVBQWVBLFdBQWYsR0FBOEI7RUFDMUQsTUFBTWIsUUFBUSxHQUFHLE1BQU0sS0FBS0MsV0FBTCxFQUF2QjtFQUdBLE1BQU1hLFVBQVUsR0FBR2QsUUFBUSxJQUFJLEVBQVosR0FBaUIsVUFBakIsR0FBOEIsU0FBakQ7RUFDQSxNQUFNRSxHQUFHLEdBQUcsQ0FBQyxTQUFELEVBQVksUUFBWixFQUFzQlksVUFBdEIsQ0FBWjtFQUVBLE9BQU8sTUFBTSxLQUFLekMsS0FBTCxDQUFXNkIsR0FBWCxDQUFiO0FBQ0QsQ0FSRDs7QUF1QkEvQyxlQUFlLENBQUM0RCw0QkFBaEIsR0FBK0MsZUFBZUEsNEJBQWYsR0FBK0M7RUFDNUZqRCxlQUFBLENBQUlDLEtBQUosQ0FBVSxzQ0FBVjs7RUFDQSxJQUFJSyxNQUFKOztFQUNBLElBQUk7SUFDRkEsTUFBTSxHQUFHLE1BQU0sS0FBS3lDLFdBQUwsRUFBZjtFQUNELENBRkQsQ0FFRSxPQUFPckMsQ0FBUCxFQUFVO0lBQ1YsTUFBTSxJQUFJQyxLQUFKLENBQ0gsa0ZBQWlGRCxDQUFDLENBQUNFLE9BQVEsRUFEeEYsQ0FBTjtFQUdEOztFQUVELE1BQU1zQyxnQkFBZ0IsR0FBRyx1QkFBekI7RUFFQSxNQUFNQyxZQUFZLEdBQUcsSUFBSWhELE1BQUosQ0FDbkIsZ0dBRG1CLEVBRW5CLElBRm1CLENBQXJCO0VBSUEsTUFBTWlELGtCQUFrQixHQUFHLHlCQUEzQjtFQUNBLE1BQU1DLGlCQUFpQixHQUFHLElBQUlsRCxNQUFKLENBQVcseURBQVgsRUFBc0UsSUFBdEUsQ0FBMUI7RUFFQSxNQUFNbUQsb0JBQW9CLEdBQUcsRUFBN0I7RUFDQSxNQUFNQyx5QkFBeUIsR0FBRyxFQUFsQzs7RUFDQSxLQUFLLE1BQU0sQ0FBQ0MsVUFBRCxFQUFhQyxPQUFiLENBQVgsSUFBb0MsQ0FDbEMsQ0FBQ0gsb0JBQUQsRUFBdUJILFlBQXZCLENBRGtDLEVBRWxDLENBQUNJLHlCQUFELEVBQTRCRixpQkFBNUIsQ0FGa0MsQ0FBcEMsRUFHRztJQUNELElBQUlLLEtBQUo7O0lBQ0EsT0FBUUEsS0FBSyxHQUFHRCxPQUFPLENBQUNFLElBQVIsQ0FBYXJELE1BQWIsQ0FBaEIsRUFBdUM7TUFDckNrRCxVQUFVLENBQUN0QyxJQUFYLENBQWdCO1FBQ2QwQyxVQUFVLEVBQUVGLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU0csSUFBVCxFQURFO1FBRWRDLFdBQVcsRUFBRUosS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTRyxJQUFUO01BRkMsQ0FBaEI7SUFJRDtFQUNGOztFQUNELElBQUlQLG9CQUFvQixDQUFDUyxNQUFyQixHQUE4QixDQUE5QixJQUFtQ1IseUJBQXlCLENBQUNRLE1BQTFCLEdBQW1DLENBQTFFLEVBQTZFO0lBRTNFLE9BQU8zRCxlQUFBLENBQUU0RCxnQkFBRixDQUFtQlYsb0JBQW5CLEVBQXlDQyx5QkFBekMsRUFBb0VuRCxlQUFBLENBQUU2RCxPQUF0RSxFQUErRSxDQUEvRSxLQUNGWCxvQkFBb0IsQ0FBQyxDQUFELENBRHpCO0VBRUQ7O0VBQ0QsSUFBSUEsb0JBQW9CLENBQUNTLE1BQXJCLEdBQThCLENBQTlCLElBQW1DUix5QkFBeUIsQ0FBQ1EsTUFBMUIsR0FBbUMsQ0FBMUUsRUFBNkU7SUFDM0UsT0FBT1Qsb0JBQW9CLENBQUMsQ0FBRCxDQUFwQixJQUEyQkMseUJBQXlCLENBQUMsQ0FBRCxDQUEzRDtFQUNEOztFQUVELEtBQUssTUFBTUUsT0FBWCxJQUFzQixDQUFDUCxnQkFBRCxFQUFtQkUsa0JBQW5CLENBQXRCLEVBQThEO0lBQzVELElBQUlLLE9BQU8sQ0FBQ0UsSUFBUixDQUFhckQsTUFBYixDQUFKLEVBQTBCO01BQ3hCLE9BQU87UUFDTHNELFVBQVUsRUFBRSxJQURQO1FBRUxFLFdBQVcsRUFBRTtNQUZSLENBQVA7SUFJRDtFQUNGOztFQUVEOUQsZUFBQSxDQUFJQyxLQUFKLENBQVVLLE1BQVY7O0VBQ0EsTUFBTSxJQUFJSyxLQUFKLENBQVUsK0RBQVYsQ0FBTjtBQUNELENBdEREOztBQW1FQXRCLGVBQWUsQ0FBQzZFLG9CQUFoQixHQUF1QyxlQUFlQSxvQkFBZixDQUFxQ25FLEdBQXJDLEVBQTBDMEIsUUFBMUMsRUFBb0QwQyxXQUFwRCxFQUFpRUMsTUFBTSxHQUFHLEtBQTFFLEVBQWlGO0VBQ3RILElBQUksQ0FBQ3JFLEdBQUQsSUFBUSxDQUFDMEIsUUFBYixFQUF1QjtJQUNyQixNQUFNLElBQUlkLEtBQUosQ0FBVSxnQ0FBVixDQUFOO0VBQ0Q7O0VBQ0RYLGVBQUEsQ0FBSUMsS0FBSixDQUFXLGlCQUFnQm1FLE1BQU8sa0NBQWlDckUsR0FBSSxRQUE3RCxHQUNDLGNBQWEwQixRQUFTLE9BQU0wQyxXQUFXLEdBQUcsTUFBSCxHQUFZLEVBQUcsYUFEakU7O0VBR0EsTUFBTUUsVUFBVSxHQUFJQyxLQUFELElBQVdBLEtBQUssQ0FBQ0MsS0FBTixDQUFZLEdBQVosRUFBaUJDLEdBQWpCLENBQXNCQyxJQUFELElBQVVBLElBQUksQ0FBQ1osSUFBTCxFQUEvQixDQUE5Qjs7RUFDQSxNQUFNYSxXQUFXLEdBQUdMLFVBQVUsQ0FBQ3RFLEdBQUQsQ0FBOUI7RUFDQSxNQUFNNEUsYUFBYSxHQUFHTixVQUFVLENBQUM1QyxRQUFELENBQWhDO0VBRUEsTUFBTW1ELHFCQUFxQixHQUFHLEVBQTlCOztFQUNBLEtBQUssTUFBTUMsV0FBWCxJQUEwQkYsYUFBMUIsRUFBeUM7SUFDdkMsSUFBSUUsV0FBVyxDQUFDakMsVUFBWixDQUF1QixHQUF2QixDQUFKLEVBQWlDO01BRS9CLEtBQUssTUFBTWtDLFVBQVgsSUFBeUJKLFdBQXpCLEVBQXNDO1FBQ3BDRSxxQkFBcUIsQ0FBQzFELElBQXRCLENBQTRCLEdBQUU0RCxVQUFXLEdBQUVELFdBQVksRUFBNUIsQ0FBOEJqRCxPQUE5QixDQUFzQyxNQUF0QyxFQUE4QyxHQUE5QyxDQUEzQjtNQUNEO0lBQ0YsQ0FMRCxNQUtPO01BRUxnRCxxQkFBcUIsQ0FBQzFELElBQXRCLENBQTJCMkQsV0FBM0I7TUFDQUQscUJBQXFCLENBQUMxRCxJQUF0QixDQUE0QixHQUFFbkIsR0FBSSxJQUFHOEUsV0FBWSxFQUFqRDtJQUNEO0VBQ0Y7O0VBQ0Q3RSxlQUFBLENBQUlDLEtBQUosQ0FBVyx1Q0FBc0MyRSxxQkFBcUIsQ0FBQ0osR0FBdEIsQ0FBMkJDLElBQUQsSUFBVyxJQUFHQSxJQUFLLEdBQTdDLEVBQWlETSxJQUFqRCxDQUFzRCxJQUF0RCxDQUE0RCxFQUE3Rzs7RUFFQSxNQUFNQyx3QkFBd0IsR0FBR0oscUJBQXFCLENBQUNKLEdBQXRCLENBQzlCUyxPQUFELElBQWEsSUFBSTlFLE1BQUosQ0FBWSxJQUFHOEUsT0FBTyxDQUFDckQsT0FBUixDQUFnQixLQUFoQixFQUF1QixLQUF2QixFQUE4QkEsT0FBOUIsQ0FBc0MsS0FBdEMsRUFBNkMsS0FBN0MsRUFBb0RBLE9BQXBELENBQTRELEtBQTVELEVBQW1FLEtBQW5FLENBQTBFLEdBQXpGLENBRGtCLENBQWpDOztFQUlBLE1BQU1zRCxhQUFhLEdBQUcsWUFBWTtJQUNoQyxJQUFJdEIsVUFBSjtJQUNBLElBQUlFLFdBQUo7O0lBQ0EsSUFBSTtNQUNGLENBQUM7UUFBQ0YsVUFBRDtRQUFhRTtNQUFiLElBQTRCLE1BQU0sS0FBS2IsNEJBQUwsRUFBbkM7SUFDRCxDQUZELENBRUUsT0FBT3ZDLENBQVAsRUFBVTtNQUNWVixlQUFBLENBQUlDLEtBQUosQ0FBVVMsQ0FBQyxDQUFDRSxPQUFaOztNQUNBLE9BQU8sS0FBUDtJQUNEOztJQUNELElBQUlrRCxXQUFXLElBQUlGLFVBQW5CLEVBQStCO01BQzdCLE1BQU11QixzQkFBc0IsR0FBR3JCLFdBQVcsQ0FBQ2xCLFVBQVosQ0FBdUIsR0FBdkIsSUFBK0IsR0FBRWdCLFVBQVcsR0FBRUUsV0FBWSxFQUExRCxHQUE4REEsV0FBN0Y7O01BQ0E5RCxlQUFBLENBQUlDLEtBQUosQ0FBVyxtQkFBa0IyRCxVQUFXLDBDQUF5Q3VCLHNCQUF1QixHQUF4Rzs7TUFDQSxNQUFNQyxlQUFlLEdBQUdoRixlQUFBLENBQUVrQixRQUFGLENBQVdvRCxXQUFYLEVBQXdCZCxVQUF4QixLQUNuQm9CLHdCQUF3QixDQUFDSyxJQUF6QixDQUErQkMsQ0FBRCxJQUFPQSxDQUFDLENBQUM3RSxJQUFGLENBQU8wRSxzQkFBUCxDQUFyQyxDQURMOztNQUVBLElBQUssQ0FBQ2hCLFdBQUQsSUFBZ0JpQixlQUFqQixJQUFzQ2pCLFdBQVcsSUFBSSxDQUFDaUIsZUFBMUQsRUFBNEU7UUFDMUUsT0FBTyxJQUFQO01BQ0Q7SUFDRjs7SUFDRHBGLGVBQUEsQ0FBSUMsS0FBSixDQUFVLDJDQUFWOztJQUNBLE9BQU8sS0FBUDtFQUNELENBcEJEOztFQXNCQSxJQUFJO0lBQ0YsTUFBTSxJQUFBc0YsMEJBQUEsRUFBaUJMLGFBQWpCLEVBQWdDO01BQ3BDZCxNQUFNLEVBQUVvQixRQUFRLENBQUNwQixNQUFELEVBQVMsRUFBVCxDQURvQjtNQUVwQ3FCLFVBQVUsRUFBRTtJQUZ3QixDQUFoQyxDQUFOO0VBSUQsQ0FMRCxDQUtFLE9BQU8vRSxDQUFQLEVBQVU7SUFDVixNQUFNLElBQUlDLEtBQUosQ0FBVyxHQUFFaUUscUJBQXFCLENBQUNKLEdBQXRCLENBQTJCQyxJQUFELElBQVcsSUFBR0EsSUFBSyxHQUE3QyxFQUFpRE0sSUFBakQsQ0FBc0QsTUFBdEQsQ0FBOEQsVUFBU1osV0FBVyxHQUFHLFNBQUgsR0FBZSxTQUFVLElBQTlHLEdBQ2IsU0FBUTdFLCtCQUFnQyxzQkFEckMsQ0FBTjtFQUVEO0FBQ0YsQ0E3REQ7O0FBd0VBRCxlQUFlLENBQUN3RCxlQUFoQixHQUFrQyxlQUFlQSxlQUFmLENBQWdDOUMsR0FBaEMsRUFBcUMyRixHQUFyQyxFQUEwQ3RCLE1BQU0sR0FBRyxLQUFuRCxFQUEwRDtFQUMxRixNQUFNLEtBQUtGLG9CQUFMLENBQTBCbkUsR0FBMUIsRUFBK0IyRixHQUEvQixFQUFvQyxLQUFwQyxFQUEyQ3RCLE1BQTNDLENBQU47QUFDRCxDQUZEOztBQWFBL0UsZUFBZSxDQUFDc0csa0JBQWhCLEdBQXFDLGVBQWVBLGtCQUFmLENBQW1DNUYsR0FBbkMsRUFBd0MyRixHQUF4QyxFQUE2Q3RCLE1BQU0sR0FBRyxLQUF0RCxFQUE2RDtFQUNoRyxNQUFNLEtBQUtGLG9CQUFMLENBQTBCbkUsR0FBMUIsRUFBK0IyRixHQUEvQixFQUFvQyxJQUFwQyxFQUEwQ3RCLE1BQTFDLENBQU47QUFDRCxDQUZEOztBQW9CQS9FLGVBQWUsQ0FBQ3VHLFlBQWhCLEdBQStCLGVBQWVBLFlBQWYsQ0FBNkI3RixHQUE3QixFQUFrQzhGLE9BQU8sR0FBRyxFQUE1QyxFQUFnRDtFQUM3RTdGLGVBQUEsQ0FBSUMsS0FBSixDQUFXLGdCQUFlRixHQUFJLEVBQTlCOztFQUNBLElBQUksRUFBQyxNQUFNLEtBQUtELGNBQUwsQ0FBb0JDLEdBQXBCLENBQVAsQ0FBSixFQUFxQztJQUNuQ0MsZUFBQSxDQUFJOEYsSUFBSixDQUFVLEdBQUUvRixHQUFJLGdFQUFoQjs7SUFDQSxPQUFPLEtBQVA7RUFDRDs7RUFFRCxNQUFNcUMsR0FBRyxHQUFHLENBQUMsV0FBRCxDQUFaOztFQUNBLElBQUl5RCxPQUFPLENBQUNFLFFBQVosRUFBc0I7SUFDcEIzRCxHQUFHLENBQUNsQixJQUFKLENBQVMsSUFBVDtFQUNEOztFQUNEa0IsR0FBRyxDQUFDbEIsSUFBSixDQUFTbkIsR0FBVDtFQUVBLElBQUlPLE1BQUo7O0VBQ0EsSUFBSTtJQUNGLE1BQU0sS0FBSzBGLFNBQUwsQ0FBZWpHLEdBQWYsQ0FBTjtJQUNBTyxNQUFNLEdBQUcsQ0FBQyxNQUFNLEtBQUsyRixPQUFMLENBQWE3RCxHQUFiLEVBQWtCO01BQUNPLE9BQU8sRUFBRWtELE9BQU8sQ0FBQ2xEO0lBQWxCLENBQWxCLENBQVAsRUFBc0RrQixJQUF0RCxFQUFUO0VBQ0QsQ0FIRCxDQUdFLE9BQU9uRCxDQUFQLEVBQVU7SUFDVixNQUFNLElBQUlDLEtBQUosQ0FBVyw0Q0FBMkNELENBQUMsQ0FBQ0UsT0FBUSxFQUFoRSxDQUFOO0VBQ0Q7O0VBQ0RaLGVBQUEsQ0FBSUMsS0FBSixDQUFXLFFBQU9tQyxHQUFHLENBQUMyQyxJQUFKLENBQVMsR0FBVCxDQUFjLHFCQUFvQnpFLE1BQU8sRUFBM0Q7O0VBQ0EsSUFBSUEsTUFBTSxDQUFDZ0IsUUFBUCxDQUFnQixTQUFoQixDQUFKLEVBQWdDO0lBQzlCdEIsZUFBQSxDQUFJOEYsSUFBSixDQUFVLEdBQUUvRixHQUFJLCtCQUFoQjs7SUFDQSxPQUFPLElBQVA7RUFDRDs7RUFDREMsZUFBQSxDQUFJOEYsSUFBSixDQUFVLEdBQUUvRixHQUFJLHNCQUFoQjs7RUFDQSxPQUFPLEtBQVA7QUFDRCxDQTNCRDs7QUFxQ0FWLGVBQWUsQ0FBQzZHLHFCQUFoQixHQUF3QyxlQUFlQSxxQkFBZixDQUFzQ0MsZUFBdEMsRUFBdURwRixJQUFJLEdBQUcsRUFBOUQsRUFBa0U7RUFDeEcsSUFBSVQsTUFBTSxHQUFHLE1BQU0sS0FBS0MsS0FBTCxDQUFXLENBQUMsSUFBRCxFQUFPLFNBQVAsRUFBa0IsSUFBbEIsRUFBd0I0RixlQUF4QixDQUFYLEVBQXFEcEYsSUFBckQsQ0FBbkI7O0VBQ0EsSUFBSVQsTUFBTSxDQUFDOEYsT0FBUCxDQUFlLFNBQWYsTUFBOEIsQ0FBQyxDQUFuQyxFQUFzQztJQUNwQyxNQUFNLElBQUl6RixLQUFKLENBQVcsMEJBQXlCTCxNQUFPLEVBQTNDLENBQU47RUFDRDtBQUNGLENBTEQ7O0FBcUJBakIsZUFBZSxDQUFDZ0gsUUFBaEIsR0FBMkIsZUFBZUEsUUFBZixDQUF5QkMsT0FBekIsRUFBa0NULE9BQU8sR0FBRyxFQUE1QyxFQUFnRDtFQUN6RSxNQUFNVSxPQUFPLEdBQUcsTUFBTUMsV0FBQSxDQUFHQyxJQUFILENBQVFILE9BQVIsQ0FBdEI7O0VBQ0EsTUFBTUksVUFBVSxHQUFHQyxhQUFBLENBQUtDLEtBQUwsQ0FBVzdCLElBQVgsQ0FBZ0JsRixpQkFBaEIsRUFBb0MsR0FBRTBHLE9BQVEsTUFBOUMsQ0FBbkI7O0VBQ0EsTUFBTU0saUJBQWlCLEdBQUcsRUFBMUI7O0VBRUEsSUFBSTtJQUNGLE1BQU1DLFdBQVcsR0FBRyxTQUFwQjtJQUNBLElBQUlDLFFBQVEsR0FBRyxJQUFmOztJQUNBLElBQUksS0FBS0MsOEJBQUwsS0FBd0MsSUFBeEMsSUFBZ0QsQ0FBQzVHLGVBQUEsQ0FBRTZHLFNBQUYsQ0FBWSxLQUFLRCw4QkFBakIsQ0FBckQsRUFBdUc7TUFDckdELFFBQVEsR0FBRyxNQUFNLEtBQUt4RyxLQUFMLENBQVcsQ0FBRSxZQUFXVixpQkFBa0IsaUJBQWdCaUgsV0FBWSxFQUEzRCxDQUFYLENBQWpCO0lBQ0Q7O0lBQ0QsSUFBSSxDQUFDMUcsZUFBQSxDQUFFOEcsUUFBRixDQUFXSCxRQUFYLENBQUQsSUFBMEJBLFFBQVEsQ0FBQ3pGLFFBQVQsQ0FBa0J3RixXQUFsQixLQUFrQyxDQUFDQyxRQUFRLENBQUN6RixRQUFULENBQWtCekIsaUJBQWxCLENBQWpFLEVBQXdHO01BQ3RHLElBQUksQ0FBQ08sZUFBQSxDQUFFNkcsU0FBRixDQUFZLEtBQUtELDhCQUFqQixDQUFMLEVBQXVEO1FBQ3JEaEgsZUFBQSxDQUFJQyxLQUFKLENBQVUsbUVBQ1IsK0JBREY7TUFFRDs7TUFDRDhHLFFBQVEsR0FBRyxNQUFNLEtBQUt4RyxLQUFMLENBQVcsQ0FBRSxNQUFLVixpQkFBa0IsaUJBQWdCaUgsV0FBWSxFQUFyRCxDQUFYLENBQWpCO01BQ0EsS0FBS0UsOEJBQUwsR0FBc0MsS0FBdEM7SUFDRCxDQVBELE1BT087TUFDTCxLQUFLQSw4QkFBTCxHQUFzQyxJQUF0QztJQUNEOztJQUNELElBQUlELFFBQVEsQ0FBQ3pGLFFBQVQsQ0FBa0J3RixXQUFsQixDQUFKLEVBQW9DO01BQ2xDLE1BQU0sSUFBSW5HLEtBQUosQ0FBVW9HLFFBQVEsQ0FBQ0ksU0FBVCxDQUFtQixDQUFuQixFQUFzQkosUUFBUSxDQUFDWCxPQUFULENBQWlCVSxXQUFqQixDQUF0QixDQUFWLENBQU47SUFDRDs7SUFDREQsaUJBQWlCLENBQUMzRixJQUFsQixDQUF1QixHQUNyQjZGLFFBQVEsQ0FBQ3hDLEtBQVQsQ0FBZSxJQUFmLEVBQ0dDLEdBREgsQ0FDUTRDLENBQUQsSUFBT0EsQ0FBQyxDQUFDdkQsSUFBRixFQURkLEVBRUd3RCxNQUZILENBRVVDLE9BRlYsQ0FERjtFQUtELENBeEJELENBd0JFLE9BQU81RyxDQUFQLEVBQVU7SUFDVlYsZUFBQSxDQUFJQyxLQUFKLENBQVcsaUJBQWdCUyxDQUFDLENBQUNFLE9BQUYsQ0FBVWlELElBQVYsRUFBaUIsa0RBQWxDLEdBQ1AsdUNBREg7O0lBRUEsTUFBTSxLQUFLdEQsS0FBTCxDQUFXLENBQUMsT0FBRCxFQUFVLElBQVYsRUFBZ0JWLGlCQUFoQixDQUFYLENBQU47RUFDRDs7RUFDREcsZUFBQSxDQUFJQyxLQUFKLENBQVcsMkNBQTBDNEcsaUJBQWlCLENBQUM5QyxNQUFPLEVBQTlFOztFQUNBLE1BQU13RCxNQUFNLEdBQUliLFVBQUQsSUFBZ0JDLGFBQUEsQ0FBS0MsS0FBTCxDQUFXWSxLQUFYLENBQWlCZCxVQUFqQixFQUE2QmpDLElBQTVEOztFQUVBLElBQUlvQyxpQkFBaUIsQ0FBQ3hCLElBQWxCLENBQXdCK0IsQ0FBRCxJQUFPRyxNQUFNLENBQUNILENBQUQsQ0FBTixLQUFjYixPQUE1QyxDQUFKLEVBQTBEO0lBQ3hEdkcsZUFBQSxDQUFJOEYsSUFBSixDQUFVLHVCQUFzQlEsT0FBUSwyQkFBMEJJLFVBQVcsR0FBN0U7O0lBSUEsS0FBS25HLEtBQUwsQ0FBVyxDQUFDLE9BQUQsRUFBVSxLQUFWLEVBQWlCbUcsVUFBakIsQ0FBWCxFQUF5Q2UsS0FBekMsQ0FBK0MsTUFBTSxDQUFFLENBQXZEO0VBQ0QsQ0FORCxNQU1PO0lBQ0x6SCxlQUFBLENBQUk4RixJQUFKLENBQVUsK0JBQThCUSxPQUFRLFNBQVFJLFVBQVcsR0FBbkU7O0lBQ0EsTUFBTWdCLEtBQUssR0FBRyxJQUFJQyxlQUFBLENBQU9DLEtBQVgsR0FBbUJDLEtBQW5CLEVBQWQ7SUFDQSxNQUFNLEtBQUszRyxJQUFMLENBQVVvRixPQUFWLEVBQW1CSSxVQUFuQixFQUErQjtNQUFDL0QsT0FBTyxFQUFFa0QsT0FBTyxDQUFDbEQ7SUFBbEIsQ0FBL0IsQ0FBTjtJQUNBLE1BQU07TUFBQ21GO0lBQUQsSUFBUyxNQUFNdEIsV0FBQSxDQUFHdUIsSUFBSCxDQUFRekIsT0FBUixDQUFyQjs7SUFDQXRHLGVBQUEsQ0FBSThGLElBQUosQ0FBVSxrQkFBaUJhLGFBQUEsQ0FBS3FCLFFBQUwsQ0FBYzFCLE9BQWQsQ0FBdUIsTUFBSzJCLGFBQUEsQ0FBS0Msb0JBQUwsQ0FBMEJKLElBQTFCLENBQWdDLElBQTlFLEdBQ04sUUFBT0osS0FBSyxDQUFDUyxXQUFOLEdBQW9CQyxjQUFwQixDQUFtQ0MsT0FBbkMsQ0FBMkMsQ0FBM0MsQ0FBOEMsSUFEeEQ7RUFFRDs7RUFDRCxJQUFJLENBQUMsS0FBS0MsZUFBVixFQUEyQjtJQUN6QixLQUFLQSxlQUFMLEdBQXVCLElBQUlDLGlCQUFKLENBQVE7TUFDN0JDLEdBQUcsRUFBRSxLQUFLQztJQURtQixDQUFSLENBQXZCO0VBR0Q7O0VBRURySSxlQUFBLENBQUVzSSxVQUFGLENBQWEsQ0FBQyxHQUFHLEtBQUtKLGVBQUwsQ0FBcUJLLElBQXJCLEVBQUosQ0FBYixFQUErQzlCLGlCQUFpQixDQUFDckMsR0FBbEIsQ0FBc0IrQyxNQUF0QixDQUEvQyxFQUNHcUIsT0FESCxDQUNZbkMsSUFBRCxJQUFVLEtBQUs2QixlQUFMLENBQXFCTyxHQUFyQixDQUF5QnBDLElBQXpCLENBRHJCOztFQUdBLEtBQUs2QixlQUFMLENBQXFCUSxHQUFyQixDQUF5QnZDLE9BQXpCLEVBQWtDRyxVQUFsQztFQUVBLE1BQU1xQyxnQkFBZ0IsR0FBR2xDLGlCQUFpQixDQUN2Q3JDLEdBRHNCLENBQ2pCNEMsQ0FBRCxJQUFPVCxhQUFBLENBQUtDLEtBQUwsQ0FBVzdCLElBQVgsQ0FBZ0JsRixpQkFBaEIsRUFBbUN1SCxDQUFuQyxDQURXLEVBRXRCQyxNQUZzQixDQUVkRCxDQUFELElBQU8sQ0FBQyxLQUFLa0IsZUFBTCxDQUFxQlUsR0FBckIsQ0FBeUJ6QixNQUFNLENBQUNILENBQUQsQ0FBL0IsQ0FGTyxFQUd0QjZCLEtBSHNCLENBR2hCLEtBQUtSLG9CQUFMLEdBQTRCLENBQUMsR0FBRyxLQUFLSCxlQUFMLENBQXFCSyxJQUFyQixFQUFKLEVBQWlDNUUsTUFIN0MsQ0FBekI7O0VBSUEsSUFBSSxDQUFDM0QsZUFBQSxDQUFFOEksT0FBRixDQUFVSCxnQkFBVixDQUFMLEVBQWtDO0lBQ2hDLElBQUk7TUFDRixNQUFNLEtBQUt4SSxLQUFMLENBQVcsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLEdBQUd3SSxnQkFBaEIsQ0FBWCxDQUFOOztNQUNBL0ksZUFBQSxDQUFJQyxLQUFKLENBQVcsV0FBVThJLGdCQUFnQixDQUFDaEYsTUFBTyxvQ0FBN0M7SUFDRCxDQUhELENBR0UsT0FBT3JELENBQVAsRUFBVTtNQUNWVixlQUFBLENBQUltSixJQUFKLENBQVUsaUJBQWdCSixnQkFBZ0IsQ0FBQ2hGLE1BQU8sc0NBQXpDLEdBQ04sbUJBQWtCckQsQ0FBQyxDQUFDRSxPQUFRLEVBRC9CO0lBRUQ7RUFDRjs7RUFDRCxPQUFPOEYsVUFBUDtBQUNELENBNUVEOztBQTJHQXJILGVBQWUsQ0FBQytKLE9BQWhCLEdBQTBCLGVBQWVBLE9BQWYsQ0FBd0JDLE9BQXhCLEVBQWlDeEQsT0FBTyxHQUFHLEVBQTNDLEVBQStDO0VBQ3ZFLElBQUl3RCxPQUFPLENBQUNDLFFBQVIsQ0FBaUJDLHVCQUFqQixDQUFKLEVBQXNDO0lBQ3BDLE9BQU8sTUFBTSxLQUFLQyxXQUFMLENBQWlCSCxPQUFqQixFQUEwQnhELE9BQTFCLENBQWI7RUFDRDs7RUFFREEsT0FBTyxHQUFHekYsZUFBQSxDQUFFcUosU0FBRixDQUFZNUQsT0FBWixDQUFWOztFQUNBekYsZUFBQSxDQUFFeUIsUUFBRixDQUFXZ0UsT0FBWCxFQUFvQjtJQUNsQmpFLE9BQU8sRUFBRSxJQURTO0lBRWxCZSxPQUFPLEVBQUUsS0FBSytHLGNBQUwsS0FBd0JDLGlDQUF4QixHQUFtREMsNEJBQW5ELEdBQXlFLEtBQUtGLGNBRnJFO0lBR2xCRyxjQUFjLEVBQUU7RUFIRSxDQUFwQjs7RUFNQSxNQUFNQyxXQUFXLEdBQUcsSUFBQUMseUJBQUEsRUFBaUIsTUFBTSxLQUFLNUgsV0FBTCxFQUF2QixFQUEyQzBELE9BQTNDLENBQXBCOztFQUNBLElBQUlBLE9BQU8sQ0FBQ21FLGFBQVIsS0FBeUIsTUFBTSxLQUFLQyw2QkFBTCxFQUEvQixDQUFKLEVBQXlFO0lBR3ZFSCxXQUFXLENBQUM1SSxJQUFaLENBQWlCLGtCQUFqQjtFQUNEOztFQUNELE1BQU1nSixXQUFXLEdBQUc7SUFDbEJ2SCxPQUFPLEVBQUVrRCxPQUFPLENBQUNsRCxPQURDO0lBRWxCa0gsY0FBYyxFQUFFaEUsT0FBTyxDQUFDZ0U7RUFGTixDQUFwQjtFQUlBLE1BQU1NLFVBQVUsR0FBRyxDQUNqQixTQURpQixFQUVqQixHQUFHTCxXQUZjLEVBR2pCVCxPQUhpQixDQUFuQjs7RUFLQSxJQUFJZSxpQkFBaUIsR0FBRyxZQUFZLE1BQU0sS0FBS25FLE9BQUwsQ0FBYWtFLFVBQWIsRUFBeUJELFdBQXpCLENBQTFDOztFQUVBLElBQUlHLGNBQWMsR0FBRyxLQUFLNUIsb0JBQUwsR0FBNEIsQ0FBakQ7O0VBQ0EsSUFBSTRCLGNBQUosRUFBb0I7SUFDbEJBLGNBQWMsR0FBRyxFQUFFLE1BQU0sS0FBS0MsMEJBQUwsRUFBUixDQUFqQjs7SUFDQSxJQUFJLENBQUNELGNBQUwsRUFBcUI7TUFDbkJySyxlQUFBLENBQUk4RixJQUFKLENBQVUsdUJBQXNCdUQsT0FBUSwwREFBL0IsR0FDTiw0Q0FESDtJQUVEO0VBQ0Y7O0VBQ0QsSUFBSWdCLGNBQUosRUFBb0I7SUFDbEIsTUFBTUUsVUFBVSxHQUFHLFlBQVk7TUFDN0J2SyxlQUFBLENBQUk4RixJQUFKLENBQVUsMEJBQXlCakcsaUJBQWtCLEdBQXJEOztNQUNBLE1BQU0sS0FBS1UsS0FBTCxDQUFXLENBQUMsSUFBRCxFQUFPLEtBQVAsRUFBZSxHQUFFVixpQkFBa0IsSUFBbkMsQ0FBWCxDQUFOO0lBQ0QsQ0FIRDs7SUFJQSxNQUFNMkssUUFBUSxHQUFHLFlBQVksTUFBTSxLQUFLbkUsUUFBTCxDQUFjZ0QsT0FBZCxFQUF1QjtNQUN4RDFHLE9BQU8sRUFBRWtELE9BQU8sQ0FBQ2xEO0lBRHVDLENBQXZCLENBQW5DOztJQUdBLElBQUk7TUFDRixNQUFNOEgsYUFBYSxHQUFHLE1BQU1ELFFBQVEsRUFBcEM7O01BQ0FKLGlCQUFpQixHQUFHLFlBQVk7UUFDOUIsTUFBTU0sd0JBQXdCLEdBQUloRSxVQUFELElBQWdCLENBQy9DLElBRCtDLEVBQ3pDLFNBRHlDLEVBRS9DLEdBQUdvRCxXQUY0QyxFQUcvQ3BELFVBSCtDLENBQWpEOztRQUtBLE1BQU1pRSxNQUFNLEdBQUcsTUFBTSxLQUFLcEssS0FBTCxDQUFXbUssd0JBQXdCLENBQUNELGFBQUQsQ0FBbkMsRUFBb0RQLFdBQXBELENBQXJCOztRQUVBLElBQUksMENBQTBDekosSUFBMUMsQ0FBK0NrSyxNQUEvQyxDQUFKLEVBQTREO1VBQzFEM0ssZUFBQSxDQUFJbUosSUFBSixDQUFVLHlDQUF3Q0UsT0FBUSxJQUFqRCxHQUNOLGtEQURIOztVQUVBLE1BQU1rQixVQUFVLEVBQWhCOztVQUNBdkssZUFBQSxDQUFJOEYsSUFBSixDQUFVLHdEQUFELEdBQ04sY0FBYSxLQUFLMkMsb0JBQXFCLHNDQUQxQzs7VUFFQSxNQUFNbUMsZ0JBQWdCLEdBQUcsTUFBTUosUUFBUSxFQUF2QztVQUNBLE9BQU8sTUFBTSxLQUFLakssS0FBTCxDQUFXbUssd0JBQXdCLENBQUNFLGdCQUFELENBQW5DLEVBQXVEVixXQUF2RCxDQUFiO1FBQ0Q7O1FBQ0QsT0FBT1MsTUFBUDtNQUNELENBbEJEO0lBbUJELENBckJELENBcUJFLE9BQU9qSyxDQUFQLEVBQVU7TUFDVlYsZUFBQSxDQUFJQyxLQUFKLENBQVVTLENBQVY7O01BQ0FWLGVBQUEsQ0FBSW1KLElBQUosQ0FBVSxzQ0FBcUNFLE9BQVEsTUFBSzNJLENBQUMsQ0FBQ0UsT0FBUSxFQUF0RTs7TUFDQVosZUFBQSxDQUFJbUosSUFBSixDQUFTLG9EQUFUOztNQUNBLE1BQU1vQixVQUFVLEVBQWhCO0lBQ0Q7RUFDRjs7RUFDRCxJQUFJO0lBQ0YsTUFBTTdDLEtBQUssR0FBRyxJQUFJQyxlQUFBLENBQU9DLEtBQVgsR0FBbUJDLEtBQW5CLEVBQWQ7SUFDQSxNQUFNOEMsTUFBTSxHQUFHLE1BQU1QLGlCQUFpQixFQUF0Qzs7SUFDQXBLLGVBQUEsQ0FBSThGLElBQUosQ0FBVSx3QkFBdUJhLGFBQUEsQ0FBS3FCLFFBQUwsQ0FBY3FCLE9BQWQsQ0FBdUIsVUFBUzNCLEtBQUssQ0FBQ1MsV0FBTixHQUFvQkMsY0FBcEIsQ0FBbUNDLE9BQW5DLENBQTJDLENBQTNDLENBQThDLElBQS9HOztJQUNBLE1BQU13QyxlQUFlLEdBQUksQ0FBQ3pLLGVBQUEsQ0FBRThHLFFBQUYsQ0FBV3lELE1BQVgsQ0FBRCxJQUF1QkEsTUFBTSxDQUFDNUcsTUFBUCxJQUFpQixHQUF6QyxHQUN0QjRHLE1BRHNCLEdBQ1osR0FBRUEsTUFBTSxDQUFDRyxNQUFQLENBQWMsQ0FBZCxFQUFpQixHQUFqQixDQUFzQixNQUFLSCxNQUFNLENBQUNHLE1BQVAsQ0FBY0gsTUFBTSxDQUFDNUcsTUFBUCxHQUFnQixHQUE5QixDQUFtQyxFQUQ1RTs7SUFFQS9ELGVBQUEsQ0FBSUMsS0FBSixDQUFXLDJCQUEwQjRLLGVBQWdCLEVBQXJEOztJQUNBLElBQUksa0NBQWtDcEssSUFBbEMsQ0FBdUNrSyxNQUF2QyxDQUFKLEVBQW9EO01BQ2xELElBQUksS0FBS0ksc0JBQUwsQ0FBNEJKLE1BQTVCLENBQUosRUFBeUM7UUFDdkMsTUFBTUssR0FBRyxHQUFJLDBGQUFiOztRQUNBaEwsZUFBQSxDQUFJbUosSUFBSixDQUFTNkIsR0FBVDs7UUFDQSxNQUFNLElBQUlySyxLQUFKLENBQVcsR0FBRWdLLE1BQU8sS0FBSUssR0FBSSxFQUE1QixDQUFOO01BQ0Q7O01BQ0QsTUFBTSxJQUFJckssS0FBSixDQUFVZ0ssTUFBVixDQUFOO0lBQ0Q7RUFDRixDQWZELENBZUUsT0FBT00sR0FBUCxFQUFZO0lBR1osSUFBSSxDQUFDQSxHQUFHLENBQUNySyxPQUFKLENBQVlVLFFBQVosQ0FBcUIsK0JBQXJCLENBQUwsRUFBNEQ7TUFDMUQsTUFBTTJKLEdBQU47SUFDRDs7SUFDRGpMLGVBQUEsQ0FBSUMsS0FBSixDQUFXLGdCQUFlb0osT0FBUSxrQ0FBbEM7RUFDRDtBQUNGLENBaEdEOztBQTBHQWhLLGVBQWUsQ0FBQzZMLDBCQUFoQixHQUE2QyxlQUFlQSwwQkFBZixDQUEyQzdCLE9BQTNDLEVBQW9EdEosR0FBRyxHQUFHLElBQTFELEVBQWdFO0VBQzNHLElBQUlvTCxPQUFPLEdBQUcsSUFBZDs7RUFDQSxJQUFJLENBQUNwTCxHQUFMLEVBQVU7SUFDUm9MLE9BQU8sR0FBRyxNQUFNLEtBQUtDLFVBQUwsQ0FBZ0IvQixPQUFoQixDQUFoQjtJQUNBdEosR0FBRyxHQUFHb0wsT0FBTyxDQUFDMUcsSUFBZDtFQUNEOztFQUNELElBQUksQ0FBQzFFLEdBQUwsRUFBVTtJQUNSQyxlQUFBLENBQUltSixJQUFKLENBQVUsb0NBQW1DRSxPQUFRLEdBQXJEOztJQUNBLE9BQU8sS0FBSzlKLGlCQUFMLENBQXVCQyxPQUE5QjtFQUNEOztFQUVELElBQUksRUFBQyxNQUFNLEtBQUtNLGNBQUwsQ0FBb0JDLEdBQXBCLENBQVAsQ0FBSixFQUFxQztJQUNuQ0MsZUFBQSxDQUFJQyxLQUFKLENBQVcsUUFBT29KLE9BQVEsb0JBQTFCOztJQUNBLE9BQU8sS0FBSzlKLGlCQUFMLENBQXVCRSxhQUE5QjtFQUNEOztFQUVELE1BQU07SUFBQzRMLFdBQVcsRUFBRUMsY0FBZDtJQUE4QkMsV0FBVyxFQUFFQztFQUEzQyxJQUFnRSxNQUFNLEtBQUtDLGNBQUwsQ0FBb0IxTCxHQUFwQixDQUE1RTs7RUFDQSxNQUFNMkwsY0FBYyxHQUFHQyxlQUFBLENBQU9DLEtBQVAsQ0FBYUQsZUFBQSxDQUFPRSxNQUFQLENBQWNMLGlCQUFkLENBQWIsQ0FBdkI7O0VBQ0EsSUFBSSxDQUFDTCxPQUFMLEVBQWM7SUFDWkEsT0FBTyxHQUFHLE1BQU0sS0FBS0MsVUFBTCxDQUFnQi9CLE9BQWhCLENBQWhCO0VBQ0Q7O0VBQ0QsTUFBTTtJQUFDZ0MsV0FBVyxFQUFFUyxjQUFkO0lBQThCUCxXQUFXLEVBQUVRO0VBQTNDLElBQWdFWixPQUF0RTs7RUFDQSxNQUFNYSxjQUFjLEdBQUdMLGVBQUEsQ0FBT0MsS0FBUCxDQUFhRCxlQUFBLENBQU9FLE1BQVAsQ0FBY0UsaUJBQWQsQ0FBYixDQUF2Qjs7RUFFQSxJQUFJLENBQUMzTCxlQUFBLENBQUVxQyxTQUFGLENBQVlxSixjQUFaLENBQUQsSUFBZ0MsQ0FBQzFMLGVBQUEsQ0FBRXFDLFNBQUYsQ0FBWTZJLGNBQVosQ0FBckMsRUFBa0U7SUFDaEV0TCxlQUFBLENBQUltSixJQUFKLENBQVUsaUNBQWdDRSxPQUFRLGFBQVl0SixHQUFJLEdBQWxFOztJQUNBLElBQUksQ0FBQ0ssZUFBQSxDQUFFOEcsUUFBRixDQUFXOEUsY0FBWCxDQUFELElBQStCLENBQUM1TCxlQUFBLENBQUU4RyxRQUFGLENBQVd3RSxjQUFYLENBQXBDLEVBQWdFO01BQzlEMUwsZUFBQSxDQUFJbUosSUFBSixDQUFVLGlDQUFnQ0UsT0FBUSxhQUFZdEosR0FBSSxHQUFsRTs7TUFDQSxPQUFPLEtBQUtSLGlCQUFMLENBQXVCQyxPQUE5QjtJQUNEO0VBQ0Y7O0VBQ0QsSUFBSVksZUFBQSxDQUFFcUMsU0FBRixDQUFZcUosY0FBWixLQUErQjFMLGVBQUEsQ0FBRXFDLFNBQUYsQ0FBWTZJLGNBQVosQ0FBbkMsRUFBZ0U7SUFDOUQsSUFBSUEsY0FBYyxHQUFHUSxjQUFyQixFQUFxQztNQUNuQzlMLGVBQUEsQ0FBSUMsS0FBSixDQUFXLHNDQUFxQ0YsR0FBSSxtREFBa0R1TCxjQUFlLE1BQUtRLGNBQWUsR0FBekk7O01BQ0EsT0FBTyxLQUFLdk0saUJBQUwsQ0FBdUJHLHVCQUE5QjtJQUNEOztJQUVELElBQUk0TCxjQUFjLEtBQUtRLGNBQXZCLEVBQXVDO01BQ3JDLElBQUkxTCxlQUFBLENBQUU4RyxRQUFGLENBQVc4RSxjQUFYLEtBQThCNUwsZUFBQSxDQUFFOEcsUUFBRixDQUFXd0UsY0FBWCxDQUE5QixJQUE0REMsZUFBQSxDQUFPTSxTQUFQLENBQWlCUCxjQUFqQixFQUFrQyxLQUFJTSxjQUFlLEVBQXJELENBQWhFLEVBQXlIO1FBQ3ZIaE0sZUFBQSxDQUFJQyxLQUFKLENBQVcsc0NBQXFDRixHQUFJLDJEQUEwRDJMLGNBQWUsU0FBUU0sY0FBZSxJQUFwSjs7UUFDQSxPQUFPTCxlQUFBLENBQU9NLFNBQVAsQ0FBaUJQLGNBQWpCLEVBQWtDLElBQUdNLGNBQWUsRUFBcEQsSUFDSCxLQUFLek0saUJBQUwsQ0FBdUJHLHVCQURwQixHQUVILEtBQUtILGlCQUFMLENBQXVCSSxzQkFGM0I7TUFHRDs7TUFDRCxJQUFJLENBQUNTLGVBQUEsQ0FBRThHLFFBQUYsQ0FBVzhFLGNBQVgsQ0FBRCxJQUErQixDQUFDNUwsZUFBQSxDQUFFOEcsUUFBRixDQUFXd0UsY0FBWCxDQUFwQyxFQUFnRTtRQUM5RDFMLGVBQUEsQ0FBSUMsS0FBSixDQUFXLHNDQUFxQ0YsR0FBSSwyQ0FBMEN1TCxjQUFlLFFBQU9RLGNBQWUsR0FBbkk7O1FBQ0EsT0FBTyxLQUFLdk0saUJBQUwsQ0FBdUJJLHNCQUE5QjtNQUNEO0lBQ0Y7RUFDRixDQWxCRCxNQWtCTyxJQUFJUyxlQUFBLENBQUU4RyxRQUFGLENBQVc4RSxjQUFYLEtBQThCNUwsZUFBQSxDQUFFOEcsUUFBRixDQUFXd0UsY0FBWCxDQUE5QixJQUE0REMsZUFBQSxDQUFPTSxTQUFQLENBQWlCUCxjQUFqQixFQUFrQyxLQUFJTSxjQUFlLEVBQXJELENBQWhFLEVBQXlIO0lBQzlIaE0sZUFBQSxDQUFJQyxLQUFKLENBQVcsc0NBQXFDRixHQUFJLDJEQUEwRDJMLGNBQWUsU0FBUU0sY0FBZSxJQUFwSjs7SUFDQSxPQUFPTCxlQUFBLENBQU9NLFNBQVAsQ0FBaUJQLGNBQWpCLEVBQWtDLElBQUdNLGNBQWUsRUFBcEQsSUFDSCxLQUFLek0saUJBQUwsQ0FBdUJHLHVCQURwQixHQUVILEtBQUtILGlCQUFMLENBQXVCSSxzQkFGM0I7RUFHRDs7RUFFREssZUFBQSxDQUFJQyxLQUFKLENBQVcsa0JBQWlCRixHQUFJLDRCQUEyQnNKLE9BQVEsTUFBS2lDLGNBQWUsTUFBS1EsY0FBZSxRQUFPSixjQUFlLFFBQU9NLGNBQWUsS0FBdko7O0VBQ0EsT0FBTyxLQUFLek0saUJBQUwsQ0FBdUJLLHVCQUE5QjtBQUNELENBMUREOztBQWdHQVAsZUFBZSxDQUFDNk0sZ0JBQWhCLEdBQW1DLGVBQWVBLGdCQUFmLENBQWlDN0MsT0FBakMsRUFBMEN0SixHQUFHLEdBQUcsSUFBaEQsRUFBc0Q4RixPQUFPLEdBQUcsRUFBaEUsRUFBb0U7RUFDckcsSUFBSSxDQUFDOUYsR0FBTCxFQUFVO0lBQ1IsTUFBTW9MLE9BQU8sR0FBRyxNQUFNLEtBQUtDLFVBQUwsQ0FBZ0IvQixPQUFoQixDQUF0QjtJQUNBdEosR0FBRyxHQUFHb0wsT0FBTyxDQUFDMUcsSUFBZDtFQUNEOztFQUVELE1BQU07SUFDSjBIO0VBREksSUFFRnRHLE9BRko7RUFHQSxNQUFNdUcsUUFBUSxHQUFHLE1BQU0sS0FBS2xCLDBCQUFMLENBQWdDN0IsT0FBaEMsRUFBeUN0SixHQUF6QyxDQUF2QjtFQUNBLElBQUlzTSxjQUFjLEdBQUcsS0FBckI7O0VBQ0EsTUFBTUMsZ0JBQWdCLEdBQUcsWUFBWTtJQUNuQyxJQUFJLEVBQUMsTUFBTSxLQUFLMUcsWUFBTCxDQUFrQjdGLEdBQWxCLENBQVAsQ0FBSixFQUFtQztNQUNqQyxNQUFNLElBQUlZLEtBQUosQ0FBVyxJQUFHWixHQUFJLGlDQUFsQixDQUFOO0lBQ0Q7O0lBQ0RzTSxjQUFjLEdBQUcsSUFBakI7RUFDRCxDQUxEOztFQU1BLFFBQVFELFFBQVI7SUFDRSxLQUFLLEtBQUs3TSxpQkFBTCxDQUF1QkUsYUFBNUI7TUFDRU8sZUFBQSxDQUFJQyxLQUFKLENBQVcsZUFBY29KLE9BQVEsR0FBakM7O01BQ0EsTUFBTSxLQUFLRCxPQUFMLENBQWFDLE9BQWIsRUFBc0JrRCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCM0csT0FBbEIsRUFBMkI7UUFBQ2pFLE9BQU8sRUFBRTtNQUFWLENBQTNCLENBQXRCLENBQU47TUFDQSxPQUFPO1FBQ0x3SyxRQURLO1FBRUxDO01BRkssQ0FBUDs7SUFJRixLQUFLLEtBQUs5TSxpQkFBTCxDQUF1QkcsdUJBQTVCO01BQ0UsSUFBSXlNLG1CQUFKLEVBQXlCO1FBQ3ZCbk0sZUFBQSxDQUFJOEYsSUFBSixDQUFVLGdCQUFlL0YsR0FBSSxnQkFBN0I7O1FBQ0EsTUFBTXVNLGdCQUFnQixFQUF0QjtRQUNBO01BQ0Q7O01BQ0R0TSxlQUFBLENBQUlDLEtBQUosQ0FBVyxrQ0FBaUNGLEdBQUksR0FBaEQ7O01BQ0EsT0FBTztRQUNMcU0sUUFESztRQUVMQztNQUZLLENBQVA7O0lBSUYsS0FBSyxLQUFLOU0saUJBQUwsQ0FBdUJJLHNCQUE1QjtNQUNFLElBQUl3TSxtQkFBSixFQUF5QjtRQUN2QjtNQUNEOztNQUNEbk0sZUFBQSxDQUFJQyxLQUFKLENBQVcsd0NBQXVDb0osT0FBUSxHQUExRDs7TUFDQSxPQUFPO1FBQ0wrQyxRQURLO1FBRUxDO01BRkssQ0FBUDs7SUFJRixLQUFLLEtBQUs5TSxpQkFBTCxDQUF1QkssdUJBQTVCO01BQ0VJLGVBQUEsQ0FBSUMsS0FBSixDQUFXLHlCQUF3Qm9KLE9BQVEsR0FBM0M7O01BQ0E7O0lBQ0Y7TUFDRXJKLGVBQUEsQ0FBSUMsS0FBSixDQUFXLGlDQUFnQ29KLE9BQVEsaUNBQW5EOztNQUNBO0VBakNKOztFQW9DQSxJQUFJO0lBQ0YsTUFBTSxLQUFLRCxPQUFMLENBQWFDLE9BQWIsRUFBc0JrRCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCM0csT0FBbEIsRUFBMkI7TUFBQ2pFLE9BQU8sRUFBRTtJQUFWLENBQTNCLENBQXRCLENBQU47RUFDRCxDQUZELENBRUUsT0FBT3FKLEdBQVAsRUFBWTtJQUNaakwsZUFBQSxDQUFJbUosSUFBSixDQUFVLDJCQUEwQnBKLEdBQUksaUJBQWdCa0wsR0FBRyxDQUFDckssT0FBUSwwQkFBcEU7O0lBQ0EsTUFBTTBMLGdCQUFnQixFQUF0QjtJQUNBLE1BQU0sS0FBS2xELE9BQUwsQ0FBYUMsT0FBYixFQUFzQmtELE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0IzRyxPQUFsQixFQUEyQjtNQUFDakUsT0FBTyxFQUFFO0lBQVYsQ0FBM0IsQ0FBdEIsQ0FBTjtFQUNEOztFQUNELE9BQU87SUFDTHdLLFFBREs7SUFFTEM7RUFGSyxDQUFQO0FBSUQsQ0FoRUQ7O0FBOEVBaE4sZUFBZSxDQUFDb04scUJBQWhCLEdBQXdDLGVBQWVBLHFCQUFmLENBQXNDcEQsT0FBdEMsRUFBK0NxRCxRQUEvQyxFQUF5REMsR0FBekQsRUFBOEQ7RUFDcEczTSxlQUFBLENBQUlDLEtBQUosQ0FBVyx5Q0FBd0N5TSxRQUFRLElBQUksU0FBVSxFQUF6RTs7RUFDQSxNQUFNRSxlQUFlLEdBQUd2RCxPQUF4Qjs7RUFDQSxJQUFJQSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJDLHVCQUFqQixDQUFKLEVBQXNDO0lBQ3BDRixPQUFPLEdBQUcsTUFBTSxLQUFLd0Qsa0JBQUwsQ0FBd0J4RCxPQUF4QixFQUFpQ3FELFFBQWpDLENBQWhCO0VBQ0Q7O0VBRUQsSUFBSUksVUFBVSxHQUFHLEVBQWpCO0VBQ0EsSUFBSUMsWUFBSjs7RUFDQSxJQUFJO0lBQ0YsTUFBTSxLQUFLQyxRQUFMLEVBQU47SUFFQUQsWUFBWSxHQUFHLE1BQU0sSUFBQUUsMkJBQUEsRUFBbUIsWUFBWTtNQUNsRCxNQUFNO1FBQUMzTTtNQUFELElBQVcsTUFBTSxJQUFBcUQsa0JBQUEsRUFBSyxLQUFLdUosUUFBTCxDQUFjQyxJQUFuQixFQUF5QixDQUM5QyxHQUQ4QyxFQUN6QyxnQkFEeUMsRUFDdkI5RCxPQUR1QixDQUF6QixDQUF2QjtNQUdBLE9BQU9qSixlQUFBLENBQUVnTixJQUFGLENBQU85TSxNQUFNLENBQUNpRSxLQUFQLENBQWE4SSxXQUFBLENBQUdDLEdBQWhCLENBQVAsQ0FBUDtJQUNELENBTG9CLEVBS2xCWixRQUxrQixFQUtSLFdBTFEsQ0FBckI7SUFPQSxNQUFNO01BQUNwTTtJQUFELElBQVcsTUFBTSxJQUFBcUQsa0JBQUEsRUFBSyxLQUFLdUosUUFBTCxDQUFjQyxJQUFuQixFQUF5QixDQUM5QyxHQUQ4QyxFQUN6QyxVQUR5QyxFQUM3QixXQUQ2QixFQUNoQjlELE9BRGdCLENBQXpCLENBQXZCO0lBR0F5RCxVQUFVLEdBQUcsSUFBQVMseUJBQUEsRUFBaUJqTixNQUFqQixFQUF5QnlNLFlBQXpCLENBQWI7RUFDRCxDQWRELENBY0UsT0FBT3JNLENBQVAsRUFBVTtJQUNWVixlQUFBLENBQUlDLEtBQUosQ0FBVSx3REFDUCxtQkFBa0JTLENBQUMsQ0FBQzhNLE1BQUYsSUFBWTlNLENBQUMsQ0FBQ0UsT0FBUSxFQUQzQzs7SUFHQSxNQUFNLEtBQUs2TSxTQUFMLEVBQU47SUFFQVYsWUFBWSxHQUFHLE1BQU0sSUFBQUUsMkJBQUEsRUFBbUIsWUFBWTtNQUNsRCxNQUFNO1FBQUMzTTtNQUFELElBQVcsTUFBTSxJQUFBcUQsa0JBQUEsRUFBSyxLQUFLdUosUUFBTCxDQUFjUSxLQUFuQixFQUEwQixDQUMvQyxHQUQrQyxFQUMxQyxnQkFEMEMsRUFDeEJyRSxPQUR3QixDQUExQixDQUF2QjtNQUdBLE9BQU9qSixlQUFBLENBQUVnTixJQUFGLENBQU85TSxNQUFNLENBQUNpRSxLQUFQLENBQWE4SSxXQUFBLENBQUdDLEdBQWhCLENBQVAsQ0FBUDtJQUNELENBTG9CLEVBS2xCWixRQUxrQixFQUtSLEVBTFEsQ0FBckI7O0lBT0EsSUFBSTtNQUNGLE1BQU07UUFBQ3BNO01BQUQsSUFBVyxNQUFNLElBQUFxRCxrQkFBQSxFQUFLLEtBQUt1SixRQUFMLENBQWNRLEtBQW5CLEVBQTBCLENBQy9DLEdBRCtDLEVBQzFDLFdBRDBDLEVBQzdCckUsT0FENkIsQ0FBMUIsQ0FBdkI7TUFHQXlELFVBQVUsR0FBRyxJQUFBYSwwQkFBQSxFQUFrQnJOLE1BQWxCLEVBQTBCeU0sWUFBMUIsQ0FBYjtJQUNELENBTEQsQ0FLRSxPQUFPck0sQ0FBUCxFQUFVO01BQ1YsTUFBTSxJQUFJQyxLQUFKLENBQVcsa0NBQWlDaU0sZUFBZ0IsS0FBbEQsR0FDYixtQkFBa0JsTSxDQUFDLENBQUNFLE9BQVEsRUFEekIsQ0FBTjtJQUVEO0VBQ0Y7O0VBRUQsSUFBSVIsZUFBQSxDQUFFOEksT0FBRixDQUFVNEQsVUFBVixDQUFKLEVBQTJCO0lBQ3pCOU0sZUFBQSxDQUFJbUosSUFBSixDQUFVLGtDQUFpQ3lELGVBQWdCLGNBQWxELEdBQ04sUUFBT0csWUFBWSxJQUFJLFNBQVUsaUJBRHBDO0VBRUQsQ0FIRCxNQUdPO0lBQ0wvTSxlQUFBLENBQUk4RixJQUFKLENBQVUsMEJBQXlCMUYsZUFBQSxDQUFFdUksSUFBRixDQUFPbUUsVUFBUCxFQUFtQi9JLE1BQU8sZ0JBQXBELEdBQ04sSUFBRzZJLGVBQWdCLG9CQUFtQkcsWUFBWSxJQUFJLFNBQVUsaUJBRG5FO0VBRUQ7O0VBRUQsTUFBTWEsU0FBUyxHQUFHakgsYUFBQSxDQUFLa0gsT0FBTCxDQUFhbEIsR0FBYixFQUFrQixjQUFsQixDQUFsQjs7RUFDQSxNQUFNLElBQUFtQixlQUFBLEVBQU9uQixHQUFQLENBQU47RUFDQSxNQUFNbkcsV0FBQSxDQUFHdUgsU0FBSCxDQUFhSCxTQUFiLEVBQXdCSSxJQUFJLENBQUNDLFNBQUwsQ0FBZW5CLFVBQWYsRUFBMkIsSUFBM0IsRUFBaUMsQ0FBakMsQ0FBeEIsRUFBNkQsT0FBN0QsQ0FBTjtFQUNBLE9BQU87SUFBQ0EsVUFBRDtJQUFhYztFQUFiLENBQVA7QUFDRCxDQTNERDs7QUFrRUF2TyxlQUFlLENBQUM2TyxpQkFBaEIsR0FBb0MsZUFBZUEsaUJBQWYsR0FBb0M7RUFDdEUsSUFBSXhCLFFBQUo7O0VBQ0EsSUFBSSxPQUFNLEtBQUt2SyxXQUFMLEVBQU4sSUFBMkIsRUFBL0IsRUFBbUM7SUFDakN1SyxRQUFRLEdBQUcsTUFBTSxLQUFLeUIsb0JBQUwsRUFBakI7O0lBQ0EsSUFBSSxDQUFDekIsUUFBTCxFQUFlO01BQ2JBLFFBQVEsR0FBRyxNQUFNLEtBQUswQix3QkFBTCxFQUFqQjtJQUNEO0VBQ0YsQ0FMRCxNQUtPO0lBQ0wxQixRQUFRLEdBQUcsQ0FBQyxNQUFNLEtBQUsyQixlQUFMLEVBQVAsRUFBK0I5SixLQUEvQixDQUFxQyxHQUFyQyxFQUEwQyxDQUExQyxDQUFYO0VBQ0Q7O0VBQ0QsT0FBT21JLFFBQVA7QUFDRCxDQVhEOztBQWtCQXJOLGVBQWUsQ0FBQ2lQLGdCQUFoQixHQUFtQyxlQUFlQSxnQkFBZixHQUFtQztFQUVwRSxJQUFJQyxPQUFPLEdBQUcsTUFBTSxLQUFLQyxtQkFBTCxFQUFwQjs7RUFDQSxJQUFJLENBQUNELE9BQUwsRUFBYztJQUNaQSxPQUFPLEdBQUcsTUFBTSxLQUFLRSx1QkFBTCxFQUFoQjtFQUNEOztFQUNELE9BQU9GLE9BQVA7QUFDRCxDQVBEOztBQWNBbFAsZUFBZSxDQUFDZ1AsZUFBaEIsR0FBa0MsZUFBZUEsZUFBZixHQUFrQztFQUVsRSxJQUFJSyxNQUFNLEdBQUcsTUFBTSxLQUFLQyxrQkFBTCxFQUFuQjs7RUFDQSxJQUFJLENBQUNELE1BQUwsRUFBYTtJQUNYQSxNQUFNLEdBQUcsTUFBTSxLQUFLRSxzQkFBTCxFQUFmO0VBQ0Q7O0VBQ0QsT0FBT0YsTUFBUDtBQUNELENBUEQ7O0FBZUFyUCxlQUFlLENBQUN3UCxlQUFoQixHQUFrQyxlQUFlQSxlQUFmLENBQWdDSCxNQUFoQyxFQUF3QztFQUN4RSxNQUFNSSxjQUFjLEdBQUcsSUFBSTNPLE1BQUosQ0FBVyx3QkFBWCxDQUF2Qjs7RUFDQSxJQUFJLENBQUMyTyxjQUFjLENBQUNyTyxJQUFmLENBQW9CaU8sTUFBcEIsQ0FBTCxFQUFrQztJQUNoQzFPLGVBQUEsQ0FBSW1KLElBQUosQ0FBVSwrREFBVjs7SUFDQTtFQUNEOztFQUVELElBQUk0RixZQUFZLEdBQUdMLE1BQU0sQ0FBQ25LLEtBQVAsQ0FBYSxHQUFiLENBQW5CO0VBQ0EsTUFBTSxLQUFLeUssd0JBQUwsQ0FBOEJELFlBQVksQ0FBQyxDQUFELENBQTFDLEVBQStDQSxZQUFZLENBQUMsQ0FBRCxDQUEzRCxDQUFOO0FBQ0QsQ0FURDs7QUFvQkExUCxlQUFlLENBQUM0UCxtQkFBaEIsR0FBc0MsZUFBZUEsbUJBQWYsQ0FBb0N2QyxRQUFwQyxFQUE4QzZCLE9BQTlDLEVBQXVEVyxNQUFNLEdBQUcsSUFBaEUsRUFBc0U7RUFDMUcsTUFBTUMsV0FBVyxHQUFHL08sZUFBQSxDQUFFOEcsUUFBRixDQUFXd0YsUUFBWCxDQUFwQjs7RUFDQSxNQUFNMEMsVUFBVSxHQUFHaFAsZUFBQSxDQUFFOEcsUUFBRixDQUFXcUgsT0FBWCxDQUFuQjs7RUFFQSxJQUFJLENBQUNZLFdBQUQsSUFBZ0IsQ0FBQ0MsVUFBckIsRUFBaUM7SUFDL0JwUCxlQUFBLENBQUltSixJQUFKLENBQVMsa0RBQVQ7O0lBQ0EsT0FBTyxLQUFQO0VBQ0Q7O0VBR0R1RCxRQUFRLEdBQUcsQ0FBQ0EsUUFBUSxJQUFJLEVBQWIsRUFBaUJyTCxXQUFqQixFQUFYO0VBQ0FrTixPQUFPLEdBQUcsQ0FBQ0EsT0FBTyxJQUFJLEVBQVosRUFBZ0JsTixXQUFoQixFQUFWO0VBRUEsTUFBTWEsUUFBUSxHQUFHLE1BQU0sS0FBS0MsV0FBTCxFQUF2QjtFQUVBLE9BQU8sTUFBTSxJQUFBa04sdUJBQUEsRUFBYyxDQUFkLEVBQWlCLElBQWpCLEVBQXVCLFlBQVk7SUFDOUMsSUFBSTtNQUNGLElBQUluTixRQUFRLEdBQUcsRUFBZixFQUFtQjtRQUNqQixJQUFJb04sV0FBSixFQUFpQkMsVUFBakI7O1FBQ0EsSUFBSUosV0FBSixFQUFpQjtVQUNmRyxXQUFXLEdBQUcsQ0FBQyxNQUFNLEtBQUtwQixpQkFBTCxFQUFQLEVBQWlDN00sV0FBakMsRUFBZDs7VUFDQSxJQUFJLENBQUMrTixVQUFELElBQWUxQyxRQUFRLEtBQUs0QyxXQUFoQyxFQUE2QztZQUMzQyxPQUFPLElBQVA7VUFDRDtRQUNGOztRQUNELElBQUlGLFVBQUosRUFBZ0I7VUFDZEcsVUFBVSxHQUFHLENBQUMsTUFBTSxLQUFLakIsZ0JBQUwsRUFBUCxFQUFnQ2pOLFdBQWhDLEVBQWI7O1VBQ0EsSUFBSSxDQUFDOE4sV0FBRCxJQUFnQlosT0FBTyxLQUFLZ0IsVUFBaEMsRUFBNEM7WUFDMUMsT0FBTyxJQUFQO1VBQ0Q7UUFDRjs7UUFDRCxJQUFJN0MsUUFBUSxLQUFLNEMsV0FBYixJQUE0QmYsT0FBTyxLQUFLZ0IsVUFBNUMsRUFBd0Q7VUFDdEQsT0FBTyxJQUFQO1FBQ0Q7TUFDRixDQWpCRCxNQWlCTztRQUNMLE1BQU1DLFNBQVMsR0FBRyxDQUFDLE1BQU0sS0FBS25CLGVBQUwsRUFBUCxFQUErQmhOLFdBQS9CLEVBQWxCO1FBRUEsTUFBTW9PLFVBQVUsR0FBR1AsTUFBTSxHQUFJLEdBQUV4QyxRQUFTLElBQUd3QyxNQUFNLENBQUM3TixXQUFQLEVBQXFCLElBQUdrTixPQUFRLEVBQWxELEdBQXVELEdBQUU3QixRQUFTLElBQUc2QixPQUFRLEVBQXRHOztRQUVBLElBQUlrQixVQUFVLEtBQUtELFNBQW5CLEVBQThCO1VBQzVCeFAsZUFBQSxDQUFJQyxLQUFKLENBQVcsaURBQWdEdVAsU0FBVSxHQUFyRTs7VUFDQSxPQUFPLElBQVA7UUFDRDtNQUNGOztNQUNELE9BQU8sS0FBUDtJQUNELENBN0JELENBNkJFLE9BQU92RSxHQUFQLEVBQVk7TUFFWmpMLGVBQUEsQ0FBSTBQLEtBQUosQ0FBVyx3Q0FBdUN6RSxHQUFHLENBQUNySyxPQUFRLEVBQTlEOztNQUNBLElBQUk7UUFDRixNQUFNLEtBQUsrTyxTQUFMLEVBQU47TUFDRCxDQUZELENBRUUsT0FBT0MsR0FBUCxFQUFZO1FBQ1osTUFBTSxLQUFLQyxVQUFMLEVBQU47TUFDRDs7TUFDRCxNQUFNNUUsR0FBTjtJQUNEO0VBQ0YsQ0F4Q1ksQ0FBYjtBQXlDRCxDQXhERDs7QUFvRUE1TCxlQUFlLENBQUMyUCx3QkFBaEIsR0FBMkMsZUFBZUEsd0JBQWYsQ0FBeUN0QyxRQUF6QyxFQUFtRDZCLE9BQW5ELEVBQTREVyxNQUFNLEdBQUcsSUFBckUsRUFBMkU7RUFDcEgsSUFBSUMsV0FBVyxHQUFHekMsUUFBUSxJQUFJdE0sZUFBQSxDQUFFOEcsUUFBRixDQUFXd0YsUUFBWCxDQUE5Qjs7RUFDQSxJQUFJMEMsVUFBVSxHQUFHYixPQUFPLElBQUluTyxlQUFBLENBQUU4RyxRQUFGLENBQVdxSCxPQUFYLENBQTVCOztFQUNBLElBQUksQ0FBQ1ksV0FBRCxJQUFnQixDQUFDQyxVQUFyQixFQUFpQztJQUMvQnBQLGVBQUEsQ0FBSW1KLElBQUosQ0FBVSxpRUFBVjs7SUFDQW5KLGVBQUEsQ0FBSW1KLElBQUosQ0FBVSxrQkFBaUJ1RCxRQUFTLG1CQUFrQjZCLE9BQVEsR0FBOUQ7O0lBQ0E7RUFDRDs7RUFDRCxJQUFJck0sUUFBUSxHQUFHLE1BQU0sS0FBS0MsV0FBTCxFQUFyQjtFQUVBdUssUUFBUSxHQUFHLENBQUNBLFFBQVEsSUFBSSxFQUFiLEVBQWlCckwsV0FBakIsRUFBWDtFQUNBa04sT0FBTyxHQUFHLENBQUNBLE9BQU8sSUFBSSxFQUFaLEVBQWdCdUIsV0FBaEIsRUFBVjs7RUFFQSxJQUFJNU4sUUFBUSxHQUFHLEVBQWYsRUFBbUI7SUFDakIsSUFBSW9OLFdBQVcsR0FBRyxDQUFDLE1BQU0sS0FBS3BCLGlCQUFMLEVBQVAsRUFBaUM3TSxXQUFqQyxFQUFsQjtJQUNBLElBQUlrTyxVQUFVLEdBQUcsQ0FBQyxNQUFNLEtBQUtqQixnQkFBTCxFQUFQLEVBQWdDd0IsV0FBaEMsRUFBakI7O0lBRUEsSUFBSXBELFFBQVEsS0FBSzRDLFdBQWIsSUFBNEJmLE9BQU8sS0FBS2dCLFVBQTVDLEVBQXdEO01BQ3RELE1BQU0sS0FBS1EsK0JBQUwsQ0FBcUNyRCxRQUFyQyxFQUErQzZCLE9BQS9DLENBQU47SUFDRDtFQUNGLENBUEQsTUFPTztJQUNMLElBQUlpQixTQUFTLEdBQUcsTUFBTSxLQUFLbkIsZUFBTCxFQUF0QjtJQUdBLE1BQU1vQixVQUFVLEdBQUdQLE1BQU0sR0FBSSxHQUFFeEMsUUFBUyxJQUFHd0MsTUFBTyxJQUFHWCxPQUFRLEVBQXBDLEdBQXlDLEdBQUU3QixRQUFTLElBQUc2QixPQUFRLEVBQXhGOztJQUNBdk8sZUFBQSxDQUFJQyxLQUFKLENBQVcsb0JBQW1CdVAsU0FBVSx5QkFBd0JDLFVBQVcsR0FBM0U7O0lBQ0EsSUFBSUEsVUFBVSxDQUFDcE8sV0FBWCxPQUE2Qm1PLFNBQVMsQ0FBQ25PLFdBQVYsRUFBakMsRUFBMEQ7TUFDeEQsTUFBTSxLQUFLME8sK0JBQUwsQ0FBcUNyRCxRQUFyQyxFQUErQzZCLE9BQS9DLEVBQXdEVyxNQUF4RCxDQUFOO0lBQ0Q7RUFDRjtBQUNGLENBOUJEOztBQThDQTdQLGVBQWUsQ0FBQytMLFVBQWhCLEdBQTZCLGVBQWVBLFVBQWYsQ0FBMkIvQixPQUEzQixFQUFvQztFQUMvRCxJQUFJLEVBQUMsTUFBTTdDLFdBQUEsQ0FBR3dKLE1BQUgsQ0FBVTNHLE9BQVYsQ0FBUCxDQUFKLEVBQStCO0lBQzdCLE1BQU0sSUFBSTFJLEtBQUosQ0FBVyxvQkFBbUIwSSxPQUFRLHNDQUF0QyxDQUFOO0VBQ0Q7O0VBRUQsSUFBSUEsT0FBTyxDQUFDQyxRQUFSLENBQWlCQyx1QkFBakIsQ0FBSixFQUFzQztJQUNwQ0YsT0FBTyxHQUFHLE1BQU0sS0FBSzRHLGNBQUwsQ0FBb0I1RyxPQUFwQixDQUFoQjtFQUNEOztFQUVELElBQUk7SUFDRixNQUFNNkcsU0FBUyxHQUFHLE1BQU1DLHdCQUFBLENBQVVDLElBQVYsQ0FBZS9HLE9BQWYsQ0FBeEI7SUFDQSxNQUFNZ0gsUUFBUSxHQUFHLE1BQU1ILFNBQVMsQ0FBQ0ksWUFBVixFQUF2QjtJQUNBLE1BQU07TUFBQ3ZRLEdBQUQ7TUFBTXdMLFdBQU47TUFBbUJGO0lBQW5CLElBQWtDLElBQUFrRixzQkFBQSxFQUFjRixRQUFkLENBQXhDO0lBQ0EsT0FBTztNQUNMNUwsSUFBSSxFQUFFMUUsR0FERDtNQUVMc0wsV0FGSztNQUdMRTtJQUhLLENBQVA7RUFLRCxDQVRELENBU0UsT0FBTzdLLENBQVAsRUFBVTtJQUNWVixlQUFBLENBQUltSixJQUFKLENBQVUsVUFBU3pJLENBQUMsQ0FBQ0UsT0FBUSw4QkFBN0I7RUFDRDs7RUFDRCxPQUFPLEVBQVA7QUFDRCxDQXRCRDs7QUE4QkF2QixlQUFlLENBQUNvTSxjQUFoQixHQUFpQyxlQUFlQSxjQUFmLENBQStCMUwsR0FBL0IsRUFBb0M7RUFDbkVDLGVBQUEsQ0FBSUMsS0FBSixDQUFXLDZCQUE0QkYsR0FBSSxHQUEzQzs7RUFDQSxJQUFJeVEsTUFBTSxHQUFHO0lBQUMvTCxJQUFJLEVBQUUxRTtFQUFQLENBQWI7O0VBQ0EsSUFBSTtJQUNGLE1BQU1PLE1BQU0sR0FBRyxNQUFNLEtBQUtDLEtBQUwsQ0FBVyxDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCUixHQUF2QixDQUFYLENBQXJCO0lBQ0EsTUFBTTBRLGdCQUFnQixHQUFHLElBQUl0USxNQUFKLENBQVcsdUJBQVgsRUFBb0N3RCxJQUFwQyxDQUF5Q3JELE1BQXpDLENBQXpCOztJQUNBLElBQUltUSxnQkFBSixFQUFzQjtNQUNwQkQsTUFBTSxDQUFDakYsV0FBUCxHQUFxQmtGLGdCQUFnQixDQUFDLENBQUQsQ0FBckM7SUFDRDs7SUFDRCxNQUFNQyxnQkFBZ0IsR0FBRyxJQUFJdlEsTUFBSixDQUFXLG1CQUFYLEVBQWdDd0QsSUFBaEMsQ0FBcUNyRCxNQUFyQyxDQUF6Qjs7SUFDQSxJQUFJb1EsZ0JBQUosRUFBc0I7TUFDcEJGLE1BQU0sQ0FBQ25GLFdBQVAsR0FBcUI3RixRQUFRLENBQUNrTCxnQkFBZ0IsQ0FBQyxDQUFELENBQWpCLEVBQXNCLEVBQXRCLENBQTdCO0lBQ0Q7O0lBQ0QsT0FBT0YsTUFBUDtFQUNELENBWEQsQ0FXRSxPQUFPdkYsR0FBUCxFQUFZO0lBQ1pqTCxlQUFBLENBQUltSixJQUFKLENBQVUsVUFBUzhCLEdBQUcsQ0FBQ3JLLE9BQVEsOEJBQS9CO0VBQ0Q7O0VBQ0QsT0FBTzRQLE1BQVA7QUFDRCxDQWxCRDs7QUE0QkFuUixlQUFlLENBQUNzUixPQUFoQixHQUEwQixlQUFlQSxPQUFmLENBQXdCNVEsR0FBeEIsRUFBNkI2USxNQUE3QixFQUFxQztFQUM3RCxNQUFNdFEsTUFBTSxHQUFHRixlQUFBLENBQUV5RCxJQUFGLENBQU8sTUFBTSxLQUFLdEQsS0FBTCxDQUFXLENBQUMsSUFBRCxFQUFPLE1BQVAsRUFBZVIsR0FBZixDQUFYLENBQWIsQ0FBZjs7RUFDQSxNQUFNOFEsYUFBYSxHQUFHLFVBQXRCOztFQUNBLElBQUksQ0FBQ3pRLGVBQUEsQ0FBRXdDLFVBQUYsQ0FBYXRDLE1BQWIsRUFBcUJ1USxhQUFyQixDQUFMLEVBQTBDO0lBQ3hDLE1BQU0sSUFBSWxRLEtBQUosQ0FBVyxxQ0FBb0NaLEdBQUksc0JBQXFCTyxNQUFPLEVBQS9FLENBQU47RUFDRDs7RUFFRCxNQUFNb0csVUFBVSxHQUFHcEcsTUFBTSxDQUFDc0IsT0FBUCxDQUFlaVAsYUFBZixFQUE4QixFQUE5QixDQUFuQjs7RUFDQSxNQUFNQyxNQUFNLEdBQUduSyxhQUFBLENBQUtrSCxPQUFMLENBQWErQyxNQUFiLEVBQXNCLEdBQUU3USxHQUFJLE1BQTVCLENBQWY7O0VBQ0EsTUFBTSxLQUFLZ1IsSUFBTCxDQUFVckssVUFBVixFQUFzQm9LLE1BQXRCLENBQU47O0VBQ0E5USxlQUFBLENBQUlDLEtBQUosQ0FBVywyQkFBMEJGLEdBQUksU0FBUStRLE1BQU8sR0FBeEQ7O0VBQ0EsT0FBT0EsTUFBUDtBQUNELENBWkQ7O2VBZWV6UixlIn0=